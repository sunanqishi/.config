/*! (c) Philipp KÃ¶nig under GPL-3.0 */
(e=>{"use strict";e.ModelHelper=function(t){const o={u:{openStates:{},hiddenEntries:{},additionalInfo:{},scrollPos:0,separators:{},customCss:"",pinnedEntries:{},lockPinned:!0,translationHelp:!0,translationThanked:!1,performReopening:!1,entryAmounts:{},lastOpened:null,sort:{name:"custom",dir:"ASC"},mostViewedPerMonth:!1,viewAsTree:!0},b:{animations:!0,preventPageScroll:!1,toggleArea:{width:1,widthWindowed:20,height:100,top:0},blacklist:[],whitelist:[],sidebarPosition:"left",openAction:"mousedown",newTab:"foreground",newTabPosition:"afterCurrent",visibility:"always",linkAction:"current",dirAccordion:!1,reopenSidebar:!1,preventWindowed:!1,rememberState:"openStatesAndPos",rememberOpenStatesSubDirectories:!0,newEntryPosition:"append",tooltipDelay:.5,tooltipContent:"all",tooltipAdditionalInfo:!0,dndCreationDialog:!1,openChildrenWarnLimit:10,dirOpenDuration:.4,scrollBarHide:1.5,openDelay:0,closeTimeout:1,dndOpenDirDelay:.5},a:{showIndicator:!0,showIndicatorIcon:!0,darkMode:!1,highContrast:!1,directoryArrows:!1,showBookmarkIcons:!0,showDirectoryIcons:!0,devModeIconBadge:!0,styles:{colorScheme:e.opts.defaultColors.colorScheme.light,foregroundColor:e.opts.defaultColors.foregroundColor.light,textColor:e.opts.defaultColors.textColor.light,hoverColor:e.opts.defaultColors.hoverColor.light,indicatorWidth:"40px",indicatorIconSize:"32px",indicatorIconColor:"#ffffff",indicatorColor:"rgba(0,0,0,0.5)",sidebarWidth:"350px",sidebarHeaderHeight:"50px",sidebarMaskColor:e.opts.defaultColors.sidebarMaskColor.light,bookmarksFontSize:"14px",directoriesIconSize:"16px",bookmarksIconSize:"16px",bookmarksLineHeight:"38px",bookmarksDirIcon:"dir-1",bookmarksDirColor:e.opts.defaultColors.textColor.light,bookmarksDirIndentation:"25px",bookmarksHorizontalPadding:"16px",scrollBarWidth:"11px",tooltipFontSize:"9px",overlayMaskColor:"rgba(0,0,0,0.5)",overlayHeaderHeight:"50px",fontFamily:"default",iconShape:"bookmark",iconColor:"auto"}},n:{override:!1,autoOpen:!0,focusOmnibox:!1,shortcutsPosition:"right",searchField:"show",searchEngine:"google",searchEngineCustom:{title:"",homepage:"",queryUrl:""},topPagesType:"topPages",topPagesAppearance:"favicon",shortcuts:[{label:"Google",url:"https://google.com"}],website:""}};let r={},i=null,n=null;const a={};this.init=()=>new Promise(e=>{i=null,Promise.all([s(),l()]).then(e)});const s=()=>new Promise(t=>{n&&n.disconnect(),n=e.api.runtime.connect(null,{name:"background"}),n.onMessage.addListener(e=>{a[e.uid]&&(a[e.uid](e.result),delete a[e.uid])}),t()}),l=()=>new Promise(t=>{const o=["utility","behaviour","appearance","newtab"],n={},a=o.length;let s=0;o.forEach(o=>{e.api.storage["utility"===o?"local":"sync"].get([o],e=>{n[o]=e[o]||{},++s===a&&(r=n,null===i?this.call("userType").then(e=>{e&&e.userType&&(i=e.userType),t()}):t())})})}),c=e=>{switch(e){case"u":return"utility";case"b":return"behaviour";case"a":return"appearance";case"n":return"newtab"}return null};this.getUserType=()=>i,this.getAllData=()=>r,this.getDefaultData=()=>{const e={};return Object.entries(o).forEach(([t,o])=>{const r=c(t);r&&(e[r]=o)}),e},this.getData=(e,i=!1)=>{let n=e;"string"==typeof n&&(n=[n]);let a={};if(n.forEach(e=>{const n=e.split("/")[0],s=e.split("/")[1];let l=null;const d=c(n);d&&r[d]&&(!0===i||void 0===r[d][s]?void 0!==o[n]&&void 0!==o[n][s]&&(l=o[n][s]):l=r[d][s]);const p=location.href.search(/chrome-extension:\/\//)>-1&&location.pathname.search(/settings\.html$/)>-1;if("b/toggleArea"===e&&matchMedia("(min-resolution: 1.25dppx)").matches&&!1===p&&(l=Object.assign({},l),Object.keys(l).forEach(e=>{e.startsWith("width")&&l[e]++})),"a/styles"===e&&(l=Object.assign({},o.a.styles,l),t.helper.font&&t.helper.font.isLoaded())){const e=t.helper.font.getFontInfo(i?"default":"config");l.fontFamily=e.name,Object.assign(l,e.fontWeights)}a[s]=l}),"string"==typeof e){const t=e.split("/")[1];a=a[t]}return a},this.setData=t=>new Promise(o=>{l().then(()=>{Object.keys(t).forEach(e=>{const o=e.split("/")[0],i=e.split("/")[1],n=t[e];switch(o){case"u":r.utility[i]=n;break;case"b":r.behaviour[i]=n;break;case"a":r.appearance[i]=n;break;case"n":r.newtab[i]=n}});let i=0;const n=(e=1)=>{i+=e,i>=4&&o()};try{e.api.storage.local.set({utility:r.utility},()=>{e.api.runtime.lastError,n()}),e.api.storage.sync.set({behaviour:r.behaviour,appearance:r.appearance,newtab:r.newtab},()=>{e.api.runtime.lastError,n(3)})}catch(e){o()}})}),this.call=(e,t={})=>new Promise(o=>{t.type=e,t.uid=e+"_"+JSON.stringify(t)+"_"+ +new Date+Math.random().toString(36).substr(2,12),a[t.uid]=e=>{o(e)},n.postMessage(t)})}})(jsu);