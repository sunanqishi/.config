/*! (c) Philipp KÃ¶nig under GPL-3.0 */
window.Colorpicker=(()=>{"use strict";const e={alpha:!1,classes:{picker:"color-picker",preview:"color-preview",pickingArea:"picking-area",pickingAreaThumb:"picker",hueSlider:"hue",hueSliderThumb:"slider-picker",alphaSlider:"alpha",alphaSliderThumb:"slider-picker",inputFieldPreview:"input-",visible:"visible"}};function t(){this.r=0,this.g=0,this.b=0,this.a=1,this.hue=0,this.saturation=0,this.value=0;const e=e=>"number"==typeof e&&!1===isNaN(e),t=(t,a,s,l)=>{e(t)&&e(a)&&e(s)&&(this.r=Math.max(0,Math.min(255,Math.trunc(t))),this.g=Math.max(0,Math.min(255,Math.trunc(a))),this.b=Math.max(0,Math.min(255,Math.trunc(s))),!0===e(l)&&(this.a=Math.max(0,Math.min(1,l))))},a=e=>{/(^#{0,1}[0-9A-F]{6}$)|(^#{0,1}[0-9A-F]{3}$)/i.test(e)&&("#"===e[0]&&(e=e.slice(1,e.length)),3===e.length&&(e=e.replace(/([0-9A-F])([0-9A-F])([0-9A-F])/i,"$1$1$2$2$3$3")),this.r=parseInt(e.substr(0,2),16),this.g=parseInt(e.substr(2,2),16),this.b=parseInt(e.substr(4,2),16),this.a=1,l())},s=()=>{const e=this.saturation/100,a=this.value/100;let s=e*a;const l=this.hue/60;let n=s*(1-Math.abs(l%2-1)),r=a-s;s=Math.trunc(255*(s+r)),n=Math.trunc(255*(n+r)),r=Math.trunc(255*r),l>=0&&l<1?t(s,n,r):l>=1&&l<2?t(n,s,r):l>=2&&l<3?t(r,s,n):l>=3&&l<4?t(r,n,s):l>=4&&l<5?t(n,r,s):l>=5&&l<6&&t(s,r,n)},l=()=>{const e=this.r/255,t=this.g/255,a=this.b/255,s=Math.max(e,t,a),l=s-Math.min(e,t,a);let n=0,r=0;l&&(s===e&&(n=(t-a)/l),s===t&&(n=2+(a-e)/l),s===a&&(n=4+(e-t)/l),s&&(r=l/s)),this.hue=Math.trunc(60*n),this.hue<0&&(this.hue+=360),this.saturation=Math.trunc(100*r),this.value=Math.trunc(100*s)};this.setFromRaw=e=>{"transparent"===(e=e.trim())?(this.r=0,this.g=0,this.b=0,this.a=0,l()):/(^#{0,1}[0-9A-F]{6}$)|(^#{0,1}[0-9A-F]{3}$)/i.test(e)?a(e):/^rgba?\([^)]+\)$/i.test(e)&&(e=>{const a=e.match(/(\d*\.\d*|\d+)/g);3===a.length&&a.push(1),4===a.length&&(t(...a.map(e=>+e)),l())})(e)},this.setByName=(t,a)=>{if(("r"===t||"g"===t||"b"===t||"a"===t)&&e(a)){let e=1;"a"!==t&&(a=Math.trunc(a),e=255),this[t]=Math.max(0,Math.min(e,a)),l()}},this.setHSV=(t,a,l)=>{e(t)&&e(a)&&e(l)&&(this.hue=Math.max(0,Math.min(360,t)),this.saturation=Math.max(0,Math.min(100,a)),this.value=Math.max(0,Math.min(100,l)),s())},this.setHue=t=>{e(t)&&(this.hue=Math.max(0,Math.min(360,t)),s())},this.getHex=()=>{let e=this.r.toString(16),t=this.g.toString(16),a=this.b.toString(16);return this.r<16&&(e="0"+e),this.g<16&&(t="0"+t),this.b<16&&(a="0"+a),("#"+e+t+a).toLowerCase()},this.getColor=()=>{if(1===Math.trunc(this.a))return this.getHex();const e="("+this.r+","+this.g+","+this.b;let t="",a="";const s=parseFloat(this.a);return 1!==s&&(t="a",a=","+s),"rgb"+t+e+a+")"}}return function(a,s){let l=null,n=null,r=null;const i=[],o={};this.color=new t;const c=t=>{const a=(e,t)=>{for(const s of Object.keys(t))t[s]instanceof Object&&Object.assign(t[s],a(e[s],t[s]));return Object.assign(e||{},t),e};return a(Object.assign({},e),t||{})},d=(e,t)=>{e.addEventListener("mousedown",e=>{t(e),document.addEventListener("mousemove",t)}),document.addEventListener("mouseup",()=>{document.removeEventListener("mousemove",t)})},p=()=>{l=document.createElement("div"),l.className=s.classes.picker,document.body.appendChild(l),n=document.createElement("span"),n.className=s.classes.preview,a.parentNode.insertBefore(n,a.nextSibling),a.ownerDocument.defaultView.addEventListener("resize",()=>{this.reposition()}),n.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.show()}),document.addEventListener("click",e=>{e.target===l||l.contains(e.target)||this.close()})},h=()=>{const e=document.createElement("div"),t=document.createElement("div");e.className=s.classes.pickingArea,t.className=s.classes.pickingAreaThumb,this.pickingArea=e,this.colorPicker=t,d(e,e=>{const t=this.pickingArea.getBoundingClientRect(),a=this.pickingArea.clientWidth,s=[e.pageX-t.left,e.pageY-t.top];s.forEach((e,t)=>{e>a&&(e=a),e<0&&(e=0),s[t]=e});const l=Math.trunc(100*s[0]/a),n=100-Math.trunc(100*s[1]/a);this.color.setHSV(this.color.hue,l,n),this.colorPicker.style.left=s[0]-5+"px",this.colorPicker.style.top=s[1]-5+"px",x(),w(),T()}),e.appendChild(t),l.appendChild(e)},g=()=>{const e=document.createElement("div"),t=document.createElement("div");e.className=s.classes.hueSlider,t.className=s.classes.hueSliderThumb,this.hueArea=e,this.huePicker=t,d(e,e=>{const t=this.hueArea.getBoundingClientRect();let a=Math.max(0,e.pageX-t.left);const s=this.hueArea.clientWidth;a>s&&(a=s),this.huePicker.style.left=Math.max(a-3,-2)+"px",this.color.setHue(Math.trunc(359*a/s)),b()}),e.appendChild(t),l.appendChild(e)},m=()=>{const e=document.createElement("div"),t=document.createElement("div"),a=document.createElement("div");e.className=s.classes.alphaSlider,a.className=s.classes.alphaSliderThumb,r={area:e,mask:t,picker:a},d(e,e=>{const t=r.area.getBoundingClientRect();let a=e.pageX-t.left;const s=r.area.clientWidth;a<0&&(a=0),a>s&&(a=s),this.color.setByName("a",+(a/s).toFixed(2)),r.picker.style.left=Math.max(a-3,-2)+"px",w(),T()}),e.appendChild(t),t.appendChild(a),l.appendChild(e)},u=(e,t)=>{const a=document.createElement("div"),n=document.createElement("input"),r=document.createElement("span");a.className=s.classes.inputFieldPreview+e,r.textContent=e,n.setAttribute("type","text"),a.appendChild(r),a.appendChild(n),l.appendChild(a),n.addEventListener("change",t),i[e]=e=>{n.value=e}},b=()=>{T(),f(),k(),v(),y(),x(),w()},v=()=>{const e=this.pickingArea.clientWidth,t=this.color.value,a=Math.trunc(this.color.saturation*e/100),s=e-Math.trunc(t*e/100);this.colorPicker.style.left=a-5+"px",this.colorPicker.style.top=s-5+"px"},f=()=>{const e=this.hueArea.clientWidth,t=Math.trunc(this.color.hue*e/360);this.huePicker.style.left=t-1+"px"},y=()=>{if(r){const e=r.area.clientWidth,t=1,a=Math.trunc(this.color.a*e);r.picker.style.left=a-t+"px"}},k=()=>{const e=new t;e.setHSV(this.color.hue,100,100),this.pickingArea.style.backgroundColor=e.getHex()},x=()=>{r&&(r.mask.style.background="linear-gradient(to right, transparent 0%,"+this.color.getHex()+" 100%)")},w=()=>{a.value=this.color.getColor(),n.style.backgroundColor=this.color.getColor(),C("change")},C=e=>{void 0!==o[e]&&o[e].forEach(e=>{e({color:this.color.getColor(),colorObj:this.color,elm:this.getElements()})})},T=()=>{A("r",this.color.r),A("g",this.color.g),A("b",this.color.b),A("a",this.color.a),A("color",this.color.getColor())},A=(e,t)=>{i[e]&&i[e](t)};this.setColor=e=>{this.color.setFromRaw(e),b()},this.getColorObj=()=>this.color,this.getElements=()=>({wrapper:l,preview:n,field:a}),this.reposition=()=>{if(l.classList.contains(s.classes.visible)){const e="rtl"===document.documentElement.getAttribute("dir"),t=n.getBoundingClientRect(),a={l:t.left,r:t.left-l.offsetWidth+n.offsetWidth},s=["bottom",e?"right":"left"];let r=t.top+n.offsetHeight,i=a[e?"r":"l"];l.offsetHeight+r>window.innerHeight&&(r=t.top-l.offsetHeight,s[0]="top"),l.offsetWidth+i>window.innerWidth&&(i=a.r,s[1]="right"),i<0&&(i=a.l,s[1]="left"),l.setAttribute("data-pos",s.join("-")),l.style.top=r+"px",l.style.left=i+"px"}},this.show=()=>{[].forEach.call(document.getElementsByClassName(s.classes.picker),e=>{e.classList.remove(s.classes.visible)}),l.classList.add(s.classes.visible),this.reposition(),C("show"),b()},this.close=()=>{l.classList.contains(s.classes.visible)&&(C("hide"),l.classList.remove(s.classes.visible))},this.on=(e,t)=>{void 0===o[e]&&(o[e]=[]),o[e].push(t)},(()=>{s=c(s),p(),h(),g();const e=["r","g","b"];s.alpha&&(m(),e.push("a")),e.forEach(e=>{u(e,t=>{let a=t.target.value;a="a"===e?+a.replace(/,/g,"."):parseInt(a),this.color.setByName(e,a),t.target.value=this.color[e],b()})}),u("color",e=>{const t=e.target.value;this.color.setFromRaw(t),b()}),b()})()}})(),(e=>{"use strict";e.api="undefined"==typeof chrome?browser:chrome,e.opts={ids:{page:{iframe:"blockbyte-bs-sidebar",overlay:"blockbyte-bs-overlay",indicator:"blockbyte-bs-indicator"},sidebar:{sidebar:"sidebar",shareInfo:"shareInfo",reloadInfo:"reloadInfo",infoBox:"infoBox",bookmarkBox:{all:"bookmarkBox",search:"bookmarkBoxSearch"}},overlay:{urlCheckResult:"results"}},classes:{active:"active",visible:"visible",hidden:"hidden",success:"success",premium:"premium",error:"error",info:"info",close:"close",hover:"hover",loading:"loading",building:"building",initLoading:"initLoading",page:{visible:"blockbyte-bs-visible",hideMask:"blockbyte-bs-hideMask",hover:"blockbyte-bs-hover",noscroll:"blockbyte-bs-noscroll",hasLeftsideBack:"blockbyte-bs-has-lsb",style:"blockbyte-bs-style",fullHeight:"blockbyte-bs-fullHeight",noAnimations:"noAnimations",darkMode:"dark",highContrast:"highContrast"},sidebar:{extLoaded:"loaded",openedOnce:"openedOnce",permanent:"permanent",cached:"cached",mark:"mark",hideRoot:"hideRoot",dirAnimated:"animated",dirOpened:"opened",dirArrow:"has-arrow",bookmarkDir:"dir",dirIcon:"icon",separator:"separator",bookmarkLink:"link",bookmarkLabel:"label",entryPinned:"pinned",menu:"menu",sort:"sort",fixed:"fixed",lockPinned:"lockPinned",lastHover:"lastHover",copied:"copied",filterBox:"filter",search:"search",searchBox:"searchBox",searchClose:"searchClose",searchVisible:"searchVisible",breadcrumb:"breadcrumb",removeMask:"removeMask",removed:"removed",restored:"restored"},tooltip:{wrapper:"tooltip"},contextmenu:{wrapper:"contextmenu",top:"top",list:"list",icons:"icons",right:"right",separator:"separator"},drag:{trigger:"drag",helper:"dragHelper",isDragged:"isDragged",cancel:"dragCancel",dragHover:"dragHover",snap:"snap",dragInitial:"dragInitial"},scrollBox:{wrapper:"scrollBox",hideScrollbar:"hideScrollbar",scrolled:"scrolled"},checkbox:{box:"checkbox",clicked:"clicked",focus:"focus"},overlay:{modal:"modal",preview:"preview",previewUrl:"previewUrl",action:"action",progressBar:"progressBar",buttonWrapper:"buttons",checkUrlProgressLabel:"progressLabel",urlCheckLoading:"urlCheckLoading",urlCheckCategories:"categories",urlCheckAction:"urlCheckAction",urlCheckResults:"urlCheckResults"},newtab:{customBackground:"customBackground",smallContent:"small",suggestions:"suggestions",edit:"edit",add:"add",link:"link",permanentSidebar:"permanentSidebar",listening:"listening",remove:"remove",infoBar:"infoBar",upload:"upload",save:"save",cancel:"cancel"},onboarding:{slide:"slide",skip:"skip",close:"close",settings:"settings",toggleArea:"toggleArea",appearance:"appearance",hideOpenTypeIcon:"hideOpenType",large:"large"},settings:{tabs:{content:"tab"},color:{field:"color",mask:"colorMask"},radio:{wrapper:"radioWrapper"},newtab:{hideable:"hideable"},translation:{select:"languageSelect",category:"category",thanks:"thanks",edit:"edit",progress:"progress",mark:"mark",requiredInfo:"requiredInfo",amountInfo:"amountInfo",empty:"empty",back:"back",goto:"goto"},toggleArea:{preview:"preview",fullHeight:"fullHeight",dragged:"dragged",dragging:"dragging",modal:"toggleAreaModal"},appearance:{preview:{fullHeight:"blockbyte-bs-fullHeight"}},feedback:{onlySuggestions:"onlySuggestions",answer:"answer",noHeight:"noHeight",absolute:"absolute"},inactive:"inactive",revert:"revert",highlight:"highlight",showModal:"showModal",sub:"sub",desc:"desc",box:"box",dialog:"dialog",boxWrapper:"boxWrapper",contentBox:"contentBox",incomplete:"incomplete",suggestion:"suggestion"}},attr:{uid:"data-blockbyte-bs-uid",src:"data-src",position:"data-pos",type:"data-type",name:"data-name",value:"data-value",sort:"data-sort",direction:"data-direction",style:"data-style",id:"data-id",i18n:"data-i18n",i18nReplaces:"data-i18nReplaces",newtab:{appearance:"data-appearance",perRow:"data-perRow"},onboarding:{openType:"data-openType",surface:"data-surface"},settings:{appearance:"data-appearance",success:"data-successtext",hideOnFalse:"data-hideOnFalse",save:"data-save",restore:"data-restore",range:{min:"data-min",max:"data-max",step:"data-step",unit:"data-unit",infinity:"data-infinity"},color:{alpha:"data-alpha",suggestions:"data-suggestions"},field:{placeholder:"data-placeholder"},translation:{releaseStatus:"data-status",language:"data-lang"}}},events:{loaded:"blockbyte-bs-loaded",elementsCreated:"blockbyte-bs-created",openSidebar:"blockbyte-bs-sidebar-open",sidebarOpened:"blockbyte-bs-sidebar-opened",overlayClosed:"blockbyte-bs-overlay-closed",checkboxChanged:"blockbyte-bs-checkbox-changed",scrollBoxLastPart:"blockbyte-bs-scrollbox-lastpart",premiumPurchased:"blockbyte-bs-premiumPurchased",showFeedbackForm:"blockbyte-bs-feedback",lsbLoaded:"blockbyte-lsb-loaded",pageChanged:"blockbyte-bs-pageChanged"},website:{info:{landing:"https://extensions.blockbyte.de/",privacyPolicy:"https://extensions.blockbyte.de/privacy/bs",changelog:"https://extensions.blockbyte.de/changelog/bs",uninstall:"https://extensions.blockbyte.de/uninstall/bs"},premium:{checkout:"https://extensions.blockbyte.de/premium/bs/checkout",checkLicenseKey:"https://extensions.blockbyte.de/ajax/premium/bs/check"},feedback:{form:"https://extensions.blockbyte.de/ajax/feedback",suggestions:"https://extensions.blockbyte.de/ajax/feedback/suggestions"},translation:{info:"https://extensions.blockbyte.de/ajax/translation/bs/info",langvars:"https://extensions.blockbyte.de/ajax/translation/bs/langvars",submit:"https://extensions.blockbyte.de/ajax/translation/bs/submit"},api:{checkUrls:"https://api.blockbyte.de/v1/urlcheck",thumbnail:"https://api.blockbyte.de/v1/thumbnail",checkStatus:"https://extensions.blockbyte.de/ajax/status/bs",evaluate:"https://api.blockbyte.de/v3/evaluate/extension/bs"}},urlAliases:{Edge:{"chrome://newtab/":"edge://newtab/","chrome://bookmarks":"edge://favorites","chrome://extensions/shortcuts":"edge://extensions/shortcuts"},Opera:{"chrome://newtab/":"chrome://startpage/","chrome://bookmarks":"opera://bookmarks","chrome://extensions/shortcuts":"opera://settings/keyboardShortcuts"}},defaultColors:{textColor:{light:"#646464",dark:"#c8c8c8"},sidebarMaskColor:{light:"rgba(255,255,255,0.8)",dark:"rgba(0,0,0,0.6)"},hoverColor:{light:"#f5f5f5",dark:"#555555"},colorScheme:{light:"#1b82f1",dark:"#1f4d80"},foregroundColor:{light:"#ffffff",dark:"#333333"},icon:{forLight:"#555555",forDark:"#ffffff"}},leftsideBackSelector:"div#blockbyte-lsb-indicator.blockbyte-lsb-visible",manifest:e.api.runtime.getManifest(),demoMode:!1},e.browserName="Chrome",/EDG\//i.test(navigator.userAgent)?e.browserName="Edge":/OPERA|OPR\//i.test(navigator.userAgent)&&(e.browserName="Opera"),e.cl=e.opts.classes,e.attr=e.opts.attr,e.AppearanceHelper=function(t){const a={sidebar:{template:"sidebar",styles:["sidebar"]},general:{template:"sidebar",styles:["sidebar"]},overlay:{template:"overlay",styles:["overlay"]},indicator:{template:"indicator",styles:["contentBase","content"]}},s={sidebarHeaderHeight:{xs:32,s:36,l:55},bookmarksFontSize:{xs:11,s:12,l:16},bookmarksLineHeight:{xs:20,s:26,l:45},sidebarWidth:{xs:250,s:300,l:400},bookmarksDirIndentation:{xs:20,s:22,l:30},bookmarksHorizontalPadding:{xs:6,s:10,l:18},bookmarksIconSize:{xs:12,s:14,l:18},directoriesIconSize:{xs:12,s:14,l:18},scrollBarWidth:{xs:10,s:11,l:12},tooltipFontSize:{xs:9,s:9,l:12}};let l=null,n=null;this.init=()=>new Promise(a=>{m().then(()=>{if(["darkMode","directoryArrows"].forEach(e=>{let a=!1;!0===t.helper.model.getData("a/"+e)&&(t.elm.checkbox[e].trigger("click"),a=!0),t.elm.checkbox[e].children("input").data("initial",a)}),"default"!==t.helper.model.getUserType()){const e=t.helper.model.getData("u/customCss");t.elm.textarea.customCss[0].value=e,t.elm.textarea.customCss.data("initial",e),t.elm.textarea.customCss.attr("placeholder","section#sidebar {\n   ...\n}"),t.elm.textarea.customCss.parent().append("<span>"+t.helper.i18n.get("settings_not_synced")+"</span>")}else t.elm.textarea.customCss.addClass(e.cl.settings.inactive),t.addNoPremiumText(t.elm.textarea.customCss.parent());const s=t.helper.model.getData("a/styles");Object.entries(s).forEach(([a,s])=>{t.elm.range[a]?(s=s.replace("px",""),"sidebarWidth"===a&&+s>600&&t.elm.range[a].attr("max",s),t.elm.range[a][0].value=s,t.elm.range[a].data("initial",s),t.elm.range[a].trigger("change")):t.elm.color[a]?("iconColor"===a&&"auto"===s&&(s=e.opts.defaultColors.icon.forLight,t.elm.select.iconColorType[0].value="auto"),r(t.elm.color[a],s),t.elm.color[a].data("initial",t.elm.color[a][0].value)):t.elm.select[a]?("fontFamily"===a&&(s=s.replace(/(^'*)|('*$)/g,""),0===t.elm.select[a].children("option[value='"+s+"']").length()&&(s="default")),t.elm.select[a][0].value=s,t.elm.select[a].data("initial",s)):t.elm.radio[a]&&(t.elm.radio[a][0].value=s,t.elm.radio[a].trigger("change"),t.elm.radio[a].data("initial",s))}),u(),e.delay(100).then(()=>{i(),e(window).trigger("resize"),a()})})}),this.save=()=>new Promise(t=>{const a=h();e.api.storage.sync.get(["appearance"],s=>{s.appearance=s.appearance||{},Object.entries(a.appearance).forEach(([e,t])=>{s.appearance[e]=t}),e.api.storage.sync.set({appearance:s.appearance},()=>{e.api.storage.local.get(["utility"],s=>{const l=s.utility||{};l.customCss=a.utility.customCss,e.api.storage.local.set({utility:l},()=>{t()})})})})});const r=(e,t)=>{const a=e.data("picker");a&&a.setColor(t)},i=()=>{Object.keys(t.elm.preview).forEach(e=>{o(e)})},o=s=>{const l=h();if(t.elm.preview[s]){if(t.elm.preview[s].find("head > style").remove(),"default"===l.appearance.styles.fontFamily){const e=t.helper.font.getDefaultFontInfo();l.appearance.styles.fontFamily=e.name}Object.assign(l.appearance.styles,t.helper.font.getFontWeights(l.appearance.styles.fontFamily));let n=a[s].css;n+=l.utility.customCss,Object.keys(l.appearance.styles).forEach(e=>{let t=l.appearance.styles[e];"sidebarWidth"===e&&(t=t.replace("px",""),t=Math.min(+t,600),t+="px"),n=n.replace(new RegExp('"?%'+e+'"?',"g"),t)}),t.elm.preview[s].find("["+e.attr.style+"]").forEach(t=>{let a=e(t).attr(e.attr.style);Object.keys(l.appearance.styles).forEach(e=>{a=a.replace(new RegExp('"?%'+e+'"?',"g"),l.appearance.styles[e])}),t.style.cssText=a}),t.elm.preview[s].find("["+e.attr.settings.hideOnFalse+"]").forEach(t=>{const a=e(t).attr(e.attr.settings.hideOnFalse);void 0===l.appearance[a]||!1===l.appearance[a]?e(t).css("display","none"):e(t).css("display","block")}),t.elm.preview[s].find("head").append("<style>"+n+"</style>"),l.appearance.darkMode?t.elm.preview[s].find("body").addClass(e.cl.page.darkMode):t.elm.preview[s].find("body").removeClass(e.cl.page.darkMode),l.appearance.directoryArrows?t.elm.preview[s].find("div#bookmarkBox a.dir").addClass(e.cl.sidebar.dirArrow):t.elm.preview[s].find("div#bookmarkBox a.dir").removeClass(e.cl.sidebar.dirArrow),p(t.elm.preview[s]),d(t.elm.preview[s]),c(t.elm.preview[s])}else"icon"===s&&t.helper.model.call("updateIcon",{name:l.appearance.styles.iconShape,color:"auto"===t.elm.select.iconColorType[0].value?"auto":l.appearance.styles.iconColor,onlyCurrentTab:!0})},c=a=>{const s=a.find("div#blockbyte-bs-indicator");if(s.length()>0){const a=+t.elm.range.toggleArea_height[0].value,l=+t.elm.range.toggleArea_top[0].value;s.css({height:a+"%",top:l+"%"}),100===a?s.addClass(e.cl.settings.appearance.preview.fullHeight):s.removeClass(e.cl.settings.appearance.preview.fullHeight)}},d=t=>{const a=t.find("section#sidebar");if(a.length()>0){const t=a.find("> header");t.find("> h1").removeClass(e.cl.hidden),t.find("> h1 > span").removeClass(e.cl.hidden),["label","amount"].forEach(a=>{let s=null;t.children("a").forEach(l=>{if(null===s)s=l.offsetTop;else if(s!==l.offsetTop||0===t.find("> h1")[0].offsetTop)return"label"===a?t.find("> h1 > span").addClass(e.cl.hidden):"amount"===a&&t.find("> h1").addClass(e.cl.hidden),!1})})}},p=a=>{const s=a.find("div.tooltip"),n=a.find("li > a.hover");if(s.length()>0&&n.length()>0)if(+new Date-l<2e3){const a=n[0].getBoundingClientRect();s.addClass(e.cl.visible);let l=a.x-s[0].offsetWidth;t.helper.i18n.isRtl()&&(l=a.x+n[0].offsetWidth),s.css({top:a.y+n.realHeight()/2-s.realHeight()/2+"px",left:l+"px"})}else s.removeClass(e.cl.visible)},h=()=>{const a={utility:{customCss:"default"===t.helper.model.getUserType()?"":t.elm.textarea.customCss[0].value.replace(/[\u200B-\u200D\uFEFF]/g,"").trim()},appearance:{darkMode:t.helper.checkbox.isChecked(t.elm.checkbox.darkMode),directoryArrows:t.helper.checkbox.isChecked(t.elm.checkbox.directoryArrows),highContrast:!1,showIndicator:!0,showIndicatorIcon:!0,showBookmarkIcons:!0,showDirectoryIcons:!0,styles:{}}},s=t.helper.model.getData("a/styles");return Object.keys(s).forEach(s=>{if(t.elm.range[s])a.appearance.styles[s]=t.elm.range[s][0].value+"px";else if(t.elm.color[s]){const l=g(s,t.elm.color[s][0].value);if(a.appearance.styles[s]=l.color,"colorScheme"===s){const t=l.luminance?l.luminance:0;a.appearance.styles.foregroundColor=e.opts.defaultColors.foregroundColor[t>170?"dark":"light"],t>215&&(a.appearance.highContrast=!0)}}else t.elm.select[s]?(a.appearance.styles[s]=t.elm.select[s][0].value,"fontFamily"===s&&"default"!==a.appearance.styles[s]&&(a.appearance.styles[s]="'"+a.appearance.styles[s]+"'")):t.elm.radio[s]&&(a.appearance.styles[s]=t.elm.radio[s][0].value)}),Object.entries({indicatorWidth:"showIndicator",indicatorIconSize:"showIndicatorIcon",bookmarksIconSize:"showBookmarkIcons",directoriesIconSize:"showDirectoryIcons"}).forEach(([e,t])=>{0===parseInt(a.appearance.styles[e])&&(a.appearance[t]=!1)}),"auto"===t.elm.select.iconColorType[0].value&&(a.appearance.styles.iconColor="auto"),a},g=(e,a)=>{let s=null;const l=t.elm.color[e].data("picker");if(l){const e=l.getColorObj();0===e.a&&(a="transparent"),s=.299*e.r+.587*e.g+.114*e.b}return{color:a,luminance:s}},m=()=>new Promise(s=>{let l=0;const n=Object.keys(a).length;Object.keys(a).forEach(r=>{a[r].css="",t.elm.preview[r]=e("<iframe />").attr(e.attr.settings.appearance,r).appendTo(t.elm.body),e.xhr(e.api.extension.getURL("html/template/"+a[r].template+".html")).then(e=>{if(e&&e.responseText){let a=e.responseText;a=a.replace(/__DATE__CREATED__/g,t.helper.i18n.getLocaleDate(new Date("2016-11-25"))),a=a.replace(/__POSITION__/g,t.helper.i18n.isRtl()?"left":"right");const i=t.elm.preview[r].find("body");i.html(a),i.parent("html").attr("dir",t.helper.i18n.isRtl()?"rtl":"ltr"),t.helper.i18n.parseHtml(t.elm.preview[r]),t.helper.font.addStylesheet(t.elm.preview[r]),l++,l===n&&s()}}),a[r].styles.forEach(t=>{e.xhr(e.api.extension.getURL("css/"+t+".css")).then(e=>{e&&e.responseText&&(a[r].css+=e.responseText)})})})}),u=()=>{t.elm.appearance.presetWrapper.children("a").on("click",a=>{const l=e(a.currentTarget).attr(e.attr.type),n=t.helper.model.getData("a/styles",!0);Object.entries(s).forEach(([e,a])=>{a[l]?t.elm.range[e][0].value=a[l]:t.elm.range[e][0].value=n[e].replace("px",""),t.elm.range[e].trigger("change")})}),t.elm.select.iconColorType.on("change, input",a=>{"auto"===a.currentTarget.value?t.elm.appearance.iconColorWrapper.addClass(e.cl.hidden):t.elm.appearance.iconColorWrapper.removeClass(e.cl.hidden),o("icon")}).trigger("input"),t.elm.range.tooltipFontSize.on("change, input",()=>{l=+new Date,n&&clearTimeout(n),n=setTimeout(()=>{o("sidebar")},2001)}),t.elm.appearance.content.find("input, textarea, select").on("change input",a=>{const s=e(a.currentTarget),l=s.data("initial");let n=a.currentTarget.value;if(void 0!==l){if("checkbox"===s.attr("type")&&(n=a.currentTarget.checked,e(s).parent()[0]===t.elm.checkbox.darkMode[0])){const a={new:n?"dark":"light",old:n?"light":"dark"},s=e.opts.defaultColors.textColor[a.new];r(t.elm.color.textColor,s),r(t.elm.color.bookmarksDirColor,s),["sidebarMaskColor","colorScheme","hoverColor"].forEach(s=>{if("hoverColor"===s||t.elm.color[s][0].value===e.opts.defaultColors[s][a.old]){const l=e.opts.defaultColors[s][a.new];r(t.elm.color[s],l)}})}const i=e(a.currentTarget).parents("div."+e.cl.settings.box).eq(0);n!==l?0===i.children("a."+e.cl.settings.revert).length()&&e("<a href='#' />").addClass(e.cl.settings.revert).data("elm",i).appendTo(i):i.children("a."+e.cl.settings.revert).remove();const c=t.helper.menu.getPath();o(c[1])}}),t.elm.appearance.content.on("click","a."+e.cl.settings.revert,t=>{t.preventDefault(),e(t.currentTarget).parent("div."+e.cl.settings.box).find("input, select").forEach(t=>{const a=e(t),s=a.data("initial");a.data("picker")?r(a,s):void 0!==s&&("checkbox"===a.attr("type")&&"boolean"==typeof s?t.checked!==s&&a.parent("div").trigger("click"):(t.value=s,a.trigger("change")))})}),e(document).on(e.opts.events.pageChanged,e=>{e.detail.path&&"appearance"===e.detail.path[0]&&o(e.detail.path[1])})}},e.ExpertHelper=function(t){let a={},s={},l=null;this.init=async()=>{"default"!==t.helper.model.getUserType()?(s=t.helper.model.getDefaultData(),delete s.utility,r(),this.updateRawConfigList()):(t.elm.expert.search.remove(),t.addNoPremiumText(t.elm.expert.content.children("div")))},this.updateRawConfigList=(l=!0)=>{l&&(a=JSON.parse(JSON.stringify(t.helper.model.getAllData())),delete a.utility);const r=t.elm.expert.template[0].content;t.elm.expert.content.children("div["+e.attr.type+"]").remove(),Object.entries(s).forEach(([s,l])=>{e(r).appendTo(t.elm.expert.content);const i=t.elm.expert.content.children("div["+e.attr.type+"]").eq(-1),o=i.children("ul");i.attr(e.attr.type,s),i.children("h2").text(s),c(o,l,a[s]||null),n(i)}),i()},this.save=()=>new Promise((s,l)=>{"default"!==t.helper.model.getUserType()?t.elm.expert.content.find("input[type='text']."+e.cl.error).length()>0?(alert(t.helper.i18n.get("settings_expert_save_error")),l()):e.api.storage.sync.set({behaviour:a.behaviour||{},appearance:a.appearance||{},newtab:a.newtab||{}},s):s()});const n=t=>{if(l){const a=t.children("ul");a.find("li").forEach(t=>{(-1!==e(t).attr(e.attr.name).toLowerCase().indexOf(l)||e(t).parents(".__visible").length()>0)&&e(t).addClass("__visible")}),a.find("li:not(.__visible)").forEach(t=>{0===e(t).find(".__visible").length()&&e(t).remove()}),e("li.__visible").removeClass("__visible"),0===a.children("li").length()&&t.remove()}},r=()=>{t.elm.expert.search.attr("placeholder",t.helper.i18n.get("settings_search_placeholder",null,!0)),t.elm.expert.search.on("keyup change input",e=>{l=e.currentTarget.value.trim().toLowerCase(),0===l.length&&(l=null),this.updateRawConfigList(!1)})},i=()=>{t.elm.expert.content.find("ul > li > input[type='text']").on("keyup change input",a=>{t.highlightUnsavedChanges();const s=e(a.currentTarget),l=s.parent("li").data("path");if(s.removeClass(e.cl.error),l&&l.length>0)try{let t=a.currentTarget.value;"json"===s.attr(e.attr.type)&&(t=JSON.parse(t)),o(l,t)}catch(a){s.addClass(e.cl.error)}})},o=(e,t)=>{"false"===t||"true"===t?t="true"===t:!isNaN(parseFloat(t))&&isFinite(t)&&(t=parseFloat(t));let s=0;e.reduce((a,l)=>(s++,s===e.length?(a[l]=t,t):a[l]),a)},c=(s,l,n)=>{Object.entries(l).forEach(([l,r])=>{let i=JSON.parse(JSON.stringify(r));const o=e("<li />").attr(e.attr.name,l).append("<label>"+l+"</label>").appendTo(s),d=(t=>{const s=t.parents("div["+e.attr.type+"]").eq(0).attr(e.attr.type);if(s&&a[s]){const a=[s];return t.parents("li["+e.attr.name+"]").forEach(t=>{const s=e(t).attr(e.attr.name);a.push(s)},!0),a.push(e(t).attr(e.attr.name)),a}return[]})(o);o.data("path",d);const p=(e=>{let a=null;const s=[e,[...e]];return s[1].shift(),s.some(e=>{let s="settings_"+e.join("_");s=s.replace(/([A-Z])/g,"_$1").toLowerCase(),s=s.replace(/_styles_/g,"_");const l=t.helper.i18n.get(s),n=t.helper.i18n.get(s+"_desc");if(n||l)return a=n||l,!0}),a})(d);p&&e("<div />").addClass(e.cl.info).html("<span>"+p+"</span>").appendTo(o.children("label")),n&&"object"==typeof n&&void 0!==n[l]&&(i=n[l]);const h=Array.isArray(i);if("object"==typeof i&&!1===h){const t=e("<ul />").appendTo(o);c(t,r,n[l]||null)}else{const t=e("<input />").attr("type","text").appendTo(o);h&&(i=JSON.stringify(i),t.attr(e.attr.type,"json")),t[0].value=i}})}},e.FeedbackHelper=function(t){let a=null;const s={displayed:[],opened:[],closed:[]};this.init=()=>new Promise(a=>{if(t.serviceAvailable){const s=t.helper.menu.getPath(),l=s.length>=2&&"feedback"===s[0]&&"error"===s[1]&&s[2];l&&t.elm.feedback.wrapper.addClass(e.cl.settings.feedback.onlySuggestions),d(),Promise.all([n()]).then(()=>(l&&r(s[2]),"feedback"===s[0]&&c(),e.delay(500))).then(()=>{a()})}else t.elm.feedback.form.addClass(e.cl.hidden),e("<p />").addClass(e.cl.error).html(t.helper.i18n.get("status_feedback_unavailable_desc")+"<br />").append("<a href='mailto:feedback@blockbyte.de'>feedback@blockbyte.de</a>").insertAfter(t.elm.feedback.form),a()});const l=()=>{const e=t.elm.feedback.feedback[0].offsetHeight;t.elm.feedback.suggestions.css("max-height",e+"px")},n=()=>new Promise(t=>{e.xhr(e.opts.website.feedback.suggestions).then(s=>{if(s&&s.responseText){const t=s.responseText.replace(/\{browserName\}/gi,e.browserName),l=JSON.parse(t);l&&l.suggestions&&l.controls&&(a=l)}t()})}),r=e=>{let t=[],l=!1;"general"===e?t=["not_working","webstore","system_pages"]:"filter"===e&&(t=["blacklisted_whitelisted"],l=!0),t.forEach(e=>{a&&a.suggestions&&a.suggestions[e]&&(s.displayed.push(e),i(e,a.suggestions[e],l))})},i=(s,l,n=!1)=>{if(a&&a.controls){t.helper.model.call("track",{name:"action",value:{name:"suggestion_display",value:s},always:!0});const r=e("<div />").addClass([e.cl.settings.suggestion,e.cl.hidden,e.cl.settings.feedback.absolute]).attr(e.attr.type,s).append("<strong>"+l.question.message+"</strong>").append("<div class='"+e.cl.settings.feedback.answer+"'>"+l.answer.message+"</div>").appendTo(t.elm.feedback.suggestions);e("<p />").append("<a "+e.attr.value+"='1'>"+a.controls.yes.message+"</a>").append("<a "+e.attr.value+"='0'>"+a.controls.no.message+"</a>").appendTo(r),r.data("links",l.answer.links||[]);const i=r.children("div."+e.cl.settings.feedback.answer);e.delay().then(()=>(i.css("height",i[0].offsetHeight+"px"),i.addClass([e.cl.settings.feedback.noHeight,e.cl.hidden]),e.delay(300))).then(()=>(r.css("height",r[0].offsetHeight+"px"),r.addClass(e.cl.settings.feedback.noHeight),e.delay(300))).then(()=>(r.removeClass([e.cl.settings.feedback.absolute,e.cl.settings.feedback.noHeight]),e.delay(300))).then(()=>{r.css("height","").removeClass(e.cl.hidden),t.elm.feedback.suggestions.addClass(e.cl.visible),n&&o(r)})}},o=l=>{const n=l.attr(e.attr.type);s.opened.push(n),t.helper.model.call("track",{name:"action",value:{name:"suggestion_clicked",value:n},always:!0});const r=l.children("p").html("");r.attr(e.attr.type,"answer"),l.data("links").forEach(t=>{let a=t.target;e.opts.urlAliases[e.browserName]&&e.opts.urlAliases[e.browserName][a]&&(a=e.opts.urlAliases[e.browserName][a]),e("<a />").attr("href",a).text(t.message).appendTo(r)}),l.parent()[0]!==t.elm.feedback.faq[0]&&e("<a />").attr(e.attr.value,"0").text(a.controls.close.message).appendTo(r),l.children("div."+e.cl.settings.feedback.answer).removeClass(e.cl.settings.feedback.noHeight),e.delay(300).then(()=>{l.children("div."+e.cl.settings.feedback.answer).removeClass(e.cl.hidden)})},c=()=>{t.elm.feedback.faq.children("div."+e.cl.settings.suggestion).length()>0||(a&&a.suggestions&&a.controls?(t.elm.feedback.faq.addClass(e.cl.loading),Object.entries(a.suggestions).some(([a,s])=>{if(s.question&&s.question.faq){const l=e("<div />").addClass(e.cl.settings.suggestion).attr(e.attr.type,a).append("<strong>"+s.question.faq+"</strong>").append("<div class='"+e.cl.settings.feedback.answer+"'>"+s.answer.message+"</div>").append("<p />").appendTo(t.elm.feedback.faq);l.data("links",s.answer.links||[]);const n=l.children("div."+e.cl.settings.feedback.answer);e.delay().then(()=>(n.css("height",n[0].offsetHeight+"px"),n.addClass([e.cl.settings.feedback.noHeight,e.cl.hidden]),t.elm.feedback.faq.removeClass(e.cl.hidden),e.delay(300))).then(()=>{l.css("height","").removeClass(e.cl.hidden),t.elm.feedback.faq.removeClass(e.cl.loading)})}})):t.elm.feedback.faq.addClass(e.cl.hidden))},d=async()=>{e(document).on(e.opts.events.pageChanged,e=>{e.detail.path&&"feedback"===e.detail.path[0]&&c()}),e(window).on("resize",()=>{l()},{passive:!0}),t.elm.textarea.feedbackMsg.on("mouseup",()=>{l()}).on("keyup",e=>{var t;t=e.currentTarget.value,a&&a.suggestions&&Object.entries(a.suggestions).some(([e,a])=>{let l=!1;if(a.keywords.some(e=>{if(t.search(new RegExp(e,"i"))>-1)return l=!0,!0}),l&&-1===s.displayed.indexOf(e))return s.displayed.push(e),i(e,a),!0})}),t.elm.feedback.showForm.on("click",a=>{a.preventDefault(),t.elm.feedback.wrapper.removeClass(e.cl.settings.feedback.onlySuggestions)}),e([t.elm.feedback.suggestions,t.elm.feedback.faq]).on("click","a[href]:not([href^='#'])",t=>{t.preventDefault(),e.api.tabs.create({url:e(t.currentTarget).attr("href"),active:!0})}),t.elm.feedback.suggestions.on("click","a["+e.attr.value+"]",a=>{a.preventDefault();const l=+e(a.currentTarget).attr(e.attr.value),n=e(a.currentTarget).parents("div."+e.cl.settings.suggestion).eq(0);1===l?o(n):(a=>{s.closed.push(a.attr(e.attr.type)),a.css("height",a[0].offsetHeight+"px").addClass(e.cl.hidden),e.delay(200).then(()=>(a.addClass(e.cl.settings.feedback.noHeight),e.delay(300))).then(()=>(a.remove(),e.delay())).then(()=>{0===t.elm.feedback.suggestions.children("div."+e.cl.settings.suggestion).length()&&(t.elm.feedback.suggestions.removeClass(e.cl.visible),e.delay(300).then(()=>{t.elm.feedback.wrapper.removeClass(e.cl.settings.feedback.onlySuggestions)}))})})(n)}),t.elm.feedback.faq.on("click","div."+e.cl.settings.suggestion+" > strong",t=>{const a=e(t.currentTarget).parent().eq(0);o(a)}),t.elm.feedback.uploadField.on("change",e=>{e.currentTarget.files&&p(e.currentTarget.files)}),t.elm.feedback.uploadedFiles.on("click","a."+e.cl.close,t=>{t.preventDefault(),e(t.currentTarget).parent("li").remove()}),t.elm.feedback.send.on("click",e=>{e.preventDefault(),h()})},p=a=>{if(a.length+t.elm.feedback.uploadedFiles.children("li").length()>3)window.alert(t.helper.i18n.get("settings_feedback_screenshot_error_amount",[3]));else{for(const s of a){if(!s.type.match("image"))continue;const a=new FileReader;(s.size/1024).toFixed(4)>1024?window.alert(t.helper.i18n.get("settings_feedback_screenshot_error_filesize",[s.name])):(a.onload=a=>{try{e("<li />").append("<img src='"+a.target.result+"' />").append("<span>"+s.name+"</span>").append("<a class='"+e.cl.close+"' />").appendTo(t.elm.feedback.uploadedFiles)}catch(a){}},a.readAsDataURL(s))}t.elm.feedback.uploadField[0].value=""}},h=()=>{const a=t.elm.textarea.feedbackMsg[0].value,l=t.elm.field.feedbackEmail[0].value,n=l.length>0&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l),r=a.length>0;if(n&&r){const n=+new Date,r=t.helper.template.loading().appendTo(t.elm.body);t.elm.body.addClass(e.cl.loading);let i=null;const o=[];t.elm.feedback.uploadedFiles.find("> li > img").forEach(t=>{o.push(e(t).attr("src"))});const c=t.helper.importExport.getExportConfig();c.utility&&c.utility.newtabBackground&&delete c.utility.newtabBackground,e.xhr(e.opts.website.feedback.form,{method:"POST",timeout:3e4,data:{email:l,msg:a,version:e.opts.manifest.version_name,ua:navigator.userAgent,lang:t.helper.i18n.getLanguage(),userType:t.helper.model.getUserType(),screenshots:JSON.stringify(o),config:c,suggestions:s}}).then(t=>(i=JSON.parse(t.responseText),e.delay(Math.max(0,1e3-(+new Date-n)))),()=>(i={success:!1},e.delay())).then(()=>{t.elm.body.removeClass(e.cl.loading),r.remove(),i&&i.success&&!0===i.success?(t.helper.model.call("track",{name:"action",value:{name:"feedback",value:"true"},always:!0}),t.elm.textarea.feedbackMsg[0].value="",t.elm.field.feedbackEmail[0].value="",t.elm.feedback.uploadedFiles.html(""),t.showSuccessMessage("feedback_sent_message")):e.delay().then(()=>{alert(t.helper.i18n.get("settings_feedback_send_failed"))})})}else n?r||t.elm.textarea.feedbackMsg.addClass(e.cl.error):t.elm.field.feedbackEmail.addClass(e.cl.error);e.delay(700).then(()=>{e("."+e.cl.error).removeClass(e.cl.error)})}},e.FormHelper=function(t){const a={};this.init=()=>new Promise(e=>{s(),l().then(e)});const s=()=>{t.elm.content.on("scroll",()=>{"appearance"===t.helper.menu.getPath()[0]&&Object.values(t.elm.color).forEach(e=>{e.data("picker").reposition()})})},l=()=>new Promise(s=>{let l=t.elm.formElement.length();const n=()=>{l--,0===l&&s()};t.elm.formElement.forEach(t=>{const s={elm:t,type:e(t).attr(e.attr.type),name:e(t).attr(e.attr.name),i18n:e(t).attr(e.attr.i18n)||""};s.label=e("<label />").attr(e.attr.i18n,s.i18n).insertAfter(t),e("<p />").addClass(e.cl.settings.desc).attr(e.attr.i18n,s.i18n+"_desc").insertAfter(s.label),a[s.type]?a[s.type](s).then(n):n(),t.remove()})});a.color=a=>new Promise(s=>{t.elm.color[a.name]=e("<input type='text' />").addClass(e.cl.settings.color.field).insertAfter(a.label);const l=new window.Colorpicker(t.elm.color[a.name][0],{alpha:!!e(a.elm).attr(e.attr.settings.color.alpha)}),n=e(a.elm).attr(e.attr.settings.color.suggestions);if(n){const t=JSON.parse(n),a=l.getElements().preview,s=[];t.forEach(t=>{s.push(e("<span />").addClass(e.cl.settings.suggestion).attr(e.attr.value,t).css("background-color",t).insertAfter(a))}),e(s).on("click",t=>{t.stopPropagation();const a=e(t.currentTarget).attr(e.attr.value);l.setColor(a),l.show()})}const r=s=>{let n=t.elm.body.children("div."+e.cl.settings.color.mask+"["+e.attr.name+"='"+a.name+"']");s&&l.visible&&-1!==a.name.search(/MaskColor$/)?(0===n.length()&&(n=e("<div />").addClass(e.cl.settings.color.mask).attr(e.attr.name,a.name).appendTo(t.elm.body)),n.css("background-color",s)):n.length()>0&&n.remove()};l.on("show",e=>{l.visible=!0,r(e.color)}),l.on("hide",()=>{l.visible=!1,r()}),l.on("change",e=>{t.elm.color[a.name].trigger("change"),r(e.color)}),t.elm.color[a.name].data("picker",l),s()}),a.font=a=>new Promise(s=>{t.elm.select[a.name]=e("<select />").insertAfter(a.label),e.api.fontSettings.getFontList(s=>{s.unshift({fontId:"default",displayName:t.helper.i18n.get("settings_font_family_default")}),s.forEach(s=>{0===t.elm.select[a.name].children("option[value='"+s.fontId.replace(/\'/g,"\\27")+"']").length()&&e("<option />").attr("value",s.fontId).text(s.displayName).appendTo(t.elm.select[a.name])})}),s()}),a.language=a=>new Promise(s=>{t.elm.select[a.name]=e("<select />").insertAfter(a.label),e("<option />").attr("value","default").text(t.helper.i18n.get("settings_language_default")).appendTo(t.elm.select[a.name]),t.helper.model.call("languageInfos").then(l=>{if(l&&l.infos){const s=Object.values(l.infos);s.sort((e,t)=>e.label>t.label?1:-1),s.forEach(s=>{s.available&&e("<option />").attr("value",s.name).text(s.label).appendTo(t.elm.select[a.name])})}s()})}),a.textarea=a=>new Promise(s=>{t.elm.textarea[a.name]=e("<textarea />").attr(e.attr.name,a.name).insertAfter(a.label),s()}),a.text=a.email=a=>new Promise(s=>{t.elm.field[a.name]=e("<input type='"+a.type+"' />").insertAfter(a.label),["placeholder"].forEach(s=>{const l=e(a.elm).attr(e.attr.settings.field[s]);l&&t.elm.field[a.name].attr(s,l)}),s()}),a.radio=a=>new Promise(s=>{t.elm.radio[a.name]=e("<select />").addClass(e.cl.hidden).insertAfter(a.label);const l=e("<ul />").addClass(e.cl.settings.radio.wrapper).insertAfter(t.elm.radio[a.name]);e(a.elm).children("span").forEach(s=>{const n=e(s).attr(e.attr.value),r=e("<li />").attr(e.attr.value,n).appendTo(l);e(t.helper.checkbox.get(t.elm.body,{[e.attr.name]:a.name,[e.attr.value]:n},"radio")).appendTo(r),e(s).appendTo(r),e("<option />").attr("value",n).text(n).appendTo(t.elm.radio[a.name])}),t.elm.radio[a.name].on("change",t=>{if(void 0===t.detail||"userAction"!==t.detail){const a=l.find("input[type='checkbox']["+e.attr.value+"='"+t.currentTarget.value+"']");a.length()>0&&a.parent("div").trigger("click")}}),l.find("input[type='checkbox']").on("change",s=>{t.elm.radio[a.name][0].value=e(s.currentTarget).attr(e.attr.value),t.elm.radio[a.name].trigger("change",{detail:"userAction"})}),s()}),a.range=a=>new Promise(s=>{t.elm.range[a.name]=e("<input type='range' />").insertAfter(a.label),["min","max","step"].forEach(s=>{const l=e(a.elm).attr(e.attr.settings.range[s]);l&&t.elm.range[a.name].attr(s,l)}),t.elm.range[a.name].attr("value",e(a.elm).attr(e.attr.value)||"");const l=e(a.elm).attr(e.attr.settings.range.unit)||"",n=e("<span />").insertAfter(t.elm.range[a.name]);if(t.elm.range[a.name].on("input change",s=>{const r=s.currentTarget,i=r.max||100,o=r.min||0,c=Math.round(100*(r.value-o)/(i-o)),d=t.elm.range[a.name].css("background-image");if(d&&0===d.indexOf("linear-gradient")){let s=e(r).data("backgroundTemplate");void 0===s&&(s=d.replace(/-1px/g,"{percent}"),e(r).data("backgroundTemplate",s)),t.elm.range[a.name].css("background-image",s.replace(/{percent}/g,c+"%"))}n.text(r.value+l)}),e.delay().then(()=>{t.elm.range[a.name].trigger("input")}),"1"===e(a.elm).attr(e.attr.settings.range.infinity)){const s=e("<div />").addClass(e.cl.settings.sub).insertAfter(n),l=t.helper.checkbox.get(t.elm.body).appendTo(s);e("<label />").attr(e.attr.i18n,a.i18n+"_infinity").appendTo(s),l.children("input[type='checkbox']").on("change",s=>{s.currentTarget.checked?t.elm.range[a.name].addClass(e.cl.settings.inactive):t.elm.range[a.name].removeClass(e.cl.settings.inactive)}),t.elm.range[a.name].data("infinityCheckbox",l)}s()}),a.select=a=>new Promise(s=>{t.elm.select[a.name]=e("<select />").insertAfter(a.label),e(a.elm).children("span").forEach(s=>{const l=e(s).attr(e.attr.i18n),n=e("<option />").attr({value:e(s).attr(e.attr.value)}).html(e(s).html()).appendTo(t.elm.select[a.name]);l&&n.attr(e.attr.i18n,l)}),s()}),a.checkbox=a=>new Promise(s=>{const l=e(a.elm).attr(e.attr.style)||"default";t.elm.checkbox[a.name]=t.helper.checkbox.get(t.elm.body,{[e.attr.name]:a.name},"checkbox",l).insertAfter(a.label),s()})},e.ImportExportHelper=function(t){this.init=async()=>{"default"!==t.helper.model.getUserType()?(r(),l()):s()},this.getExportConfig=()=>{const e=Object.assign({},t.helper.model.getAllData());return"default"!==t.helper.model.getUserType()?e.utility={customCss:e.utility.customCss||"",newtabBackground:e.utility.newtabBackground||""}:delete e.utility,e};const a=()=>{window.alert(t.helper.i18n.get("settings_import_failed"))},s=()=>{t.addNoPremiumText(t.elm.importExport.content.children("div:last-child")),["import","export"].forEach(a=>{t.elm.buttons[a].addClass(e.cl.settings.inactive)})},l=async()=>{t.elm.buttons.import.children("input[type='file']").on("change",e=>{e.preventDefault();const t=e.currentTarget;if(t.files&&t.files[0]&&t.files[0].name.search(/\.bookmark_sidebar$/)>-1){const e=new FileReader;e.onload=e=>{try{const t=JSON.parse(e.target.result);n(t)}catch(e){a()}},e.readAsText(t.files[0])}else a()})},n=s=>{s.behaviour&&s.appearance&&s.newtab?e.api.storage.sync.set({behaviour:s.behaviour,appearance:s.appearance,newtab:s.newtab},()=>{const a=Object.assign({},t.helper.model.getAllData());a.utility=a.utility||{},["customCss","newtabBackground"].forEach(e=>{let l="";"default"!==t.helper.model.getUserType()&&s.utility&&s.utility[e]&&(l=s.utility[e]),a.utility[e]=l}),e.api.storage.local.set({utility:a.utility},()=>{t.helper.model.call("reinitialize"),t.showSuccessMessage("import_saved"),e.delay(1500).then(()=>{location.reload(!0)})})}):a()},r=async()=>{t.elm.buttons.export.attr({href:"data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(this.getExportConfig())),download:i()})},i=()=>{const e=new Date;return"config_"+(e.getDate()+"-"+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"][e.getMonth()]+"-"+e.getFullYear())+".bookmark_sidebar"}},e.InfosHelper=function(t){this.init=async()=>new Promise(e=>{Promise.all([a(),s()]).then(e)});const a=()=>new Promise(a=>{e.api.management.getPermissionWarningsByManifest(JSON.stringify(e.opts.manifest),s=>{const l={};[l.contentscript,l.bookmarks]=s,Object.entries(l).forEach(([a,s])=>{t.elm.infos.permissionsWrapper.find("h3["+e.attr.name+"='"+a+"']").text(s)}),a()})}),s=async()=>{e.api.storage.sync.get(["shareInfo"],e=>{e.shareInfo&&(e.shareInfo.config&&t.elm.checkbox.shareConfig.trigger("click"),e.shareInfo.activity&&t.elm.checkbox.shareActivity.trigger("click")),t.elm.infos.shareInfoWrapper.find("input[type='checkbox']").on("change",()=>{t.helper.model.call("updateShareInfo",{config:t.helper.checkbox.isChecked(t.elm.checkbox.shareConfig),activity:t.helper.checkbox.isChecked(t.elm.checkbox.shareActivity)}).then(()=>{t.showSuccessMessage("saved_share_userdata")})})})}},e.MenuHelper=function(t){let a=!1,s=null,l=null,n=null;this.init=()=>new Promise(a=>{s=e("<ul />").appendTo(t.elm.aside.children("nav"));let l=t.elm.content.children("div."+e.cl.settings.tabs.content).length();const n=()=>{l--,0===l&&r().then(()=>{a()})};t.elm.content.children("div."+e.cl.settings.tabs.content).forEach(a=>{const l=e(a).attr(e.attr.name),r=e("<li />").attr(e.attr.name,l).html("<a href='#'>"+t.helper.i18n.get("settings_menu_"+l)+"</a>").appendTo(s),i=e(a).children("div["+e.attr.name+"]");if(i.length()>0){const a=e("<ul />").appendTo(r);i.forEach(s=>{const n=e(s).attr(e.attr.name),r=e(s).attr(e.attr.src),i=e("<li />").attr(e.attr.name,n).html("<a href='#'>"+t.helper.i18n.get("settings_menu_"+l+"_"+n)+"</a>").appendTo(a);r&&i.attr(e.attr.src,r)}),e.delay(500).then(()=>{a.children("li").forEach(t=>{e(t).data("height",t.scrollHeight)}),n()})}else n()}),i()}),this.getPath=()=>l,this.addBreadcrumb=a=>{t.elm.content[0].scrollTop=0,a.depth&&l.length>=a.depth?(l[a.depth-1]=a.alias,t.elm.headline.children("span").forEach((t,s)=>{s>=a.depth-1&&e(t).remove()})):l.push(a.alias),t.elm.headline.append("<span>"+a.label+"</span>")};const r=()=>new Promise(t=>{const a=location.hash?location.hash.substr(1):null;a?c(...a.split("_")):s.find("a").eq(0).trigger("click"),e.delay(300).then(t)}),i=()=>{s.find("a").on("click",a=>{a.preventDefault();const s=e(a.currentTarget).parent("li"),l=s.attr(e.attr.name),n=s.attr(e.attr.src);if(n)t.helper.model.call("openLink",{hrefName:n,newTab:!0,params:{lang:t.helper.i18n.getLanguage()}});else if(s.parents("li").length()>0){const t=s.parent("ul").parent("li").attr(e.attr.name);c(t,l)}else c(l)}),t.elm.headline.on("click","span",t=>{const a=e(t.currentTarget).prevAll().length();c(...l.slice(0,a+1))}),e(window).on("popstate",()=>{r()})},o=()=>{const a=this.getPath(),s=[t.elm.content.children("div."+e.cl.settings.tabs.content+"["+e.attr.name+"='"+a[0]+"']")];t.elm.header.attr(e.attr.type,a[0]),a[1]&&s.unshift(s[0].children("div["+e.attr.name+"='"+a[1]+"']")),["save","restore"].forEach(a=>{s.some(s=>{const l=s.attr(e.attr.settings[a]);if(t.elm.buttons[a].addClass(e.cl.hidden),l)return"false"!==l&&t.elm.buttons[a].html("true"===l?"":t.helper.i18n.get(l)).removeClass(e.cl.hidden),!0})})},c=(...r)=>new Promise(i=>{if(a)i();else{a=!0;let c=r.length;const d=[];let p=s.children("li["+e.attr.name+"='"+r[0]+"']"),h=t.elm.content.children("div."+e.cl.settings.tabs.content+"["+e.attr.name+"='"+r[0]+"']");1===c&&h.find("> div["+e.attr.name+"]").length()>0&&(p.hasClass(e.cl.settings.incomplete)&&"language"===r[0]?r.push(h.find("> div["+e.attr.name+"='translate']").eq(0).attr(e.attr.name)):r.push(h.find("> div["+e.attr.name+"]").eq(0).attr(e.attr.name)),c++),c>=2&&"sidebar"===r[0]&&"toggle"===r[1]&&"area"===r[2]&&t.elm.buttons.toggleAreaOpen.trigger("click");const g=r.join("_");(()=>{s.find("li").removeClass(e.cl.active);const a=t.elm.content.children("div."+e.cl.settings.tabs.content);a.removeClass(e.cl.active),a.children("div["+e.attr.name+"]").removeClass(e.cl.active),s.find("ul").css("height","")})();for(let t=1;t<=c;t++){const a=p.parent("ul");if(a&&a.length()>0){p.addClass(e.cl.active),h.addClass(e.cl.active),d.push(p.children("a").html());let s=0;a.children("li:not(."+e.cl.hidden+")").forEach(t=>{s+=e(t).data("height")||0}),s>0&&a.css("height",s+"px"),t<c&&(p=p.find("> ul > li["+e.attr.name+"='"+r[t]+"']"),h=h.find("> div["+e.attr.name+"='"+r[t]+"']"))}}t.elm.headline.html("<span>"+d.join("</span><span>")+"</span>"),t.elm.body.attr(e.attr.type,g),location.hash=g,n=h,l=r,t.elm.content[0].scrollTop=0,o();const m="padding-"+(t.helper.i18n.isRtl()?"left":"right");t.elm.header.css(m,""),t.elm.content.css(m,""),document.dispatchEvent(new CustomEvent(e.opts.events.pageChanged,{detail:{path:r},bubbles:!0,cancelable:!1})),e.delay().then(()=>{a=!1,i()})}})},e.NewtabHelper=function(t){let a=!1;this.init=async()=>{s(),t.elm.newtab.content.find("div."+e.cl.settings.newtab.hideable).addClass(e.cl.hidden),["override","autoOpen","focusOmnibox"].forEach(s=>{!0===t.helper.model.getData("n/"+s)?"override"===s?e.api.permissions.contains({permissions:["tabs","topSites"]},e=>{e&&t.elm.checkbox[s].trigger("click"),a=!0}):t.elm.checkbox[s].trigger("click"):"override"===s&&(a=!0)}),["website"].forEach(e=>{t.elm.field[e][0].value=t.helper.model.getData("n/"+e)})},this.save=()=>new Promise(a=>{e.api.storage.sync.get(["newtab"],s=>{const l=s.newtab||{};["override","autoOpen","focusOmnibox"].forEach(e=>{l[e]=t.helper.checkbox.isChecked(t.elm.checkbox[e])}),["website"].forEach(e=>{l[e]=t.elm.field[e][0].value.trim()}),l.website&&l.website.length&&0!==l.website.search(/^\w+\:\/\//)&&(l.website="http://"+l.website),e.api.storage.sync.set({newtab:l},a)})});const s=()=>{t.elm.checkbox.override.children("input[type='checkbox']").on("change",()=>{let s=t.helper.checkbox.isChecked(t.elm.checkbox.override);const l=t.elm.newtab.content.find("div."+e.cl.settings.newtab.hideable);s?!0===a?e.api.permissions.request({permissions:["tabs","topSites","history"]},a=>{a||(t.elm.checkbox.override.trigger("click"),s=!1),s?l.removeClass(e.cl.hidden):l.addClass(e.cl.hidden)}):l.removeClass(e.cl.hidden):l.addClass(e.cl.hidden)})}},e.PremiumHelper=function(t){const a={};this.init=async()=>{s(),l()};const s=()=>{t.elm.premium.wrapper.hasClass(e.cl.active)&&n();const s=t.elm.premium.wrapper.children("section["+e.attr.type+"='intro']");"premium"===t.helper.model.getUserType()?(e("<span />").attr(e.attr.type,"activated").text(t.helper.i18n.get("premium_already_activated")).appendTo(s),t.helper.model.call("licenseKey").then(a=>{a&&a.licenseKey&&e("<span />").attr(e.attr.type,"key").append("<strong>"+t.helper.i18n.get("premium_license_key")+":</strong>").append("<span>"+a.licenseKey+"</span>").appendTo(s)})):(t.elm.aside.find("li["+e.attr.name+"='premium']").addClass(e.cl.settings.inactive),a.linkPremium=e("<a />").attr(e.attr.type,"premium").text(t.helper.i18n.get("premium_get_now")).appendTo(s),a.showLicenseField=e("<a />").attr(e.attr.type,"activate").text(t.helper.i18n.get("premium_show_license_input")).appendTo(s),a.licenseField=e("<div />").attr(e.attr.type,"licenseKey").css("display","none").append("<strong>"+t.helper.i18n.get("premium_license_key")+"</strong>").append("<input type='text' />").append("<button type='submit'>"+t.helper.i18n.get("premium_activate")+"</button>").appendTo(s))},l=()=>{e(document).on(e.opts.events.pageChanged,e=>{e.detail.path&&"premium"===e.detail.path[0]&&n()}),a.linkPremium&&a.linkPremium.on("click",a=>{a.preventDefault(),e.api.tabs.create({url:e.opts.website.premium.checkout+"?lang="+t.helper.i18n.getLanguage()})}),a.showLicenseField&&a.showLicenseField.on("click",t=>{t.preventDefault(),a.licenseField.css("display","block"),e.delay(100).then(()=>{a.licenseField.addClass(e.cl.visible)})}),a.licenseField&&a.licenseField.children("button").on("click",s=>{s.preventDefault();const l=t.helper.template.loading().appendTo(t.elm.body);t.elm.body.addClass(e.cl.loading);let n=a.licenseField.children("input[type='text']")[0].value;n=n.replace(/\s/g,""),Promise.all([t.helper.model.call("activatePremium",{licenseKey:n}),e.delay(1e3)]).then(([a])=>{t.elm.body.removeClass(e.cl.loading),l.remove(),a&&a.success?t.showSuccessMessage("premium_activated"):e.delay(100).then(()=>{alert(a.message||t.helper.i18n.get("settings_premium_invalid_key"))})})})},n=()=>{t.elm.premium.wrapper.find("img["+e.attr.src+"]").forEach(t=>{const a=e(t),s=a.attr(e.attr.src);a.removeAttr(e.attr.src),a.attr("src",s),e.delay().then(()=>{a.addClass(e.cl.visible)})})}},e.SidebarHelper=function(t){this.init=async()=>{n(),l(),s(),a(),["dirAccordion","preventPageScroll","reopenSidebar","preventWindowed","tooltipAdditionalInfo","rememberOpenStatesSubDirectories"].forEach(e=>{!0===t.helper.model.getData("b/"+e)&&t.elm.checkbox[e].trigger("click")}),t.elm.select.language[0].value=t.helper.i18n.getLanguage(),["visibility","openAction","sidebarPosition","linkAction","rememberState","newTab","newTabPosition","tooltipContent"].forEach(e=>{t.elm.select[e][0].value=t.helper.model.getData("b/"+e),t.elm.select[e].trigger("change")}),["openDelay","scrollBarHide","closeTimeout","tooltipDelay"].forEach(e=>{const a=t.helper.model.getData("b/"+e);if(-1===a){const a=t.elm.range[e].data("infinityCheckbox");a&&a.length()>0&&a.trigger("click")}t.elm.range[e][0].value=a,t.elm.range[e].trigger("change")});const e=t.helper.menu.getPath();e.length>=2&&"sidebar"===e[0]&&"toggle"===e[1]&&"area"===e[2]&&t.elm.buttons.toggleAreaOpen.trigger("click")},this.save=()=>new Promise(a=>{e.api.storage.sync.get(["behaviour","language"],s=>{if(s.behaviour=s.behaviour||{},s.behaviour.toggleArea={},s.behaviour.blacklist=[],s.behaviour.whitelist=[],["width","height","top","widthWindowed"].forEach(e=>{s.behaviour.toggleArea[e]=t.elm.range["toggleArea_"+e][0].value}),["visibility","openAction","sidebarPosition","linkAction","rememberState","newTab","newTabPosition","tooltipContent"].forEach(e=>{s.behaviour[e]=t.elm.select[e][0].value}),["openDelay","scrollBarHide","closeTimeout","tooltipDelay"].forEach(a=>{let l=-1;!1===t.elm.range[a].hasClass(e.cl.settings.inactive)&&(l=t.elm.range[a][0].value),s.behaviour[a]=l}),["dirAccordion","preventPageScroll","reopenSidebar","preventWindowed","tooltipAdditionalInfo","rememberOpenStatesSubDirectories"].forEach(e=>{s.behaviour[e]=t.helper.checkbox.isChecked(t.elm.checkbox[e])}),"blacklist"===s.behaviour.visibility||"whitelist"===s.behaviour.visibility){const e=t.elm.textarea.visibilityFilter[0].value;s.behaviour[s.behaviour.visibility]=e.split(/\n+/),""===s.behaviour[s.behaviour.visibility][0]&&(s.behaviour.visibility="always")}let l=t.elm.select.language[0].value;l===t.helper.i18n.getUILanguage()&&(l="default"),e.api.storage.sync.set({behaviour:s.behaviour,language:l},()=>{s&&s.language&&s.language===l||e.delay(1500).then(()=>{location.reload(!0)}),a()})})});const a=()=>{t.elm.textarea.visibilityFilter.attr("placeholder","example.com/*\n*.example.com/*"),t.elm.sidebar.filterExplanation.find("> ul > li").forEach(t=>{const a=e(t).text();e(t).html(a.replace(/(?<!\/)\*/g,"<em>*</em>"))}),t.elm.select.visibility.on("change",a=>{const s=a.currentTarget.value;if("always"===s)t.elm.sidebar.filterExplanation.addClass(e.cl.hidden),t.elm.sidebar.filterPatters.addClass(e.cl.hidden);else if(("blacklist"===s||"whitelist"===s)&&(t.elm.sidebar.filterExplanation.removeClass(e.cl.hidden),t.elm.sidebar.filterPatters.removeClass(e.cl.hidden),0===t.elm.textarea.visibilityFilter[0].value.length)){const e=t.helper.model.getData("b/"+s);t.elm.textarea.visibilityFilter[0].value=e.join("\n")}})},s=()=>{const e=t.helper.model.getData("b/toggleArea");["width","height","top","widthWindowed"].forEach(a=>{t.elm.range["toggleArea_"+a][0].value=e[a],t.elm.range["toggleArea_"+a].trigger("change")})},l=async()=>{const a=t.elm.body.children("div."+e.cl.settings.toggleArea.modal),l=a.children("div."+e.cl.settings.toggleArea.preview),n=l.children("div");e([t.elm.range.toggleArea_width,t.elm.range.toggleArea_height,t.elm.range.toggleArea_top]).on("change input",a=>{const s=+t.elm.range.toggleArea_width[0].value,r=+t.elm.range.toggleArea_height[0].value,i=+t.elm.range.toggleArea_top[0].value;if(r+i>100){let e=null;a.currentTarget===t.elm.range.toggleArea_height[0]?e=i-(r+i-100):a.currentTarget===t.elm.range.toggleArea_top[0]&&(e=100-r),null!==e&&(t.elm.range.toggleArea_top[0].value=e,t.elm.range.toggleArea_top.trigger("change"))}else l.css("width",19+s+"px"),n.css({height:r+"%",top:i+"%"}),100===r?n.addClass(e.cl.settings.toggleArea.fullHeight):n.removeClass(e.cl.settings.toggleArea.fullHeight)}),t.elm.buttons.toggleAreaOpen.on("click",s=>{s.preventDefault(),e.delay(100).then(()=>{a.attr(e.attr.type,t.elm.select.sidebarPosition[0].value),t.elm.body.addClass(e.cl.settings.showModal)})}),t.elm.buttons.toggleAreaSave.on("click",e=>{e.preventDefault(),t.elm.buttons.save.trigger("click"),t.elm.body.trigger("click")}),t.elm.buttons.toggleAreaCancel.on("click",a=>{a.preventDefault(),t.elm.body.trigger("click"),e.delay(500).then(()=>{s()})}),t.elm.body.on("click",a=>{const s=e(a.target);n.hasClass(e.cl.settings.toggleArea.dragging)||s.hasClass(e.cl.settings.toggleArea.modal)||0!==s.parents("div."+e.cl.settings.toggleArea.modal).length()||t.elm.body.removeClass(e.cl.settings.showModal)}),n.on("mousedown",t=>{n.addClass([e.cl.settings.toggleArea.dragged,e.cl.settings.toggleArea.dragging]),n.data("pos",{start:n[0].offsetTop,y:t.pageY})}),t.elm.body.on("mouseup",()=>{e.delay(0).then(()=>{n.removeClass(e.cl.settings.toggleArea.dragging)})}).on("mousemove",a=>{if(n.hasClass(e.cl.settings.toggleArea.dragging)&&1===a.which){const e=n.data("pos");t.elm.range.toggleArea_top[0].value=(e.start+a.pageY-e.y)/l[0].offsetHeight*100,t.elm.range.toggleArea_top.trigger("change")}},{passive:!0})},n=async()=>{t.elm.select.openAction.on("change",a=>{const s=t.elm.aside.find("li["+e.attr.name+"='indicator']");"contextmenu"===a.currentTarget.value||"mousedown"===a.currentTarget.value?s.removeClass(e.cl.hidden):s.addClass(e.cl.hidden);const l=t.elm.buttons.toggleAreaOpen.parent("div");"icon"===a.currentTarget.value?l.addClass(e.cl.hidden):l.removeClass(e.cl.hidden)}),t.elm.select.rememberState.on("change",a=>{"nothing"===a.currentTarget.value?t.elm.sidebar.rememberOpenStatesSubDirectories.addClass(e.cl.hidden):t.elm.sidebar.rememberOpenStatesSubDirectories.removeClass(e.cl.hidden)}),t.elm.buttons.keyboardShortcut.on("click",e=>{e.preventDefault(),t.helper.model.call("openLink",{href:"chrome://extensions/shortcuts",newTab:!0,active:!0})})}},e.TranslationHelper=function(t){let a={},s=[];const l={},n={};this.init=()=>new Promise(e=>{i().then(()=>{c(),t.serviceAvailable?o().then(()=>{d(),b();const e=t.helper.menu.getPath();e&&"translate"===e[1]&&p()}).catch(()=>{h()}):h(),e()})}),this.submit=()=>new Promise(a=>{const s=t.elm.translation.langvars.data("lang");if(s){const a=+new Date,l=t.helper.template.loading().appendTo(t.elm.body);t.elm.body.addClass(e.cl.loading);const n={};t.elm.translation.wrapper.find("div."+e.cl.settings.translation.category+"["+e.attr.settings.translation.language+"='"+s+"']").forEach(t=>{e(t).find("textarea").forEach(t=>{let a=t.value;if(a&&a.trim().length>0){const s=e(t).data("initial");if(a=a.trim(),a!==s){const s=e(t).data("name");n[s]=a}}})});let i=0;e.xhr(e.opts.website.translation.submit,{method:"POST",data:{lang:s,vars:n}}).then(()=>r(s,n)).then(t=>(i=t.translatedAmount,e.delay(Math.max(0,1e3-(+new Date-a))))).then(()=>(l.remove(),t.showSuccessMessage("translation_submit_message"),e.delay(1500))).then(()=>{t.elm.body.removeClass(e.cl.loading),"premium"!==t.helper.model.getUserType()&&i>=30&&!1===t.helper.model.getData("u/translationThanked")?x(s,i):w(s)})}else a()});const r=(t,a)=>new Promise(s=>{const l="translated_"+t;e.api.storage.local.get([l],t=>{let n=[];t&&t[l]&&(n=t[l]),Object.keys(a).forEach(e=>{-1===n.indexOf(e)&&n.push(e)});const r=n.length;r>0&&e.api.storage.local.set({[l]:n},()=>{e.api.runtime.lastError,s({translatedAmount:r})})})}),i=()=>new Promise(l=>{e.api.storage.sync.get(["translationInfo"],e=>{s=e.translationInfo||[],t.helper.model.call("languageInfos").then(e=>{a=e.infos,l()})})}),o=()=>new Promise((s,l)=>{t.elm.translation.overview.children("div."+e.cl.settings.boxWrapper).html(""),e.xhr(e.opts.website.translation.info).then(l=>{const n=JSON.parse(l.responseText);if(n&&n.languages){const s=t.helper.i18n.getLanguage();n.languages.sort((e,t)=>t.varsAmount!==e.varsAmount?t.varsAmount-e.varsAmount:a[e.name]&&a[t.name]?a[e.name].label>a[t.name].label?1:-1:1);const l=Object.assign({},a);n.languages.forEach(r=>{if(a[r.name]){const i=r.varsAmount/n.varsAmount*100;if(i>=15){delete l[r.name];let o="draft";const c=Math.floor(i);a[r.name].available&&(o=n.varsAmount>r.varsAmount?"incomplete":"released");const d=e("<div />").data("lang",r.name).addClass(e.cl.settings.box).attr(e.attr.settings.translation.releaseStatus,o).append("<a href='#' class='"+e.cl.settings.translation.edit+"'></a>").append("<strong>"+a[r.name].label+"</strong>").append("<div class="+e.cl.settings.translation.progress+" "+e.attr.value+"='"+c+"%'><div style='width:"+c+"%'></div></div>").append("<span title='"+t.helper.i18n.get("settings_translation_status_"+o)+"'></span>").appendTo(t.elm.translation.overview.children("div."+e.cl.settings.boxWrapper));s===r.name&&(g(r.categories,n.categories)&&(t.elm.aside.find("li["+e.attr.name+"='language']").addClass(e.cl.settings.incomplete),e("<span />").attr("title",t.helper.i18n.get("settings_translation_incomplete_info")).appendTo(t.elm.aside.find("li["+e.attr.name+"='language'] > a"))),d.addClass(e.cl.settings.translation.mark))}}}),m(l)}t.elm.translation.overview.addClass(e.cl.visible),s()},()=>{l()})}),c=()=>{t.elm.translation.goto.on("click",a=>{a.preventDefault(),t.elm.aside.find("li["+e.attr.name+"='translate'] > a").trigger("click")}),t.elm.checkbox.translationInfo.children("input").on("change input",a=>{if(t.elm.translation.langvars.hasClass(e.cl.loading))return;const l=a.currentTarget.checked,n=t.elm.translation.langvars.data("lang"),r=s.indexOf(n);l&&-1===r?s.push(n):!1===l&&-1!==r&&s.splice(r,1),e.api.storage.sync.set({translationInfo:s}),t.showSuccessMessage("saved_message")}),e(document).on(e.opts.events.pageChanged,e=>{e.detail.path&&"translate"===e.detail.path[1]&&(e.detail.path[2]?w(e.detail.path[2]):t.serviceAvailable?p():h())})},d=()=>{t.elm.translation.overview.find("select."+e.cl.settings.translation.select).on("change",e=>{w(e.currentTarget.value)}),t.elm.translation.overview.find("div."+e.cl.settings.box).on("click",t=>{t.preventDefault();const a=e(t.currentTarget).data("lang");a&&w(a)})},p=()=>{t.elm.translation.wrapper.find("."+e.cl.visible).removeClass(e.cl.visible),t.elm.translation.overview.addClass(e.cl.visible),t.elm.buttons.save.addClass(e.cl.hidden)},h=()=>{t.elm.translation.unavailable.addClass(e.cl.visible),t.elm.translation.wrapper.hasClass(e.cl.active)&&t.elm.buttons.save.addClass(e.cl.hidden)},g=(e,t)=>{let a=!1;return Object.keys(e).some(s=>{if(t[s].total>e[s])return a=!0,!0}),a},m=s=>{const l=e("<div />").addClass(e.cl.settings.box).appendTo(t.elm.translation.overview.children("div."+e.cl.settings.boxWrapper)),n=e("<select class='"+e.cl.settings.translation.select+"' />").appendTo(l);e("<option value='' />").text(t.helper.i18n.get("settings_translation_add_language")).appendTo(n);const r=[];Object.keys(s).forEach(t=>{r.push({elm:e("<option value='"+t+"' />").text(a[t].label),label:a[t].label})}),r.sort((e,t)=>e.label>t.label?1:-1),r.forEach(e=>{e.elm.appendTo(n)})},u=a=>new Promise(s=>{const n=e=>{e&&void 0===l[a]&&(l[a]=e),s(e)};l[a]?n(l[a]):e.xhr(e.opts.website.translation.langvars,{method:"POST",data:{lang:a}}).then(e=>{const s=JSON.parse(e.responseText);if(s&&Object.getOwnPropertyNames(s).length>0){const e=t.helper.i18n.getDefaultLanguage(),l={[a]:s};a!==e?u(e).then(t=>{l.default=t[e],n(l)}):n(l)}else n(null)})}),b=()=>{t.elm.translation.wrapper.on("click","a."+e.cl.settings.translation.back,t=>{t.preventDefault();const a=e(t.currentTarget).parents("div."+e.cl.settings.translation.category).eq(0).attr(e.attr.settings.translation.language);w(a)}),t.elm.translation.wrapper.on("click","a."+e.cl.settings.translation.goto,t=>{t.preventDefault();const a=e(t.currentTarget).attr(e.attr.value),s=e(t.currentTarget).parent("header").next("ul");f(a,s)}),t.elm.translation.langvars.on("click","div."+e.cl.settings.box,t=>{t.preventDefault();const a=e(t.currentTarget),s=a.data("lang"),l=a.children("strong").text(),n=a.data("info");v(s,l,n)}),t.elm.translation.thanks.on("click","a",a=>{a.preventDefault();const s=t.elm.translation.thanks.data("lang");if(e(a.currentTarget).hasClass(e.cl.close))w(s);else{const l=t.elm.field.translationEmail[0].value,n=t.elm.translation.thanks.data("translatedAmount");e(a.currentTarget).addClass(e.cl.loading);const r=t.helper.template.loading().appendTo(a.currentTarget);Promise.all([e.xhr(e.opts.website.translation.submit,{method:"POST",data:{lang:s,email:l,translatedAmount:n}}),e.delay(500)]).then(()=>(r.remove(),e(a.currentTarget).removeClass(e.cl.loading),e.delay(500))).then(()=>{w(s)})}})},v=(a,s,l)=>{let r=t.elm.translation.wrapper.find("div."+e.cl.settings.translation.category+"["+e.attr.name+"='"+s+"']["+e.attr.settings.translation.language+"='"+a+"']");if(0===r.length()){const i=a+"_"+s,o=t.helper.i18n.getDefaultLanguage();r=e("<div />").attr(e.attr.name,s).attr(e.attr.settings.translation.language,a).addClass(e.cl.settings.translation.category).appendTo(t.elm.translation.wrapper);const c=e("<header />").appendTo(r),d=e("<ul />").appendTo(r);l.category.vars.forEach((s,n)=>{if(!1===s.translatable&&a!==o)return;const r=e("<li />").append("<div />").append("<div />").appendTo(d);let i="";a===o?i=s.value||"":l.defaults&&l.defaults.vars&&l.defaults.vars[n]&&(i=l.defaults.vars[n].value||""),e("<span />").html(i).appendTo(r.children("div").eq(0));const c=e("<footer />").addClass(e.cl.sidebar.breadcrumb).data("name",s.label).html("<label>"+t.helper.i18n.get("settings_translation_variable_name")+":</label><div />").appendTo(r.children("div").eq(0));s.label.split(" - ").forEach(t=>{e("<span />").text(t).appendTo(c.children("div"))});const p=s.value||"";e("<textarea />").data({initial:p,name:s.name}).text(p).appendTo(r.children("div").eq(1)),0===p.length&&r.addClass(e.cl.settings.translation.empty)}),k(r),e("<a />").text(t.helper.i18n.get("settings_translation_back_to_overview")).addClass(e.cl.settings.translation.back).appendTo(c),n[i].total!==n[i].filled&&(e("<a />").addClass(e.cl.settings.translation.goto).attr(e.attr.value,"down").appendTo(c),e("<a />").addClass(e.cl.settings.translation.goto).attr(e.attr.value,"up").appendTo(c)),e("<span />").addClass(e.cl.settings.translation.amountInfo).html("<span>"+n[i].filled+"</span>&thinsp;/&thinsp;"+n[i].total).appendTo(c),c.css("top","-35px")}t.elm.translation.langvars.removeClass(e.cl.visible),r.addClass(e.cl.visible),t.helper.menu.addBreadcrumb({label:s,alias:s,depth:4}),e.delay(0).then(()=>{const t=r.children("ul");r.find("a."+e.cl.settings.translation.goto).length()>0&&f("down",t),y(a,t)})},f=(a,s)=>{let l=null;if(s.find("li."+e.cl.hover).length()>0?l="up"===a?s.find("li."+e.cl.hover).eq(0).prevAll("li."+e.cl.settings.translation.empty):s.find("li."+e.cl.hover).eq(0).nextAll("li."+e.cl.settings.translation.empty):"down"===a&&(l=s.find("li."+e.cl.settings.translation.empty)),l&&l.length()>0){const e=l.eq(0);t.elm.content[0].scrollTop=Math.max(0,e[0].offsetTop-80),e.find("textarea")[0].focus()}},y=(a,s)=>{if(a!==t.helper.i18n.getDefaultLanguage()&&t.helper.model.getData("u/translationHelp")){let a=null;a="TEXTAREA"===document.activeElement.tagName?e(document.activeElement).parents("li").eq(0):s.children("li").eq(0),a.addClass(e.cl.settings.translation.mark);const l=a.find("footer."+e.cl.sidebar.breadcrumb).data("name");e("<span />").addClass(e.cl.settings.desc).html(t.helper.i18n.get("settings_translation_help",["<strong>"+l+"</strong>"])).prependTo(a),t.helper.model.setData({"u/translationHelp":!1})}},k=t=>{t.find("textarea").on("change input",a=>{const s=e(a.currentTarget),l=a.currentTarget.value,r=t.attr(e.attr.name),i=t.attr(e.attr.settings.translation.language);l?s.parents("li").eq(0).removeClass(e.cl.settings.translation.empty):s.parents("li").eq(0).addClass(e.cl.settings.translation.empty),s.css("height",""),s.css("height",Math.max(a.currentTarget.scrollHeight,70)+"px");let o=0;t.find("textarea").forEach(e=>{e.value&&e.value.trim().length>0&&o++}),n[i+"_"+r].filled=o,t.find("span."+e.cl.settings.translation.amountInfo+" > span").text(o)}).on("focus",a=>{t.find("li").removeClass(e.cl.hover),e(a.currentTarget).parents("li").eq(0).addClass(e.cl.hover)}).on("blur",t=>{const a=e(t.currentTarget).parents("li").eq(0);e.delay(200).then(()=>{a.removeClass(e.cl.hover)})}),e.delay().then(()=>{t.find("textarea").trigger("change")})},x=(a,s)=>{t.helper.model.setData({"u/translationThanked":!0}),t.elm.translation.wrapper.find("div."+e.cl.settings.translation.category).removeClass(e.cl.visible),t.elm.translation.langvars.removeClass(e.cl.visible),t.elm.buttons.save.removeClass(e.cl.hidden),t.elm.translation.thanks.addClass(e.cl.visible).data({lang:a,translatedAmount:s})},w=l=>{t.helper.menu.addBreadcrumb({label:a[l].label,alias:l,depth:3}),t.elm.translation.langvars.data("lang",l),t.elm.translation.langvars.find("div."+e.cl.settings.boxWrapper).html(""),t.elm.translation.wrapper.find("div."+e.cl.settings.translation.category).removeClass(e.cl.visible),t.elm.buttons.save.removeClass(e.cl.hidden),t.elm.translation.thanks.removeClass(e.cl.visible),t.elm.translation.overview.removeClass(e.cl.visible),t.elm.translation.langvars.addClass([e.cl.visible,e.cl.loading]);const r=t.helper.template.loading().appendTo(t.elm.translation.langvars),i=t.helper.i18n.getDefaultLanguage();t.helper.checkbox.isChecked(t.elm.checkbox.translationInfo)!==(-1!==s.indexOf(l))&&t.elm.checkbox.translationInfo.trigger("click"),u(l).then(a=>{if(a){const s=a[l];Object.keys(s).forEach(r=>{const o=e("<div />").addClass(e.cl.settings.box).data("lang",l).data("info",{category:s[r],defaults:a.default?a.default[r]:null}).append("<strong>"+r+"</strong>").appendTo(t.elm.translation.langvars.children("div."+e.cl.settings.boxWrapper)),c=l+"_"+r;void 0===n[c]&&(n[c]={total:s[r].vars.length,filled:0},l!==i&&(n[c].total-=s[r].nonTranslatable),s[r].vars.forEach(e=>{e.value&&n[c].filled++})),s[r].required&&e("<span />").addClass(e.cl.settings.translation.requiredInfo).text("("+t.helper.i18n.get("settings_translation_required_category")+")").appendTo(o),e("<span />").addClass(e.cl.settings.translation.amountInfo).html("<span>"+n[c].filled+"</span>&thinsp;/&thinsp;"+n[c].total).appendTo(o),n[c].total>n[c].filled&&o.addClass(e.cl.settings.incomplete)})}else p();t.elm.translation.langvars.removeClass(e.cl.loading),r.remove()})}};(new function(){this.elm={body:e("body"),title:e("head > title"),aside:e("body > section#wrapper > aside"),content:e("body > section#wrapper > main"),header:e("body > header"),headline:e("body > header > h1"),advanced:{toggle:e("div.advanced > h3"),container:e("div.advanced > div")},buttons:{save:e("body > header > menu > li > button.save"),restore:e("body > header > menu > li > button.restore"),keyboardShortcut:e("div.tab[data-name='sidebar'] a.keyboardShortcut"),toggleAreaOpen:e("div.tab[data-name='sidebar'] div.toggleAreaDesc > a.button"),toggleAreaSave:e("div.toggleAreaModal a.save"),toggleAreaCancel:e("div.toggleAreaModal a.cancel"),import:e("body a.import"),export:e("body a.export")},sidebar:{filterPatters:e("div.tab[data-name='sidebar'] div[data-name='filter'] div.patterns"),filterExplanation:e("div.tab[data-name='sidebar'] div[data-name='filter'] div.patternExplanation"),rememberOpenStatesSubDirectories:e("div.tab[data-name='sidebar'] div.rememberOpenStatesSubDirectories")},appearance:{content:e("div.tab[data-name='appearance']"),presetWrapper:e("div.tab[data-name='appearance'] div.presets"),iconColorWrapper:e("div.tab[data-name='appearance'] div.iconColorWrapper")},newtab:{content:e("div.tab[data-name='newtab']")},importExport:{content:e("div.tab[data-name='export']")},expert:{content:e("div.tab[data-name='expert']"),search:e("div.tab[data-name='expert'] input.search"),template:e("div.tab[data-name='expert'] > template")},premium:{wrapper:e("div.tab[data-name='premium']")},feedback:{wrapper:e("div.tab[data-name='feedback']"),faq:e("div.tab[data-name='feedback'] > div.faq"),form:e("section.form"),send:e("section.form button[type='submit']"),feedback:e("div.tab[data-name='feedback'] div.feedbackWrapper"),showForm:e("div.tab[data-name='feedback'] div.suggestedAnswers > a"),uploadField:e("div.upload > input[type='file']"),uploadedFiles:e("ul.uploadedFiles"),suggestions:e("div.tab[data-name='feedback'] div.suggestedAnswers")},translation:{wrapper:e("div.tab[data-name='language'] > div[data-name='translate']"),goto:e("div.tab[data-name='language'] > div[data-name='general'] a.button"),overview:e("div.tab[data-name='language'] > div[data-name='translate'] > div.overview"),langvars:e("div.tab[data-name='language'] > div[data-name='translate'] > div.langvars"),thanks:e("div.tab[data-name='language'] > div[data-name='translate'] > div.thanks"),unavailable:e("div.tab[data-name='language'] > div[data-name='translate'] > div.unavailable")},formElement:e("div.formElement"),infos:{shareInfoWrapper:e("div.tab[data-name='infos'] div.shareInformation"),permissionsWrapper:e("div.tab[data-name='infos'] div.permissions")},preview:{},checkbox:{},range:{},select:{},color:{},textarea:{},field:{},radio:{}},this.serviceAvailable=!0;const t=["behaviour","appearance","newtab","expert"];let a=!1;this.run=()=>{s();const t={body:this.helper.template.loading().appendTo(this.elm.body)};this.elm.body.addClass(e.cl.initLoading),this.helper.model.init().then(()=>this.helper.i18n.init()).then(()=>(this.elm.body.parent("html").attr("dir",this.helper.i18n.isRtl()?"rtl":"ltr"),this.helper.font.init(),this.helper.stylesheet.init({defaultVal:!0}),Promise.all([this.helper.form.init(),this.helper.stylesheet.addStylesheets(["settings"],e(document))]))).then(()=>(this.elm.body.removeClass(e.cl.building),this.helper.i18n.parseHtml(document),this.elm.title.text(this.elm.title.text()+" - "+this.helper.i18n.get("extension_name")),["translation","feedback"].forEach(a=>{t[a]=this.helper.template.loading().appendTo(this.elm[a].wrapper),this.elm[a].wrapper.addClass(e.cl.loading)}),this.helper.menu.init())).then(()=>Promise.all([this.helper.sidebar.init(),this.helper.appearance.init(),this.helper.newtab.init(),this.helper.infos.init(),this.helper.premium.init(),this.helper.expert.init(),this.helper.importExport.init()])).then(()=>(l(),t.body.remove(),this.elm.body.removeClass(e.cl.initLoading),this.helper.model.call("websiteStatus"))).then(a=>{this.serviceAvailable="available"===a.status,["translation","feedback"].forEach(a=>{this.helper[a].init().then(()=>{t[a].remove(),this.elm[a].wrapper.removeClass(e.cl.loading)})})})},this.addNoPremiumText=t=>{const a=e("<p />").addClass(e.cl.premium).html("<span>"+this.helper.i18n.get("premium_restricted_text")+"</span>").appendTo(t);e("<a />").text(this.helper.i18n.get("more_link")).appendTo(a).on("click",e=>{e.preventDefault(),location.href="#premium"})},this.showSuccessMessage=t=>{a=!1,this.elm.buttons.save.removeClass(e.cl.info),this.elm.body.attr(e.attr.settings.success,this.helper.i18n.get("settings_"+t)),this.elm.body.addClass(e.cl.success),e.delay(1500).then(()=>{this.elm.body.removeClass(e.cl.success)})},this.highlightUnsavedChanges=()=>{!1===a&&(this.elm.buttons.save.addClass([e.cl.settings.highlight,e.cl.info]),e.delay(1e3).then(()=>{this.elm.buttons.save.removeClass(e.cl.settings.highlight)}),a=!0)};const s=()=>{this.helper={model:new e.ModelHelper(this),checkbox:new e.CheckboxHelper(this),template:new e.TemplateHelper(this),i18n:new e.I18nHelper(this),font:new e.FontHelper(this),stylesheet:new e.StylesheetHelper(this),translation:new e.TranslationHelper(this),menu:new e.MenuHelper(this),form:new e.FormHelper(this),sidebar:new e.SidebarHelper(this),newtab:new e.NewtabHelper(this),appearance:new e.AppearanceHelper(this),feedback:new e.FeedbackHelper(this),premium:new e.PremiumHelper(this),importExport:new e.ImportExportHelper(this),expert:new e.ExpertHelper(this),infos:new e.InfosHelper(this)}},l=async()=>{e(window).on("beforeunload",e=>{if(a){const t="Do you really want to leave without saving your changes?";return e.returnValue=t,t}}),e.api.extension.onMessage.addListener(t=>{t&&t.action&&"reinitialize"===t.action&&"premiumActivated"===t.type&&e.delay(2e3).then(()=>{a=!1,location.reload(!0)})}),e("input, textarea, select").on("keyup change input",t=>{e(t.currentTarget).parent("["+e.attr.type+"='licenseKey']").length()>0||e(t.currentTarget).parent("["+e.attr.name+"='translationInfo']").length()>0||t.currentTarget===this.elm.expert.search[0]||e(t.currentTarget).parents("div."+e.cl.settings.translation.thanks).length()>0||this.highlightUnsavedChanges()}),e(document).on("click",()=>{e("div."+e.cl.settings.dialog).removeClass(e.cl.visible)}),this.elm.body.on("click","div."+e.cl.settings.dialog,e=>{e.stopPropagation()}),this.elm.body.on("click","div."+e.cl.settings.dialog+" > a",a=>{a.preventDefault(),a.stopPropagation();const s=e(a.currentTarget).parent("div").attr(e.attr.type);if(-1!==t.indexOf(s)){const t=[];let a=[s];"appearance"===s?t.push(new Promise(t=>{e.api.storage.local.get(["utility"],a=>{const s=a.utility||{};delete s.customCss,e.api.storage.local.set({utility:s},()=>{t()})})})):"expert"===s&&(a=["behaviour","appearance","newtab"]),t.push(new Promise(t=>{e.api.storage.sync.remove(a,()=>{this.showSuccessMessage("restored_message"),this.helper.model.call("reloadIcon"),e("div."+e.cl.settings.dialog).removeClass(e.cl.visible),t()})})),Promise.all(t).then(()=>e.delay(1500)).then(()=>{this.helper.model.call("reinitialize"),location.reload(!0)})}}),this.elm.advanced.container.css("display","none"),this.elm.advanced.toggle.on("click",t=>{const a=e(t.currentTarget).next("div");a.hasClass(e.cl.visible)?(a.removeClass(e.cl.visible),e.delay(300).then(()=>{a.css("display","none")})):(a.css("display","flex"),e.delay(0).then(()=>{a.addClass(e.cl.visible)}))}),this.elm.buttons.save.on("click",t=>{t.preventDefault();const a=this.helper.menu.getPath();"translate"===a[1]?this.helper.translation.submit():"expert"===a[0]?this.helper.expert.save().then(()=>(this.showSuccessMessage("saved_message"),this.helper.model.call("reinitialize"))).then(()=>e.delay(1500)).then(()=>(this.helper.model.call("reloadIcon"),this.helper.model.call("reloadContextmenus"),e.delay(0))).then(()=>{location.reload(!0)}).catch(()=>{}):Promise.all([this.helper.sidebar.save(),this.helper.appearance.save(),this.helper.newtab.save()]).then(()=>(this.showSuccessMessage("saved_message"),this.helper.model.call("reinitialize"))).then(()=>(this.helper.model.call("reloadIcon"),this.helper.model.call("reloadContextmenus"),this.helper.model.init())).then(()=>{this.helper.expert.updateRawConfigList()})}),this.elm.buttons.restore.on("click",a=>{a.preventDefault();const s=this.helper.menu.getPath();let l=s[0];if("sidebar"===l&&(l="behaviour"),-1!==t.indexOf(l)){e("div."+e.cl.settings.dialog).remove();const t=a.currentTarget.getBoundingClientRect(),n=e("<div />").attr(e.attr.type,l).addClass(e.cl.settings.dialog).append("<p>"+this.helper.i18n.get("settings_restore_confirm")+"</p>").append("<span>"+this.helper.i18n.get("settings_menu_"+s[0])+"</span>").append("<br />").append("<a>"+this.helper.i18n.get("settings_restore")+"</a>").css("left",t.left+"px").appendTo(this.elm.body);"expert"===l&&n.children("span").remove(),e.delay().then(()=>{n.addClass(e.cl.visible)})}})}}).run()})(jsu);