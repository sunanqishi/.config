(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"+m22":function(e,t){angular.module("castifyExt.connect.bgConnectService",["castifyExt.connect.appPermissions","cf2.connectedAppsService","castifyExt.connect.appRecorder","castifyExt.simpleBgServicePublisher","castifyExt.bgSyncManager","castifyExt.bgFiles","w69b.chromeTabs","w69b.chromeWindows","w69b.asyncResponse","w69b.chromeRuntime","w69b.spawn","w69b.uritool","w69b.promiseTool"]).factory("bgConnectService",["cf2ConnectedAppsService","appPermissions","$q","chromeTabs","spawn","uritool","simpleBgServicePublisher","chromeRuntime","asyncResponse","$log","chromeWindows","promiseTool","bgSyncManager","appRecorder","bgFiles",function(e,t,n,r,i,o,a,c,s,u,l,d,f,p,h){var g={},m=new Map,b=null,v=5e3;function y(e,t,n){for(var r of m.values())r.app.id===t&&r.sender.send(e,n)}function w(e){return b&&b.appId===e.id}g.share=function(a,c,s){return i((function*(){yield f.requestSyncLocal(c);var p=t.allowAccess(a,c);if(!s){var h=yield e.getConnectedAppInfoById(a);if(!(s=h&&h.shareUrl))return u.warn("connect.share() called for app without shareUrl",h),n.reject("no_share_url")}yield p;var g=[c];if(!(yield function(e,t){return i((function*(){function n(e){return d.withTimeout((function(){return e.sendWithResponse("shareFiles",t)}),v)}for(var i of m.entries()){var o=i[0],a=i[1];if(a.app.id===e){var c,s=a.sender;try{c=yield n(s)}catch(p){u.debug("connect: shareFiles handler rejected with",p),c=!1}if(c){var f=o.sender.tab;return u.debug("connect: shareFiles handled directly, focusing",f),r.update(f.id,{active:!0}),l.update(f.windowId,{focused:!0}),!0}}}return!1}))}(a,g))){var b=JSON.stringify({ids:g}),y=s+"?"+o.encodeQuery({state:b});return r.create({url:y})}}))};var _={};function S(e){"connectFrame"===e.name&&e.onMessage.addListener((function t(n){if("connect"===n.type){var r=n.data,i=s.createSender((function(t){e.postMessage(t)})),o=s.createRespond(e.postMessage.bind(e));e.onMessage.addListener((function(t){if(!i.handleResult(t)&&_.hasOwnProperty(t.type)){var n=_[t.type](r,t.data,e.sender);o(n,t)}})),e.onDisconnect.addListener((function(){var t=m.get(e);t&&w(t.app)&&(u.debug("connect: cancelling start due to port disconnect"),b.cancelPendingStart()),m.delete(e)})),m.set(e,{app:r,sender:i}),e.onMessage.removeListener(t)}}))}return _.startRecording=function(e,t,r){return i((function*(){return u.debug("connect: startRecording",e,t=t||{}),b&&b.appId!==e.id?n.reject("busy"):b&&!(yield b.cancelPendingStart())?(u.debug("connect: could not cancel pending start"),n.reject("busy")):b||!function(e){for(var t of m.values())if(t.app.id===e)return!0;return!1}(e.id)?n.reject("busy"):((b=p(e)).ended.then((function(){y("recordingStateChanged",e.id,"inactive"),b=null})),b.onStateChanged=function(t){y("recordingStateChanged",e.id,t)},b.onTimeChanged=function(t){y("recordingTimeChanged",e.id,t)},t.tabId=r.tab.id,b.start(t))}))},_.stopRecording=function(e){return w(e)?b.stop():n.reject("busy")},_.pauseRecording=function(e){return w(e)?b.pause():n.reject("busy")},_.resumeRecording=function(e){return w(e)?b.resume():n.reject("busy")},_.getRecordingState=function(e){return w(e)?b.getState():"inactive"},_.getRecordingTime=function(e){return w(e)?b.getTime():0},_.storeFileInLibrary=i.wrap((function*(e,i){var o=(i=i||{}).fileId;return(yield t.hasAccess(e.id,o))?(yield h.getFileDescriptor(o)).autoShare?(yield f.storeAutoSharedFile(o),void(i.openFile&&(yield function(e){var t="ng/app/app.html#/files/"+encodeURIComponent(e);return r.create({url:t})}(o)))):n.reject("file is already stored in library"):n.reject("access_denied")})),g.install=function(){c.onConnect.addListener(S),a("connect",g,["install"])},g}])},"/b8I":function(e,t){angular.module("castifyExt.driveUtils",["w69b.googledrive","castifyExt.castifyAuth","w69b.es6","w69b.spawn","cf2.chromeStorageService"]).factory("driveUtils",["googledrive","$q","spawn","$log","cf2ChromeStorageService","$rootScope","$timeout",function(e,t,n,r,i,o,a){var c,s,u={};function l(e){if(e&&e.data){var t,n=e.data;if(n.error&&n.error.errors&&n.error.errors.length&&(t=n.error.errors[0]),t)return t.reason}else if(e&&e.message)return e.message;return null}function d(e,t){var n=e.filter((function(e){return e.type===t}));return n.length?n[0]:null}function f(e){return d(e,"anyone")}function p(e){return d(e,"domain")}function h(e){var t=f(e),n=p(e);return t?t.withLink?"unlisted":"public":n?n.withLink?"domain_unlisted":"domain_public":"private"}return u.getDriveUploadParentId=function(o){return c&&!o||(c=n((function*(){var n=yield i.sync.getSingle("DRIVE_FOLDER_ID");if(n&&(yield function(n){return e.getFile(n).then((function(e){return!e.labels.trashed}),(function(e){return 404!==e.status&&(r.warn("driveUtils: checkIfExists failed",e),t.reject(e))}))}(n)))return r.debug("driveUtil: using cached parent Id",n),n;var o=yield e.listFiles({q:"mimeType = 'application/vnd.google-apps.folder' and trashed = false and properties has { key='isScreencastifyUploadFolder' and value='true' and visibility='PRIVATE' }",maxResults:1}).then((function(e){return r.debug("driveUtils: findFolder items #",e.length),e.length?e[0]:null}));o||(o=yield(r.debug("driveUtils: creating Drive folder"),e.postFile({title:"Screencastify",mimeType:"application/vnd.google-apps.folder",description:"Screencastify uses this folder to store Screencasts that you upload. You may rename or move it, it will upload to this folder.",properties:[{key:"isScreencastifyUploadFolder",value:!0,visibility:"PRIVATE"}]})));var a=o.id;return yield i.sync.setSingle("DRIVE_FOLDER_ID",a),a}))).catch((function(e){u.isRateLimitError(e)?(s&&a.cancel(s),s=a((function(){c=null,s=null}),1e4)):c=null})),c},u.getSimplePrivacy=function(t){return e.listPermissions(t).then(h)},u.getLink=function(e){return`https://drive.google.com/file/d/${e}/view`},u.getEmbedLink=function(e){return`https://drive.google.com/file/d/${e}/preview`},u.setSimplePrivacy=function(r,i,o){var a=i.startsWith("domain_");if(a&&!o)throw new Error;return n((function*(){var n=yield e.listPermissions(r),c=f(n),s=p(n);if(h(n)===i)return t.when(null);if("private"!==i){c&&(yield e.removePermission(r,c.id)),s&&(yield e.removePermission(r,s.id));var u={role:"reader",type:a?"domain":"anyone",withLink:"unlisted"===i||"domain_unlisted"===i};return a&&(u.value=o),e.insertPermission(r,u)}c&&(yield e.removePermission(r,c.id)),s&&(yield e.removePermission(r,s.id))}))},u.isGoogleAppsForbiddenError=function(e){return e&&403==e.status&&"domainPolicy"===l(e)},u.isRateLimitError=function(e){return e&&403==e.status&&"rateLimitExceeded"===l(e)},u.findCommentPermissions=function(e){return e?e.filter(e=>"reader"===e.role&&e.additionalRoles&&e.additionalRoles.includes("commenter")):[]},u.findReadOnlyPermissions=function(e){return e?e.filter(e=>!("reader"!==e.role||e.additionalRoles&&e.additionalRoles.includes("commenter"))):[]},o.$on("event:signInChanged",(function(){c=null,i.sync.remove("DRIVE_FOLDER_ID")})),u}])},0:function(e,t,n){e.exports=n("EtE5")},"3Jae":function(e,t){!function(){class e{constructor(){this.reset()}get time(){return this.started?this.paused?this._pausedAtTimestamp-this._firstTimestamp+this._offset:this._now()-this._firstTimestamp+this._offset:0}get started(){return this._firstTimestamp>=0}get paused(){return this._pausedAtTimestamp>=0}_now(){return Date.now()/1e3}start(){this.reset(),this._firstTimestamp=this._now()}reset(){this._firstTimestamp=-1,this._pausedAtTimestamp=-1,this._offset=0}pause(){this.paused||(this._pausedAtTimestamp=this._now())}resume(){if(!this.paused)throw new Error;this._offset-=this._now()-this._pausedAtTimestamp,this._pausedAtTimestamp=-1}}angular.module("castifyExt.pausableTimer",[]).value("PausableTimer",e).value("PausableTimeout",class extends e{constructor(e){super(),this._timeout=e,this.promise=new Promise(e=>this._resolve=e)}get remaining(){return this._timeout-this.time}_startInterval(){this._timerId=setTimeout(this._onTimer.bind(this),1e3*this.remaining)}_onTimer(){this._timerId=null,this._resolve(),this.dispose()}_stopInterval(){this._timerId&&clearTimeout(this._timerId)}start(){super.start(),this._startInterval()}pause(){super.pause(),this._stopInterval()}resume(){super.resume(),this._startInterval()}dispose(){this._stopInterval(),this._resolve=null,this.promise=null}}).value("PausableTriggeringTimer",class extends e{constructor(e,t){super(),this._interval=t,this._listener=e,this._startTime=0}setStartTime(e){this._startTime=e}get time(){return super.time+this._startTime}_fireChange(){this._listener&&this._listener(this.time)}_startInterval(){this._listener&&this._interval&&(this._intervalId=setInterval(this._fireChange.bind(this),this._interval))}_stopInterval(){this._intervalId&&clearInterval(this._intervalId),this._intervalId=0,this._fireChange()}reset(){super.reset(),this._stopInterval()}start(){super.start(),this._startInterval()}pause(){super.pause(),this._stopInterval()}resume(){super.resume(),this._startInterval()}})}()},"44cV":function(e,t){angular.module("castifyExt.youtubeUtils",["castifyExt.castifyAuth"]).factory("youtubeUtils",["$http","$q",function(e,t){var n="https://www.googleapis.com/youtube/v3/videos",r={};function i(e){var n=e.data.items;return n.length?n[0]:t.reject("not found on youtube")}return r.getPrivacy=function(r,o){return function(t,r){return e.get(n,angular.extend({params:{id:t,part:"status,snippet"}},{youtubeAuth:r})).then(i)}(r,o).then((function(e){return o!==e.snippet.channelId?t.reject():e.status.privacyStatus}))},r.getLink=function(e){return"https://youtu.be/"+e},r.setPrivacy=function(t,r,i){return function(t,r,i){return i=angular.extend({id:t},i),e.put(n,i,angular.extend({params:{part:"status"}},{youtubeAuth:r})).then((function(e){return e.data}))}(t,i,{status:{privacyStatus:r}})},r}])},"4Z/A":function(e,t){angular.module("w69b.chromeCommands",["w69b.promiseTool"]).factory("chromeCommands",["promiseTool",function(e){var t={};return t.getAll=e.wrapChromeError(chrome.commands.getAll,chrome.commands),t.onCommand=chrome.commands.onCommand,t}])},"58x+":function(e,t){angular.module("w69b.pnaclModule",[]).factory("pnaclModule",["$q","$log","$timeout",function(e,t,n){return function(r,i,o){var a=["<embed ","width=0 height=0 ",'src="'+r+'" ','ps_tty_prefix="ps:" ps_stdout="/dev/tty" ps_stderr="/dev/tty" type="application/x-'+(i?"pnacl":"nacl")+'" />'].join("");o||(o=document.body);var c,s,u,l=document.createElement("div"),d={isLoaded:!1};function f(){t.error("pnacl module crashed",u.lastError),d.onCrash&&d.onCrash(u.lastError)}function p(e){d.onMessage&&d.onMessage(e)}return d.onMessage=void 0,d.onCrash=void 0,d.load=function(){if(c)return c;var t=e.defer();function r(){l.removeEventListener("load",i,!0),l.removeEventListener("error",h,!0)}function i(){r(),t.resolve()}function h(){r(),t.reject(u.lastError)}l.addEventListener("load",i,!0),l.addEventListener("error",h,!0),l.addEventListener("crash",f,!0),l.addEventListener("message",p,!0),s=n((function(){t.reject("load_timeout")}),8e3),l.innerHTML=a,u=l.children[0],o.appendChild(l),d._pnaclHack=l.offsetTop,(c=t.promise).finally((function(){n.cancel(s),s=null}));var g=c;return c.catch((function(){d.unload()})),g},d.unload=function(){d.isLoaded=!1,l.removeEventListener("message",p,!0),l.removeEventListener("crash",f,!0),l.innerHTML="",o.removeChild(l),u=null,c=null},d.getElement=function(){return u},d.postMessage=function(e){if(!u)throw new Error("not loaded");u.postMessage(e)},d}}])},"5Lhf":function(e,t){angular.module("castifyExt.enterprisePolicy",["cf2.chromeStorageService"]).provider("enterprisePolicy",(function(){var e={};this.setOverride=function(t){e=t},this.$get=["cf2ChromeStorageService","$rootScope",function(t,n){var r={},i=!1,o={options:{}};angular.extend(o,e);var a=["disableSharing","disableSaveToDisk","options"];return a.forEach((function(e){Object.defineProperty(r,e,{get:function(){return o[e]}})})),r.loadedPromise=t.managed.get(a).then((function(t){angular.extend(o,t,e),i=!0})),r.isLoaded=function(){return i},r.has=function(e){return o.hasOwnProperty(e)},r.get=function(e){return o[e]},t.onChanged.addListener((function(e,t){"managed"===t&&(angular.forEach(e,(function(e,t){o[t]=e.newValue})),n.$$phase||n.$digest())})),r}]}))},"5NUK":function(e,t){angular.module("castifyExt.recordingHooks",["castifyExt.videoPreviewRenderer","castifyExt.appOptions","cf2.inAppTabService","castifyExt.bgFiles","castifyExt.connect.bgConnectService","w69b.spawn","w69b.clipboard","w69b.chromeRuntime","w69b.chromeTabs","w69b.filesHelper","castifyExt.recordTool"]).factory("recordingHooks",["$rootScope","$filter","videoPreviewRenderer","chromeTabs","appOptions","bgFiles","clipboard","cf2InAppTabService","$q","$log","$timeout","filesHelper","spawn","bgConnectService",function(e,t,n,r,i,o,a,c,s,u,l,d,f,p){var h=[],g={},m="upload:",b=1e4;function v(e){if(0===e.lastIndexOf(m,0)){var t=e.substr(m.length);r.create({url:t}),chrome.notifications.clear(e)}}function y(e,t){if(!t.config.isSyncUpload){var n=t.config,r=t.link;if(/https?:\/\//.test(r)){var i='Your screencast "'+n.title+'" has been uploaded. Click here to open it.';n.copyLinkToClipboard&&(a.copy(r),i+=" The link was copied to your clipboard."),n.showNotification&&chrome.notifications.create(m+r,{type:"basic",priority:0,title:"Upload complete",message:i,iconUrl:"images/icon128.png"},angular.noop)}}}function w(e,r,a){return f((function*(){yield function(e){return n.renderPreview(e).catch((function(t){u.warn("rendering preview image failed",e);var n=o.idToLocalFilename(e);return function(e){return d.getFileEntryByPath(e).then((function(e){return d.getMetadata(e)})).then((function(e){return e.size}))}(n).then((function(e){return e<b?(u.warn("file is empty, removing it"),d.removeByPath(n),s.reject(t)):null}))}))}(r),a.autoShareApp?yield function(e,t){return f((function*(){var n=t.autoShareApp.id,r=t.connectMeta&&t.connectMeta.shareUrl,i=t.connectMeta&&t.connectMeta.payload;yield o.updateLocalInfo(e,{autoShare:{appId:n,shareUrl:r,payload:i,timestamp:Date.now()}}),yield o.registerLocalFile(e),yield p.share(n,e,r)}))}(r,a):(yield o.registerLocalFile(r),yield function(e,n){let r;var a;return r="tab"===n.captureSource&&"tabTitle"===i.values.videoTitleNamingScheme&&n.tabTitle?`${n.tabTitle}`:`Untitled: ${a=Date.now(),t("date")(a,"MMM d, y h:mm a")}`,o.rename(e,r)}(r,a),i.values.autoOpen&&"recorder:fixedFile"!==e.name&&function(e,t=!1){let n="";n=t?`ng/app/app.html#/files/${encodeURIComponent(e)}?autostopped`:`ng/app/app.html#/files/${encodeURIComponent(e)}`,l((function(){c.create(n)}),500)}(r,a.timeLimitReached)),u.debug("recording hooks completed for",r)})).catch(e=>{u.debug("recordingHooks:onStopped cancelled",e)})}return g.install=function(){h=[e.$on("recorder:stopped",w),e.$on("recorder:fixedFile",w),e.$on("uploader:complete",y)],chrome.notifications.onClicked.addListener(v)},g.uninstall=function(){h.forEach((function(e){e()})),h=[],chrome.notifications.onClicked.removeListener(v)},g}])},"5Rb+":function(e,t){angular.module("castifyExt.licenseEnforcer",["castifyExt.bgRecord","cf2.userAccount","w69b.chromeTabs","castifyExt.appOptions"]).factory("licenseEnforcer",["bgRecordService","$rootScope","userAccount","chromeTabs","$log","cf2BgCastifyDrawService","appOptions",function(e,t,n,r,i,o,a){var c={install:function(){function r(){var t=e.getConfig();return t.autoShareApp&&t.autoShareApp.isPaid}var c=Number.MAX_VALUE;function s(){n.getAccount().then((function(e){c=e.license.maxLength}))}t.$on("event:userAccountChanged",s),s(),t.$watch((function(){return e.getRecorderState().time>=c}),(function(t){t&&!r()&&(i.debug("recordLimitReached"),chrome.notifications.clear("recordLimitInfo",angular.noop),chrome.notifications.clear("recordLimitReached",angular.noop),e.stop(!0))})),t.$watch((function(){return c-Math.ceil(e.getRecorderState().time)}),(function(e){e>0&&e<=30&&!r()&&function(e){i.debug("recordLimitApproaching");var t={type:"basic",priority:2,title:"Approaching free recording limit",message:"Recording will be stopped automatically in "+e+" seconds. Please upgrade Screencastify to record longer screencasts.",iconUrl:"images/icon128.png"};o.isActiveTabInjected()&&a.values.enableTimeLimitWarning||chrome.notifications.create("recordLimitInfo",t,angular.noop)}(e)})),t.$on("recorder:stopped",(function(){chrome.notifications.clear("recordLimitInfo",angular.noop)}))}};return chrome.notifications.onClicked.addListener((function(e){"recordLimitReached"!==e&&"recordLimitInfo"!==e||(r.create({url:"https://www.screencastify.com/buy?utm_source=app&utm_medium=notify&utm_campaign=recording_length"}),chrome.notifications.clear(e,angular.noop))})),c}])},"6GBm":function(e,t){angular.module("w69b.googleUploader",["w69b.ngProgressHttp"]).factory("googleUploader",["$progressHttp","$http","$q","$timeout","$log",function(e,t,n,r){var i=6e4,o=!0,a=!0,c=1073741824,s={};function u(e,t){var o=e.headers("Retry-After");if(o&&a)o=Math.min(i,1e3*Number(o));else{if(!t)return n.when(e);o=t}return r(angular.noop,o).then((function(){return e}))}function l(e){return e.data}function d(r,i){var a=null,s=n.defer(),d=s.promise,f=!1,p={};function h(e){return!f&&a&&308===e.status?m():o&&!f&&a&&(e.status<=0||e.status>=500&&e.status<=599||e.config&&!1===e.config.authAutoRetry&&401===e.status)?u(e,2e3).then(m):n.reject(e)}function g(t){if(308==t.status){var o,s=t.headers("Range");o=s?Number(s.match(/bytes=0-(\d+)/)[1])+1:0;var u=Math.min(r.size,c),l=Math.min(o+u,r.size)-1,f="bytes "+o+"-"+l+"/"+r.size,p=angular.extend({},i,{url:a,method:"PUT",progressEvents:"upload",transformRequest:null,data:r.slice(o,l+1),googleAuth:!0,authAutoRetry:!1,timeout:d});return p.headers=angular.extend({},p.headers,{"Content-Type":r.type,"Content-Range":f}),e(p).then(null,null,(function(e){return{loaded:(e=e.event).loaded+o,total:r.size}}))}return 200==t.status?t:n.reject(t)}function m(){var e=angular.extend({},i,{timeout:d,googleAuth:!0});return e.headers=angular.extend({},e.headers,{"Content-Range":"bytes */"+r.size}),t.put(a,"",e).then(u,u).then(g).catch(h)}return p.start=function(e,o,c){c=angular.extend({},i,c),angular.extend(c.headers||{},{"X-Upload-Content-Length":r.size,"X-Upload-Content-Type":"video/*"}),c.googleAuth=!0,c.timeout=d;var s=n.defer();return t.post(e,o,c).then((function(e){return a=e.headers("Location"),s.notify({uploadUrl:a}),m()})).catch(h).then(s.resolve.bind(s),s.reject.bind(s),s.notify.bind(s)),p.promise=s.promise.then(l),p.promise},p.resume=function(e){return a=e,p.promise=m().then(l),p.promise},p.cancel=function(){f=!0,s.resolve()},p}return s.setAutoResumeEnabled=function(e){o=e},s.setRespectRetryAfterHeader=function(e){a=e},s.setMaxChunkSize=function(e){c=e},s.resumeUpload=function(e,t,n){var r=d(e,n);return r.resume(t),r},s.driveUpload=function(e,t,n){return s.upload("https://www.googleapis.com/upload/drive/v2/files?uploadType=resumable",e,t,n)},s.upload=function(e,t,n,r,i){var o=d(t,r);return o.start(e,n,i),o},s.generateId=function(){return t.get("https://www.googleapis.com/drive/v3/files/generateIds",{googleAuth:!0,params:{count:1,space:"drive"}}).then(e=>e.data.ids[0])},s}])},"6Mel":function(e,t){angular.module("castifyExt.commonConfig",["castifyExt.castifyAuth","w69b.chromeAnalytics","w69b.chromeRuntime","castifyExt.helpCenterConfig","castifyExt.appOptions","cf2.userAccount","castifyExt.deployConfig"]).config(["$compileProvider","$sceDelegateProvider","analyticsProvider","$locationProvider","deployConfigProvider",function(e,t,n,r,i){n.setTrackingId(i.analyticsId),n.setApp("Screencastify"),t.resourceUrlWhitelist(["self","http://localhost:9008/**","blob:**","filesystem:chrome-extension://**","https://**"]);var o=/^\s*(https?|mailto|blob|chrome-extension|filesystem:chrome-extension):/;e.aHrefSanitizationWhitelist(o),e.imgSrcSanitizationWhitelist(o),r.hashPrefix("")}]).run(["$rootScope","analytics","chromeRuntime","appOptions","$injector","userAccount",function(e,t,n,r,i,o){var a=i.has("$transitions")?i.get("$transitions"):null,c=r.loadedPromise.then(s);function s(){return o.getAccount().then((function(e){let i;i=e.license.isPaid?"paid":e.license.isTester?"tester":"trial",t.tracker.set("dimension1",i),t.tracker.set("dimension2",n.getManifest().version),t.tracker.set("dimension5",r.values.hwEncoding),e.user?(t.tracker.set("userId",e.user.analyticsUid),t.tracker.set("dimension4",e.user.analyticsUid),e.user.planVariant&&t.tracker.set("dimension6",e.user.planVariant),t.setEnabled(r.values.enableAnalytics&&!1!==e.user.analyticsEnabled)):t.setEnabled(r.values.enableAnalytics)}))}a&&a.onSuccess({},(function(e){var n=e.targetState().state(),r=n.analyticsView||n.pageTitle;r&&c.then((function(){t.tracker.sendAppView(r)}))})),e.$on("event:userAccountChanged",s)}]).factory("castifyConfig",["deployConfig",e=>({API_URL:e.apiUrl,IS_E2E:window.localStorage.e2e})])},"7cT6":function(e,t){angular.module("castifyExt.driveFileDb",["cf2.chromeStorageService","w69b.spawn","castifyExt.driveUtils","castifyExt.offline","castifyExt.castifyAuth"]).factory("driveFileDb",["googledrive","$q","onlineState","cf2ChromeStorageService","spawn",function(e,t,n,r,i){var o="drive_files",a={};function c(e,t){if(e){var n=e.match(/(.*)=s\d+$/);if(n)return n[1]+"=s"+t}return e}function s(e){var t={};return e.forEach((function(e){if("PRIVATE"===e.visibility){if(e.key.indexOf("_")>0){var n=e.key.split("_",2),r=n[0],i=n[1];t[r]||(t[r]={}),t[r][i]=e.value}t[e.key]=e.value}})),t}function u(e){this.updateFromDriveResource_(e)}var l=u.prototype;function d(){return t.when(r.local.getSingle(o,[]))}return l.updateFromDriveResource_=function(e){var t,n=s(e.properties),r={id:n.uuid,driveId:e.id,thumbnailUrl:c(e.thumbnailLink,400),createdAt:new Date(n.recordingDate?Number(n.recordingDate):e.createdDate),url:(t=e.downloadUrl,t.indexOf("?")>=0?t+="&":t+="?",t+"cache_buster="+Math.floor(1e10*Math.random()).toString().padStart(10,"0").toString().padStart(10,"0")),urlRequiresAccessToken:!0,mimeType:e.mimeType,size:Number(e.fileSize),duration:Number(n.duration),width:Number(n.width),height:Number(n.height),driveInfo:e},i="."+e.fileExtension;r.title=e.fileExtension&&-1!==e.title.indexOf(i,e.title.length-i.length)?e.title.slice(0,-i.length):e.title,n.youtubeInfo&&(r.youtubeInfo=n.youtubeInfo),angular.extend(this,r)},l.remove=function(){return e.trashFile(this.driveId)},l.rename=function(t){var n=this.driveInfo.fileExtension;return n&&t.indexOf(n="."+n,t.length-n.length)<0&&(t+=n),e.patchFile(this.driveId,{title:t}).then(this.updateFromDriveResource_.bind(this))},l.updateYoutubeInfo=function(t){return s(this.driveInfo.properties).youtubeInfo=t,e.patchFile(this.driveId,{properties:(n={youtubeInfo:t},r=[],angular.forEach(n,(function(e,t){angular.isObject(e)?angular.forEach(e,(function(e,n){r.push({key:t+"_"+n,value:e,visibility:"PRIVATE"})})):r.push({key:t,value:e,visibility:"PRIVATE"})})),r)});var n,r},a.getFileDescriptor=function(n){return e.listFiles({maxResults:1,q:"trashed = false and properties has { key='uuid' and value='"+n+"' and visibility='PRIVATE' }"}).then((function(e){return e.length?e[0]:t.reject()})).then((function(e){return new u(e)}))},a.listFiles=function(){return i((function*(){var t;if(n.isOnline())try{!function(e){r.local.setSingle(o,e)}(t=yield e.listFiles({maxResults:1e3,q:"trashed = false and properties has { key='isScreencastifySyncFile' and value='true' and visibility='PRIVATE' }"}))}catch(a){if(!a||!(a.status<=0||a.status>=500))throw a;t=yield d()}else t=yield d();var i={};return t&&t.forEach((function(e){var t=new u(e);i[t.id]=t})),i}))},a}])},"8ZPm":function(e,t){angular.module("castifyExt.webrtcRecorder",["w69b.spawn","w69b.filesHelper","w69b.asyncResponse","castifyExt.pausableTimer"]).factory("webrtcRecorder",["$log","filesHelper","spawn","asyncResponse","PausableTriggeringTimer","$rootScope","$q","PausableTimeout",function(e,t,n,r,i,o,a,c){var s=window.MediaRecorder,u=window.webkitMediaStream||window.MediaStream,l='video/webm; codecs="vp9, opus"',d="/components/castifyMediawriter/dist/mediawriter.worker.min.js";function f(){var f,p,h,g={},m=["start","stop","pause","resume","error"];x();var b,v,y,w=Promise.resolve(),_=65536,S=500,E=[],C=0,I=0,A=new i((function(){h.time=A.time,k(),$(),g.onTimeChanged&&g.onTimeChanged(h.time),o.$$phase||o.$apply()}),500),O=d,j=!1;function x(){h={state:"inactive",time:0}}function T(t){return w=w.then((function(){if(t||C>_){var e=new Blob(E);return E.length=0,C=0,b.sendWithResponse("write",e)}})).catch((function(t){e.error("webrtcRecoder: flushQueue failed",t)}))}function R(e){var t;E.push(t=e.data),C+=t.size,I+=t.size,T()}function P(){let t=f?f.state:"inactive";if(e.debug("webrtcRecorder: state change",t),y||h.state!=t){if(y)h.state=y.paused?"paused":"recording";else switch(h.state=t,t){case"paused":A.pause();break;case"recording":A.paused?A.resume():A.started||A.start()}g.onStateChanged&&g.onStateChanged(h.state)}}var k=n.wrap((function*(){b&&(h.fps=yield b.sendWithResponse("getFps"))}));const $=n.wrap((function*(){b&&h.time>=7&&(I||("no_data",j||(j=!0,e.error("webrtcRecorder: fatal error: ","no_data"),function(){if(x(),y&&(y.dispose(),y=null),f){f.removeEventListener("dataavailable",R);try{f.stop()}catch(e){}f=null,E.length=0,C=0}v&&(v.terminate(),v=null,b=null),A.reset()}(),g.onError&&g.onError("no_data"))))}));function F(e,t){f.addEventListener(e,(function n(){f.removeEventListener(e,n),t.apply(this,arguments)}))}return g.onStateChanged=null,g.onTimeChanged=null,g.start=n.wrap((function*(n,i){e.debug("webrtcRecorder: onStart",n,i),(p=new u).addTrack(i.videoTrack),i.audioTrack&&p.addTrack(i.audioTrack);try{f=new s(p,{BitRate:i.bitRate,mimeType:i.mimeType||l,videoBitsPerSecond:i.bitRate})}catch(d){throw e.error("failed to create MediaRecorder",d),d}function o(){return y=null,a.when(new Promise((function(t){F("start",(function(){e.debug("webrtcEncoder: onStart"),t()})),m.forEach((function(e){f.addEventListener(e,P)})),f.addEventListener("error",t=>e.warn("webrtcEncoder: error event ",t)),f.start(S)})))}return t.isSupported()&&(yield t.removeByPath(n).catch(()=>null)),v=new Worker(O),b=r.createSender(e=>v.postMessage(e)),v.addEventListener("message",e=>b.handleResult(e.data)),b.send("init",{path:n,fsType:"PERSISTENT"}),f.addEventListener("dataavailable",R),i.startDelay?(A.setStartTime(-i.startDelay),A.start(),(y=new c(i.startDelay)).start(),y.promise.then(o),P(),a.when()):o()})),g.pause=function(){return y?(y.pause(),A.pause()):f.pause(),P(),a.when()},g.resume=function(){return y?(y.resume(),A.resume()):f.resume(),P(),a.when()},g.getStateObj=function(){return h},g.load=function(){return a.when()},g.getCurrentTime=function(){return h.time},g.stop=n.wrap((function*(){if(y)y.dispose(),y=null,A.reset(),P();else{var e=new Promise((function(e){F("stop",(function(){e()}))}));f.stop(),yield e,A.pause(),f=null,yield T(!0)}var t=yield b.sendWithResponse("end");return v.terminate(),v=null,b=null,A.reset(),t})),g}return f.isSupported=function(e){return void 0!==s&&(s.isTypeSupported&&s.isTypeSupported(e||l)||(n=(t=navigator.userAgent).match(/Firefox\/(\d+)/))&&n[1]>=44&&t.indexOf("Android")<0)&&!function(){var e=/Chrome\/(\d+)/.exec(window.navigator.userAgent);return e&&e[1]<51}();var t,n},f}])},"8iUY":function(e,t){angular.module("castifyExt.connect.appPermissions",["cf2.chromeStorageService","w69b.spawn"]).factory("appPermissions",["cf2ChromeStorageService","spawn",function(e,t){var n="appPermissions",r={};function i(e){var t=Date.now();return e.filter((function(e){return e.timeout>=t}))}function o(){return e.local.getSingle(n,[]).then(i)}return r.hasAccess=function(e,t){return o().then((function(n){return n.some((function(n){return n.appId===e&&n.fileId===t}))}))},r.allowAccess=function(r,i){return t((function*(){var t,a=yield o();(a=a.filter((function(e){return e.appId!==r&&e.appId!==i}))).push({appId:r,fileId:i,timeout:Date.now()+18e5}),yield(t=a,e.local.setSingle(n,t))}))},r}])},"98ZH":function(e,t){angular.module("castifyExt.diskSpaceWatcher",["castifyExt.bgRecord","w69b.filesHelper","w69b.ui.bytesFilter","castifyExt.appOptions","w69b.chromeNotifications","castifyExt.helpCenter"]).factory("diskSpaceWatcher",["bgRecordService","$timeout","filesHelper","$rootScope","$filter","appOptions","chromeNotifications","helpCenter","$log",function(e,t,n,r,i,o,a,c,s){var u,l=0,d=104857600,f=1e4;function p(){return l}function h(){g(),o.values.enableDiskSpaceWatcher&&n.getPersistentQuota().then((function(e){return e.quota-e.usage})).then((function(n){var r;n<=p()?(r={priority:2,title:"Critically low disk space",message:"You have less than 1GB left. Recording was paused automatically.",buttons:[{title:"Help"}]},a.clear("diskSpaceCritical").finally((function(){c.setNotifyHelp(a.simple.create(r,"diskSpaceCritical"),"disk_space")})),s.info("diskSpaceWatcher: auto-pausing on critical low space"),e.pause()):n<=d&&function(e){e+=1073741824;var t={priority:2,title:"Low disk space",message:"You have only "+i("bytes")(e)+" left. Recording will be paused automatically soon.",buttons:[{title:"Help"}]};c.setNotifyHelp(a.simple.create(t,"diskSpaceLow"),"disk_space")}(n),n>p()&&(u=t(h,f))}))}function g(){u&&(t.cancel(u),u=null)}return{install:function(){r.$watch((function(){return"recording"===e.getRecorderState().state&&!e.isBlocked()}),(function(e,t){e!==t&&(e?h():g())})),r.$on("recorder:stopped",(function(){a.clear("diskSpaceCritical"),a.clear("diskSpaceLow")}))},setThresholds:function(e,t){l=t,d=e}}}])},"9I/G":function(e,t){angular.module("w69b.spawn",[]).factory("spawn",["$q",function(e){function t(t,n){var r=n?Promise.reject.bind(Promise):e.reject.bind(e),i=n?Promise.resolve.bind(Promise):e.when.bind(e);function o(e,t){var n;try{n=e(t)}catch(o){return r(o)}return n.done?i(n.value):i(n.value).then(c,s)}var a=t(),c=o.bind(null,a.next.bind(a)),s=o.bind(null,a.throw.bind(a));return c()}return t.wrap=function(e){return function(){var n=arguments;return t(e.bind(this,...n))}},t}])},"9br6":function(e,t){window.angular&&angular.module("w69b.es6",[]),Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),r=n.length>>>0,i=arguments[1],o=0;o<r;o++)if(e.call(i,t=n[o],o,n))return t}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==this)throw new TypeError("Cannot convert this value to object");var t=Object(this),n=parseInt(t.length,10)||0;if(0===n)return!1;var r,i=parseInt(arguments[1],10)||0;if(i>=n)return!1;for(i>=0?r=i:(r=n+i)<0&&(r=0);r<n;){var o=t[r];if(e===o||e!=e&&o!=o)return!0;r++}return!1}}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(e,t){var n=this.toString();(void 0===t||t>n.length)&&(t=n.length);var r=n.indexOf(e,t-=e.length);return-1!==r&&r===t}}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(e,t){return this.lastIndexOf(e,t=t||0)===t}})},"9k28":function(e,t){angular.module("castifyExt.bgUserNotifications",["castifyExt.simpleBgServicePublisher","castifyExt.chromeEventPublisher","castifyExt.bgUserAccount","castifyExt.deployConfig","w69b.chromeAnalytics","w69b.chromeRuntime","w69b.chromeAlarms","w69b.throttle","w69b.spawn"]).factory("bgUserNotifications",["$http","$window","deployConfig","spawn","simpleBgServicePublisher","userAccount","$log","$rootScope","chromeAlarms",function(e,t,n,r,i,o,a,c,s){const u="uNotifications",l=u,d=n.notificationUri,f=4320,p={};function h(e,...t){a.debug(`userNotifications: ${e}`,...t)}function g(){return JSON.parse(t.localStorage.getItem(u))}p._storeInBrowser=function(e){t.localStorage.setItem(u,JSON.stringify(e))};const m=r.wrap((function*(t,n){h(`updating ${t} in firestore...`,n),yield e.put(`${d}${t}`,n,{googleAuth:!0}),function(e,t){const n=Object.keys(t)[0],r=g();r.userNotifications.forEach(r=>{r.id===e&&(r[n]=t[n])}),p._storeInBrowser(r)}(t,n)}));function b(e){e.name===l&&p.loadOrFetch()}function v(){h("setting alarm"),s.create(l,{periodInMinutes:f})}return p.hideIconBadge=()=>{chrome.browserAction.setBadgeText({text:""})},p.showIconBadge=()=>{let{userNotifications:e}=g()||{},t=0,n="";e&&e.length&&e.forEach(e=>{e.seen||t++}),t?(h(`has ${t} unseen notifications`),n=t.toString(),chrome.browserAction.setBadgeText({text:n})):p.hideIconBadge()},p.loadOrFetch=r.wrap((function*(){h("loadOrFetch");let{lastFetched:t,userNotifications:n,email:r}=g()||{};const i=yield o.getAccount();if(i.user){if((()=>!t||Date.now()-t>36e5||r!==i.user.email)())try{n=(yield e.get(d,{googleAuth:!0})).data,r=i.user.email,t=Date.now(),h("fetched notifications"),v()}catch(a){h("failed to fetch uNotifications",a)}}else n=[],r=null,t=1,h("erased notifications");return h("loaded notifications"),p._storeInBrowser({userNotifications:n,email:r,lastFetched:t}),p.showIconBadge(),n})),p.seen=r.wrap((function*(){const e=g();let t=[];e&&(h("marking all as seen..."),e.userNotifications.forEach(e=>{e.seen||t.push(m(e.id,{seen:!0}))})),yield Promise.all(t),p.hideIconBadge()})),p.clicked=r.wrap((function*(e){h(`${e} clicked`),g().userNotifications.forEach(t=>{t.id!==e||t.clicked||m(e,{clicked:!0})})})),p._getFetchIntervals=()=>({MIN_FETCH_INTERVAL:36e5,MAX_FETCH_INTERVAL_MINUTES:f}),p.install=()=>{i("userNotifications",p,["install"]),c.$on("event:userAccountChanged",p.loadOrFetch),v(),p.loadOrFetch(),s.onAlarm.addListener(b)},p}]).factory("userNotifications",["bgUserNotifications",function(e){return e}])},A5fb:function(e,t){angular.module("castifyExt.branding",["cf2.userAccount","w69b.filesHelper","w69b.spawn"]).factory("branding",["userAccount","$http","filesHelper","spawn","$log",function(e,t,n,r,i){return{getFilename:function(){return r((function*(){try{if(!(yield e.getAccount()).license.branding)return null;yield n.getDirByPath("_branding",{create:!0});var r=yield n.getFileEntryByPath("_branding/_branding.png",{create:!0}),o=yield n.getMetadata(r);if(!o.size||8532!==o.size){var a=yield n.createWriter(r),c=yield t.get("/images/branding.png",{responseType:"blob"});yield n.writeFile(a,c.data)}return"_branding/_branding.png"}catch(s){return i.error("failed to prepare branding file",s),null}}))}}}])},AALf:function(e,t){angular.module("castifyExt.ui.countdownIcon",["w69b.spawn"]).factory("countdownIcon",["spawn","$q",function(e,t){var n={},r=new Map,i={path:{19:"images/icon_countdown19.png",38:"images/icon_countdown38.png"}},o=e.wrap((function*(e,n){var i=document.createElement("canvas");i.width=e,i.height=e;var o=i.getContext("2d"),a=e/38;return o.scale(a,a),o.drawImage(yield function(e){var n=r.get(38);if(n)return n;var i=t.defer(),o=new Image;return o.crossOrigin="anonymous",o.addEventListener("load",(function e(){o.removeEventListener("load",e),i.resolve(o)})),o.src="images/icon38.png",r.set(38,i.promise),i.promise}(),0,0),o.font="bold 35px sans-serif",o.textBaseline="middle",o.textAlign="center",o.fillStyle="red",o.fillText(n,19,19),o.getImageData(0,0,i.width,i.height)}));return n.getIcon=e.wrap((function*(e){return(e=Math.ceil(-e))>=10?t.when(i):{imageData:{38:yield o(38,e)}}})),n}])},AOG9:function(e,t){angular.module("castifyExt.optionalPermissions",["w69b.chromePermissions","castifyExt.deployConfig"]).factory("optionalPermissions",["chromePermissions","deployConfig",function(e,t){var n={},r={permissions:["tabCapture","webNavigation"],origins:["<all_urls>"]},i={permissions:["tabCapture","webNavigation"],origins:[]};function o(e){return e&&(!e.draw||e.draw&&!e.draw.showToolbox)?i:r}return t.enableInlinePopupSupport||(r.permissions.push("activeTab"),i.permissions.push("activeTab")),n.hasLiteTabPermissions=function(){return e.contains(i)},n.hasTabPermissions=function(t){let n=o(t);return e.contains({permissions:n.permissions})},n.requestTabPermissions=function(t){return e.request(o(t))},n}])},ARYM:function(e,t){angular.module("castifyExt.helpCenter",["w69b.chromeTabs"]).factory("helpCenter",["chromeTabs",function(e){var t={tagUrls:{},registerUrl:function(e,n){t.tagUrls[e]=n},hasHelpFor:function(e){return t.tagUrls.hasOwnProperty(e)},openHelp:function(n){var r=t.tagUrls[n];if(!r)throw new Error("No help url registered for "+n);e.create({url:r})},setNotifyHelp:function(e,n){e.onButtonClicked=e.onClicked=function(){t.openHelp(n),e.clear()}}};return t}])},"Al3/":function(e,t){angular.module("w69b.throttle",[]).factory("throttle",["$timeout",function(e){return function(t,n,r){var i,o,a;r=!1!==r;var c=function(){return a=angular.copy(arguments,[]),o=function(){return i=null,o=null,t.apply(null,a)},r?(i&&e.cancel(i),i=e(o,n)):i||(i=e(o,n)),i};return c.flush=function(){i&&(e.cancel(i),o())},c}}])},C5ui:function(e,t){angular.module("castifyExt.hdpiTool",[]).factory("hdpiTool",["$window",function(e){var t={};return t.devicePixelRatio=e.devicePixelRatio,t.toPhysicalResolution=function(e){return{width:Math.floor(e.width*t.devicePixelRatio),height:Math.floor(e.height*t.devicePixelRatio)}},t.toCssResolution=function(e){return{width:Math.round(e.width/t.devicePixelRatio),height:Math.round(e.height/t.devicePixelRatio)}},t.getScreenCssResolution=function(){return{width:e.screen.width,height:e.screen.height}},t.scaleResolution=function(e,t){var n=Math.min(t.height/e.height,t.width/e.width,1);return{width:Math.floor(e.width*n),height:Math.floor(e.height*n)}},t}])},CO2U:function(e,t){angular.module("w69b.webrtc",["w69b.promiseTool","w69b.spawn"]).factory("webrtc",["promiseTool","$window","$q","spawn","$log",function(e,t,n,r,i){var o={},a=t.navigator;function c(e){return e.some((function(e){return!!e.label}))}return o.getUserMedia=e.wrapCallbacks(a.getUserMedia||a.webkitGetUserMedia||a.mozGetUserMedia||a.msGetUserMedia,a),o.getSources=a.mediaDevices&&a.mediaDevices.enumerateDevices?function(){return n.when(a.mediaDevices.enumerateDevices()).then((function(e){return e.filter((function(e){return e.kind.endsWith("input")})).map((function(e){var t={id:e.deviceId,label:e.label};return t.kind=e.kind.substring(0,e.kind.length-5),t}))})).catch(e=>(i.info("enumarateDevices() failed, treating it as no devices present",e),[]))}:e.wrapCallbacks(MediaStreamTrack.getSources,MediaStreamTrack),o.getSourcesByKind=function(e){return o.getSources().then((function(t){return t.filter((function(t){return t.kind===e}))}))},o.getVideoSources=function(){return o.getSourcesByKind("video")},o.getAudioSources=function(){return o.getSourcesByKind("audio")},o.hasCamera=function(){return o.getVideoSources().then((function(e){return e.length>0}))},o.hasMicrophone=function(){return o.getAudioSources().then((function(e){return e.length>0}))},o.hasVideoAccess=function(){return o.getVideoSources().then(c)},o.hasAudioAccess=function(){return o.getAudioSources().then(c)},o.getCameraAndMicPermission=r.wrap((function*(){let e=yield o.hasCamera(),t=!1,n=!1;try{let r=yield o.getUserMedia({audio:!0,video:e});n=!!r.getVideoTracks().length,t=!!r.getAudioTracks().length,r.getTracks().forEach((function(e){e.stop()}))}catch(r){}return{video:n,audio:t}})),o}])},CVq3:function(e,t){angular.module("w69b.googledrive",[]).factory("googledrive",["$q","googleauth","$location","$interval","$http","$log",function(e,t,n,r,i,o){var a=!1,c="https://www.googleapis.com/drive/v2/",s={};function u(e){return e.data}function l(e,t){return i.get(c+e,{googleAuth:!0,params:t}).then(u)}function d(e,t){return i.post(c+e,t,{googleAuth:!0}).then(u)}function f(e,t){return i({method:"PATCH",url:c+e,data:t,googleAuth:!0}).then(u)}function p(e){return i.delete(c+e,{googleAuth:!0}).then(u)}return s.isLoaded=function(){return a},s.loadLibs=function(){return a?e.when(null):t.loadClient().then((function(){return e.all([t.gapiLoad("picker")])})).then((function(){a=!0}))},s.getFile=function(e){return o.debug("googledrive.getFile",e),l("files/"+e)},s.listFiles=function(e){return o.debug("googledrive.listFiles",e),l("files/",e).then((function(e){return e.items}))},s.postFile=function(e){return o.debug("googledrive.postFile",e),d("files",e)},s.patchFile=function(e,t){return o.debug("googledrive.patchFile",e,t),f("files/"+e,t)},s.trashFile=function(e){return o.debug("googledrive.trashFile",e),d("files/"+e+"/trash")},s.getAbout=function(){return l("about")},s.showShareSettings=function(n){return t.gapiLoad("drive-share").then((function(){var i=new gapi.drive.share.ShareClient(t.getAppId());i.setItemIds([n]),i.showSettingsDialog();var o=e.defer(),a=r((function(){for(var e=!1,t=document.activeElement;t!==document.documentElement;){if(t.classList.contains("dcs-ad-dcs-c")){e=!0;break}t=t.parentNode}e||(r.cancel(a),o.resolve())}),300);return o.promise}))},s.listPermissions=function(e){return o.debug("googledrive.listPermissions",e),l("files/"+e+"/permissions").then((function(e){return e.items}))},s.insertPermission=function(e,t){return o.debug("googledrive.insertPermissions",e),d("files/"+e+"/permissions",t)},s.patchPermission=function(e,t,n){return o.debug("googledrive.patchPermission",e),f("files/"+e+"/permissions/"+t,n)},s.removePermission=function(e,t){return o.debug("googledrive.removePermission",e,t),p("files/"+e+"/permissions/"+t)},s.getContextAction=function(){var e=n.search().state,t=null;if(angular.isString(e))try{t=JSON.parse(e)}catch(r){}return t?{action:t.action,ids:(t.ids||[]).concat(t.exportIds||[]),parentId:t.parentId,userId:t.userId}:null},s.listComments=function(e){return l(`files/${e}/comments`,{maxResults:100}).then((function(e){return e.items}))},s.insertComment=function(e,t){return d(`files/${e}/comments`,{content:t})},s.patchComment=function(e,t,n){return f(`files/${e}/comments/${t}`,{content:n})},s.deleteComment=function(e,t){return p(`files/${e}/comments/${t}`)},s}])},"D+N8":function(e,t){angular.module("castifyExt.simpleBgServicePublisher",["w69b.chromeRuntime"]).factory("simpleBgServicePublisher",["chromeRuntime","$q","$log",function(e,t,n){return function(r,i,o){var a={};function c(e,o,c){var s=function(e){try{c(e)}catch(t){}};return!(!e||"simpleService"!==e.type||e.service!==r||!i.hasOwnProperty(e.fn)||a[e.fn]||(t.when(i[e.fn](...e.data)).then((function(e){s({data:e})}),(function(t){n.debug(`simpleService(${r}).${e.fn} failed : `,t),s({error:t})})),0))}return(o||[]).forEach((function(e){a[e]=!0})),e.onMessage.addListener(c),function(){e.onMessage.removeListener(c)}}}])},EtE5:function(e,t,n){"use strict";n.r(t);var r,i,o=n("TYT/"),a=n("Llzl"),c=n.n(a),s=n("D57K"),u=Object(s.__assign)(Object(s.__assign)({},(r={test:!1,production:!1,environmentName:"screencastly"},Object(s.__assign)(Object(s.__assign)({},r),{environmentName:"production",firebaseConfig:{apiKey:"AIzaSyDraAcnfh7TewzYJS9yt8Togm6_VzB_RJE",authDomain:"castify-storage.firebaseapp.com",databaseURL:"wss://castify-storage.firebaseio.com",projectId:"castify-storage",storageBucket:"castify-storage.appspot.com",messagingSenderId:"37637381719"}}))),{production:!0}),l=n("cekD"),d=n("vEql"),f=n.n(d);n("6AkR"),n("MZO8"),n("WpLb"),Object(l.a)((function(){return[d,(i||(i=d.initializeApp(u.firebaseConfig)),i)]})),n("q6u/"),n("9br6"),n("6Mel"),n("tYv9"),n("gfU1");var p=function(){function e(e,t,n,r){this.spawn=e,this.optionalPermissions=t,this.chromeCommands=n,this.webrtc=r,this.setShortcuts=this.spawn.wrap((function(e){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.shouldUseCastifyDraw(e)];case 1:return n.sent()?(t=e.draw,[4,this.chromeCommands.getAll()]):[3,3];case 2:t.chromeCommands=n.sent(),n.label=3;case 3:return[2]}}))})),this.shouldUseCastifyDraw=this.spawn.wrap((function(e){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.optionalPermissions.hasTabPermissions(e)];case 1:return t=n.sent(),[2,["tab","desktop","screen","tab_picker"].includes(e.captureSource)&&t&&!!e.draw]}}))})),this.setControlWebcam=this.spawn.wrap((function(e){var t,n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return t=e.draw,(n=e.audio.mic||e.embedWebcam||"pip"===e.draw.webcamDisplay)?[4,this.webrtc.hasVideoAccess()]:[3,2];case 1:n=r.sent(),r.label=2;case 2:return t.controlWebcam=n,[2]}}))}))}return e.$inject=["spawn","optionalPermissions","chromeCommands","webrtc"],e.prototype.createFromConfig=function(e){var t;return e.draw?((t=e.draw).controlWebcam=!1,t.embedWebcam=!1,t.webcamDisplay="embed",("tab"===e.captureSource||function(e){return"webrtc"===e.encoder&&["desktop","screen","tab_picker"].includes(e.captureSource)}(e))&&(t.controlWebcam=!0,t.embedWebcam=e.embedWebcam,t.camSourceId=e.camSourceId),t):null},e.prototype.enablePiP=function(e){e.controlWebcam=!0,e.webcamDisplay="pip",e.pip=!0,e.embedWebcam=!1},e}();function h(e,t,n,r){var i={videoTitleNamingScheme:"tabTitle",notifyAudio:!0,notifyFramerate:!1,notifyTabFocus:!0,uploadPrivacy:"public",autoOpen:!0,autoPlay:!0,driveSync:!1,enableDiskSpaceWatcher:!0,notifySyncProgress:!1,notifyEditProgress:!0,enableAnalytics:!0,showEditToolsHint:!0,enableWindowPicker:!0,encoder:null,audioCodec:null,bitRateOption:"high",hwEncoding:!1,hideRestartAlert:!1,hideDiscardAlert:!1,featureRolloutRand:null,hasUsedAudioExport:!1,enableEditorTrial:!1,enableInlinePopupUi:!1,enablePiP:!1,enableAudioExport:!1,hasSilencedTrimConfirm:!1,hasVisitedNewVDP:!1,enableVDPForVariants:!1,showDriveIssueBar:!1,enableQRCode:!1,enableGifExport:!1,useVideoExportForAudioExport:!1,enableTimeLimitWarning:!1},o=!1,c={},s={},u={};function l(e){return r.options.hasOwnProperty(e)}return c.localValues=a.copy({micGain:1,micAudioProcessing:!0}),c.loadedPromise=n.all({sync:e.sync.getSingle("options"),local:e.local.getSingle("options"),rollout:e.sync.getSingle("rolloutOptions"),managed:r.loadedPromise}).then((function(e){a.extend(s,e.sync),a.extend(u,e.rollout),a.extend(c.localValues,e.local),o=!0})),c.values={},Object.keys(i).forEach((function(e){Object.defineProperty(c.values,e,{enumerable:!0,get:function(){return l(e)?function(e){return r.options[e]}(e):s.hasOwnProperty(e)?s[e]:u.hasOwnProperty(e)?u[e]:i[e]},set:function(t){s[e]=t}})})),c.setRolloutValues=function(t){return e.sync.setSingle("rolloutOptions",u=t)},c.save=function(){return e.sync.setSingle("options",s)},c.saveLocal=function(){return e.local.setSingle("options",c.localValues)},c.isLoaded=function(){return o},c.isSetByEnterprisePolicy=function(e){return l(e)},e.onChanged.addListener((function(e,n){"sync"===n&&e.options&&(a.extend(s,e.options.newValue),t.$$phase||t.$digest()),"sync"===n&&e.rolloutOptions&&(a.extend(u,e.rolloutOptions.newValue),t.$$phase||t.$digest()),"local"===n&&e.options&&(a.extend(c.localValues,e.options.newValue),t.$$phase||t.$digest())})),c}a.module("castifyExt.drawConfig",[]).service("drawConfig",p),a.module("castifyExt.chromeVideoRecorder",["w69b.pnaclVideoEncoder","w69b.webrtc","w69b.chromeCapture","w69b.chromeTabs","w69b.promiseTool","w69b.spawn","w69b.chromeCommands","castifyExt.ui.audioCountdown","castifyExt.optionalPermissions","castifyExt.resizeTab","castifyExt.audioStreamMixer","castifyExt.requestMicPermission","castifyExt.webrtcRecorder","castifyExt.recordTool","castifyExt.hdpiTool","castifyExt.deadAudioStreamChecker","w69b.filesHelper","castifyExt.pip","castifyExt.drawConfig","cf2.upgradeHelperService"]).provider("chromeVideoRecorder",(function(){var e="/components/castify/pnacl/manifest_pnacl.nmf",t=!0;this.setEncoderUrl=function(n,r){e=n,t=!!r},this.$get=["$log","pnaclVideoEncoder","webrtc","chromeCapture","$q","cf2BgCastifyDrawService","resizeTab","chromeTabs","audioStreamMixer","$rootScope","requestMicPermission","promiseTool","optionalPermissions","spawn","hdpiTool","webrtcRecorder","audioCountdown","filesHelper","deadAudioStreamChecker","pip","drawConfig","cf2UpgradeHelperService",function(n,r,i,o,c,u,l,d,f,p,h,g,m,b,v,y,w,_,S,E,C,I){var A,O,j,x,T=[{width:1920,height:1080},{width:1280,height:720},{width:854,height:480},{width:640,height:360},{width:320,height:240},{width:320,height:180}],R=2e3,P={},k=document.createElement("video"),$=null,F={},D=null,M=!1;function U(e,t){var n=e.getSettings();return Math.floor(n.height*n.width*t)}function L(){n.warn("video stream ended while still recording"),p.$broadcast("chromeVideoRecorder:streamEnded")}function B(e){e.getTracks().forEach((function(e){e.stop()}))}function N(){return Number((/Chrome\/(\d+)/.exec(window.navigator.userAgent)||[void 0,0])[1])}function V(){j&&j.dispose(),j=null,P.video&&P.video.removeEventListener("inactive",L),a.forEach(P,(function(e){B(e)})),P={}}function H(e){P.video&&(P.video.removeEventListener("inactive",L),B(P.video)),P.video=e,e.addEventListener("inactive",L)}function q(e){return e&&("PermissionDeniedError"===e.name||"MediaDeviceFailedDueToShutdown"===e.name||"NotAllowedError"===e.name||"InvalidStateError"===e.name)}function W(e){return n.debug("capture mic failed",e&&e.name),c.reject("NotReadableError"===e.name?"start_error:no_audio_access":e)}function z(e){var t={video:!0};return e.camSourceId&&(t.video={deviceId:e.camSourceId}),i.getUserMedia(t)}var J=b.wrap((function(e){function t(){var t=[],n=T.filter((function(e){return e.height<=r.height}));e.resolution&&(n=n.filter((function(e){return e.height!==r.height}))).unshift(r),n.forEach((function(e){t.push({minHeight:e.height})}));var i={audio:K(e),video:{optional:t,mandatory:{maxWidth:r.width,maxHeight:r.height,maxFrameRate:e.targetFPS}}};return e.camSourceId&&(i.video.mandatory.sourceId=e.camSourceId),S.getUserMedia(i).catch(W)}var r,i;return Object(s.__generator)(this,(function(o){switch(o.label){case 0:(r=e.resolution)||(r={width:4096,height:4096}),o.label=1;case 1:return o.trys.push([1,3,,7]),[4,t()];case 2:return[2,o.sent()];case 3:return q(i=o.sent())?[4,h()]:[3,6];case 4:return o.sent(),[4,t()];case 5:return[2,o.sent()];case 6:return n.warn("failed to get webcam stream",i),[2,c.reject(i)];case 7:return[2]}}))}));function G(e){return e||c.reject("stream is null")}var Y=b.wrap((function(e){var t,n,r,a,u,l;return Object(s.__generator)(this,(function(d){switch(d.label){case 0:return(t=e.resolution)||(t={width:4096,height:4096}),n=e.audio.system,x&&x.cancelled?[2,c.reject("cancelled")]:["desktop","screen","tab_picker"].includes(e.captureSource)?(r=void 0,r="desktop"===e.captureSource?["screen","window"]:"screen"===e.captureSource?["screen"]:["tab"],N()>=50&&e.audio.system&&r.push("audio"),($=o.chooseDesktopMedia(r)).promise.finally((function(){$=!1})),[4,$.promise]):[3,2];case 1:return(a=d.sent())?(l={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxWidth:t.width,maxHeight:t.height,maxFrameRate:e.targetFPS}}},r.includes("window")&&(u=v.scaleResolution(v.getScreenCssResolution(),t),l.video.mandatory=Object(s.__assign)(Object(s.__assign)({},l.video.mandatory),{maxWidth:u.width,maxHeight:u.height,minWidth:u.width,minHeight:u.height})),n&&(l.audio={mandatory:{chromeMediaSource:N()>=52?"desktop":"system"}}),[2,i.getUserMedia(l).then(G)]):[2,c.reject("cancelled")];case 2:if("tab"===e.captureSource)return l={video:!0,videoConstraints:{mandatory:{maxWidth:t.width,maxHeight:t.height,maxFrameRate:e.targetFPS}},audio:n},n&&(l.audioConstraints={mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1}}),[2,o.tabCapture(l).then(G)];if("cam"===e.captureSource)return[2,J(e).then(G)];throw Error();case 3:return[2]}}))}));function K(e){if(e.audio.mic){var t={echoCancellation:!1!==e.audio.micAudioProcessing};return e.audio.micSourceId&&(t.sourceId=e.audio.micSourceId),{mandatory:t}}return!1}function Q(e){var t=!!e.embedWebcam;function r(){return S.getUserMedia({audio:K(e),video:t}).catch(W)}return t&&e.camSourceId&&(t={mandatory:{sourceId:e.camSourceId}}),r().catch((function(e){return q(e)?(n.debug("requesting mic permission"),h().then(r)):c.reject(e)}))}function X(){E.close(),u.disposeAll(),V(),O&&(O=null),D=null}function Z(e){e.audio.system&&"tab"===e.captureSource&&(k.srcObject=P.video,k.volume=1,k.play())}function ee(e){for(var t=2,n=t,r=1;r<Math.floor(16/v.devicePixelRatio);++r)if((n=Math.round(100*v.devicePixelRatio*r)/100)%2==0){t=n;break}var i=e.width%t,o=e.height%t;return!(!i&&!o||(e.width-=i,e.height-=o,0))}function te(e){return e.startDelay&&!1!==e.audibleCountdown?g.withTimeout((function(){return w.load(e.startDelay).catch((function(e){n.warn("ChromeRecordingConfigVideoRecorder: loading countdown failed: ",e)}))}),R,(function(){return n.warn("chromeVideoRecorder: loading countdown timed out"),!0})):null}function ne(e){n.debug("ignoring rejection",e)}return F.togglePipWebcam=b.wrap((function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return E.isActive?(E.close(),[3,4]):[3,1];case 1:return[4,E.open()];case 2:return t.sent(),e=P,[4,z(A)];case 3:e.pip=t.sent(),E.playVideoStream(P.pip),t.label=4;case 4:return[2]}}))})),F.start=function(i){var o,h=b.wrap((function(){var e,t,n,r;return Object(s.__generator)(this,(function(o){switch(o.label){case 0:return"tab"!==i.captureSource?[2,null]:(n=(t=v).toPhysicalResolution,[4,d.get(i.tabId)]);case 1:return e=n.apply(t,[o.sent()]),i.resolution||(i.resolution=a.copy(e)),i.resolution=v.scaleResolution(e,i.resolution),ee(i.resolution),ee(e)?(r=v.toCssResolution(e),[4,l(i.tabId,r.width,r.height,!1)]):[3,3];case 2:o.sent(),o.label=3;case 3:return[2,null]}}))})),g=b.wrap((function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return i.audio.mic||i.embedWebcam?"cam"!==i.captureSource?[3,1]:(e=o,[3,3]):[3,4];case 1:return[4,Q(i)];case 2:e=t.sent(),t.label=3;case 3:return[3,5];case 4:e=null,t.label=5;case 5:return e&&(P.mic=e),[2,e]}}))})),_=b.wrap((function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return"tab"!==i.captureSource?[3,2]:[4,m.hasTabPermissions(i)];case 1:if(!e.sent())return[2,c.reject("tab_permissions_denied")];e.label=2;case 2:return[2]}}))})),S=b.wrap((function(){var e,t,r,a;return Object(s.__generator)(this,(function(s){switch(s.label){case 0:return E.isActive?(t=P,[4,z(i)]):[3,2];case 1:t.pip=s.sent(),E.playVideoStream(P.pip),s.label=2;case 2:return[4,c.all([O.load(),h(),_(),te(i)])];case 3:s.sent(),n.debug("chromeVideoRecorder: getting video stream"),s.label=4;case 4:return s.trys.push([4,6,,7]),[4,Y(i)];case 5:return o=s.sent(),[3,7];case 6:throw r=s.sent(),n.warn("chromeVideoRecorder: could not get video stream",l=r),c.reject(l),r;case 7:return E.isActive&&(E.shouldUse(o)?(E.drawConfig=i.draw,C.enablePiP(i.draw),i.embedWebcam=!1):E.close()),[4,g()];case 8:return e=s.sent(),n.debug("chromeVideoRecorder: got video stream"),H(o),[4,"tab"===i.captureSource?d.get(i.tabId).then((function(e){D.originalMainSize={width:e.width,height:e.height}})):null];case 9:return s.sent(),[4,C.shouldUseCastifyDraw(i)];case 10:return s.sent()?[4,C.setShortcuts(i)]:[3,17];case 11:return s.sent(),i.draw.controlWebcam?[4,C.setControlWebcam(i)]:[3,13];case 12:s.sent(),i.embedWebcam=!1,s.label=13;case 13:return s.trys.push([13,15,,16]),[4,u.loadInTab(i.tabId,i.draw)];case 14:return s.sent(),[3,16];case 15:return a=s.sent(),n.warn("chromeVideoRecorder: failed to initialize draw",a),"webrtc"===i.encoder&&"tab"===i.captureSource&&(i.startDelay=0,D.startDelay=0,w.stop()),[3,16];case 16:return[3,18];case 17:i.draw=null,s.label=18;case 18:return n.debug("chromeVideoRecorder: got all streams"),D.videoTrack=o.getVideoTracks()[0],"webrtc"===i.encoder&&(D.bitRate=function(e,t){switch(t){case"medium":return U(e,5);case"low":return U(e,1);case"high":default:return U(e,20)}}(D.videoTrack,i.bitRateOption)),i.audio.system&&!o.getAudioTracks().length&&(i.audio.system=!1,n.warn("failed to capture system audio - stream has no audio track."),p.$broadcast("chromeVideoRecorder:systemAudioUnsupported")),i.audio.system&&i.audio.mic?"webrtc"===i.encoder?(j=f(),D.audioTrack=j.outStream.getAudioTracks()[0],e&&i.audio.mic&&(j.addStream("mic",e),j.setGain("mic",i.audio.micGain||1)),i.audio.system&&j.addStream("system",o)):(D.audioTrack=o.getAudioTracks()[0],D.audioTrack2=e.getAudioTracks()[0],D.micVolume=i.audio.micGain||1):i.audio.mic?"webrtc"!==i.encoder?(D.audioTrack2=e.getAudioTracks()[0],D.micVolume=i.audio.micGain||1):D.audioTrack=e.getAudioTracks()[0]:i.audio.system&&(D.audioTrack=o.getAudioTracks()[0]),i.embedWebcam&&e&&e.getVideoTracks().length&&(D.camTrack=e.getVideoTracks()[0],D.camPosition=i.camPosition),Z(i),n.debug("chromeVideoRecorder: starting encoder...",D),[4,O.start(i.filename,D)];case 19:return s.sent(),n.debug("chromeVideoRecorder: recording started"),w.start(),[2]}var l}))}));!function(){if(D={},A=i,function(e){e.hwEncoding&&(n.debug("chromeVideoRecorder: trying to use hw encoding"),e.encoder="webrtc",D.mimeType='video/webm; codecs="h264, opus"',(!e.resolution||e.resolution.width>1920)&&(e.resolution={width:1920,height:1080}))}(i),"webrtc"===i.encoder?D.mimeType||(D.mimeType='video/webm; codecs="vp8, opus"'):("nacl"===i.encoder?D.codec=null:i.encoder&&(D.codec=i.encoder),i.audioCodec&&(D.audioCodec=i.audioCodec)),i.draw=C.createFromConfig(i),i.targetFPS=i.targetFPS||30,i.draw&&(i.draw.timeLimit=I.getRecordingTimeLimit()),"cam"===i.captureSource&&(i.audio.system=!1,i.embedWebcam=!1,D.videoTrackIsCam=!0),!i.filename)throw new Error("filename required");i.audio||(i.audio={}),i.brandingFilename&&(D.brandingFilename="/html5_persistent/"+i.brandingFilename),i.startDelay&&(D.startDelay=i.startDelay),x={cancelled:!1,cancel:function(){x.cancelled=!0,$&&$.cancel("cancelled")}},(O=function(){if("webrtc"===i.encoder){if(y.isSupported(i.mimeType))return y();D.encoder=null}return r(e,t)}()).onCrash=function(e){n.warn("video encoder crashed",e),X(),p.$broadcast("chromeVideoRecorder:crash",e)},O.onError=function(e){"start_timeout"===e||a.isString(e)&&e.startsWith("start_timeout:")||(X(),p.$broadcast("chromeVideoRecorder:error",e))}}();var T=S().catch((function(e){return n.error("chromeVideoRecorder: start error",e),X(),c.reject(e)}));return x.promise=T,T.finally((function(){x=null})),T},F.setAutoStop=function(e){A.nonpersistent.autoStop=e},F.discard=b.wrap((function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return E.stop(),[4,w.stop()];case 1:return e.sent(),u.disposeAll(),[4,O.stop()];case 2:return e.sent(),V(),O=null,D=null,n.debug("chromeVideoRecorder: discarding recording"),[4,_.removeByPath(A.filename)];case 3:return e.sent(),[2]}}))})),F.restart=b.wrap((function(e,t){var r,i,o,a,l;return void 0===e&&(e=function(){}),void 0===t&&(t=function(e){return e}),Object(s.__generator)(this,(function(f){switch(f.label){case 0:r=b.wrap((function(e){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return n.debug("chromeVideoRecorder: removing files..."),[4,_.removeByPath(e)];case 1:return[2,t.sent()]}}))})),i=b.wrap((function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,w.stop()];case 1:return e.sent(),u.disposeAll(),[4,O.stop()];case 2:return e.sent(),[2]}}))})),o=b.wrap((function(e,t){var n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return[4,te(A)];case 1:return r.sent(),[4,d.getActiveTab()];case 2:return n=r.sent(),A.draw?(A.draw.timeLimit=I.getRecordingTimeLimit(),[4,u.loadInTab(n.id,A.draw).catch(ne)]):[3,4];case 3:r.sent(),r.label=4;case 4:return[4,O.start(e,t)];case 5:return r.sent(),[4,w.start()];case 6:return r.sent(),[2]}}))})),n.debug("chromeVideoRecorder: restarting..."),a=A.filename,M=!0,f.label=1;case 1:return f.trys.push([1,7,8,9]),[4,i()];case 2:return f.sent(),[4,c.when(e())];case 3:return f.sent(),[4,r(a)];case 4:return f.sent(),[4,c.when(t(Object.assign({},A))).then((function(e){return A=e}))];case 5:return f.sent(),[4,o(A.filename,D)];case 6:return f.sent(),[3,9];case 7:throw l=f.sent(),n.error("chromeVideoRecorder: restart error",l),X(),l;case 8:return M=!1,[7];case 9:return[2]}}))})),F.stop=function(){return E.stop(),w.stop(),u.disposeAll(),O.stop().finally((function(){V(),O=null,D=null}))},F.pause=function(){var e=O.pause();return e.then((function(){w.pause()})),e},F.resume=function(){var e=O.resume();return e.then((function(){w.start()})),e},F.setMicGain=function(e){j&&j.setGain("mic",e)},F.getState=function(){return F.getStateObj().state},F.getStateObj=function(){var e;return e=M?{state:"recording",time:0}:O?O.getStateObj():{state:"inactive",time:0},a.extend({},e,{isDesktopDialogShown:!!$})},F.cancelPendingStart=function(){return!!x&&(x.cancel(),!0)},F.getCurrentTime=function(){return O?O.getCurrentTime():0},F.getRecordingConfig=function(){return A},F.replaceStream=b.wrap((function(e){var t,r,i,o,l,d;return Object(s.__generator)(this,(function(s){switch(s.label){case 0:if(A.tabId===e.tabId)throw new Error("cannot replace stream for same tab");if(t=A.tabId,r=A.audio.system,i=a.extend({},A,e),!O.replaceTracks)throw new Error("chromeVideoRecorder: replaceTracks not supported by chosen recorder");s.label=1;case 1:return s.trys.push([1,3,,4]),[4,Y(i)];case 2:return o=s.sent(),[3,4];case 3:return l=s.sent(),n.warn("could not get replacement stream",l),[2,c.reject(l)];case 4:return A=i,d={videoTrack:o.getVideoTracks()[0]},r&&(d.audioTrack=o.getAudioTracks()[0]),i.draw&&(i.draw.timeLimit=I.getRecordingTimeLimit(),u.loadInTab(i.tabId,i.draw).catch(ne),u.disposeInTab(t)),[4,O.replaceTracks(d)];case 5:return s.sent(),D.videoTrack=o.getVideoTracks()[0],H(o),Z(i),[2]}}))})),F}],this.$get.$inject=["$log","pnaclVideoEncoder","webrtc","chromeCapture","$q","cf2BgCastifyDrawService","resizeTab","chromeTabs","audioStreamMixer","$rootScope","requestMicPermission","promiseTool","optionalPermissions","spawn","hdpiTool","webrtcRecorder","audioCountdown","filesHelper","deadAudioStreamChecker","pip","drawConfig","cf2UpgradeHelperService"]})),n("mim6"),h.$inject=["cf2ChromeStorageService","$rootScope","$q","enterprisePolicy"],a.module("castifyExt.appOptions",["cf2.chromeStorageService","castifyExt.enterprisePolicy"]).factory("appOptions",h),n("fNYK");var g=function(){function e(e,t){this.$log=e,this.appOptions=t,this.isActive=!1,this.OPENING="OPENING",this.CLOSING="CLOSING",this._stopVideo=this._stopVideo.bind(this),this._leavePipListener=this._leavePipListener.bind(this)}return e.$inject=["$log","appOptions"],e.prototype.isSupported=function(){var e=this._getChromeVersion();return this.appOptions.values.enablePiP&&(e>=71&&window.navigator.userAgent.includes("Mac OS")||e>=74)},e.prototype._getChromeVersion=function(){return Number((/Chrome\/(\d+)/.exec(window.navigator.userAgent)||[void 0,0])[1])},e.prototype.shouldUse=function(e){var t=e.getVideoTracks()[0],n=t.label.includes("window"),r=t.label.includes("screen");return!n&&!!r},e.prototype.open=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),this._state===this.OPENING?[2]:(this._state=this.OPENING,this.$log.debug("pip: opening..."),[4,this._video.requestPictureInPicture()]);case 1:return t.sent(),this.isActive=!0,this._video.addEventListener("leavepictureinpicture",this._leavePipListener),[3,3];case 2:return e=t.sent(),this.$log.warn("pip: crashed: ",e.message),[3,3];case 3:return this._state=null,[2]}}))}))},e.prototype._leavePipListener=function(){try{if(this._state===this.CLOSING)return;this._state=this.CLOSING,this.isActive=!1,this._stopVideo(),this._drawConfig&&(this._drawConfig.pip=!1),this._video.removeEventListener("leavepictureinpicture",this._leavePipListener)}catch(e){this.$log.warn("pip: closing failed: ",e.message)}this._state=null},e.prototype._stopVideo=function(){this._stream&&this._stream.getTracks().filter((function(e){return"video"===e.kind})).forEach((function(e){return e.stop()})),this._stream=null},e.prototype.close=function(){this.isActive&&this._state!==this.CLOSING&&(this.$log.debug("pip: closing..."),document.exitPictureInPicture())},e.prototype.playVideoStream=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),this._stream=e,this._video.srcObject=e,[4,this._video.play()];case 1:return n.sent(),this._drawConfig.pip=!0,[3,3];case 2:return t=n.sent(),this.$log.debug("pip: playVideoStream failed",t.message),[3,3];case 3:return[2]}}))}))},Object.defineProperty(e.prototype,"drawConfig",{set:function(e){this._drawConfig=e},enumerable:!0,configurable:!0}),e.prototype.stop=function(){this.close(),this.drawConfig=null},e.prototype.load=function(){if(!this._video){var e=document.createElement("video");e.muted=!0,e.setAttribute("preload","metadata"),e.src="../../../videos/black.mp4",this._video=e,document.body.appendChild(this._video),this._state=null}},e}();function m(e){return new Promise((function(t){var n=new Image;n.crossOrigin="anonymous",n.addEventListener("load",(function e(){n.removeEventListener("load",e),t(n)})),n.src=e}))}function b(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n,r;return Object(s.__generator)(this,(function(i){switch(i.label){case 0:return[4,m(e)];case 1:return t=i.sent(),n=new OffscreenCanvas(t.width,t.height),(r=n.getContext("2d")).drawImage(t,0,0,n.width,n.height),[2,r.getImageData(0,0,n.width,n.height)]}}))}))}function v(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n,r;return Object(s.__generator)(this,(function(i){switch(i.label){case 0:return t={},n={},r=38,[4,b(e)];case 1:return[2,(t.imageData=(n[r]=i.sent(),n),t)]}}))}))}a.module("castifyExt.pip",["castifyExt.appOptions"]).service("pip",g);var y=function(){function e(e){this.encoder=null,this.embedWebcam=!1,Object.assign(this,e)}return e.prototype.isWindowOrScreenCapturing=function(){return"desktop"===this.captureSource||"screen"===this.captureSource},e}();a.module("castifyExt.bgRecord",["w69b.chromeTabs","w69b.chromeAnalytics","cf2.chromeStorageService","w69b.chromeWindows","w69b.chromeNotifications","w69b.filesHelper","w69b.chromeRuntime","w69b.spawn","castifyExt.switchTab","castifyExt.chromeVideoRecorder","castifyExt.bgFiles","castifyExt.bgUserAccount","castifyExt.appOptions","castifyExt.recordTool","castifyExt.fileNameGenerator","cf2.sentryErrorHandler","castifyExt.helpCenter","castifyExt.branding","castifyExt.connect.appRegistry","castifyEdit.bgEditJobScheduler","castifyExt.ui.countdownIcon","castifyExt.optionalPermissions","castifyExt.bgUserNotifications","castifyExt.pip","cf2.upgradeHelperService"]).factory("bgRecordService",["chromeVideoRecorder","$rootScope","$q","$log","chromeRuntime","chromeTabs","$window","analytics","appOptions","recordTool","fileNameGenerator","bgFiles","cf2ChromeStorageService","chromeWindows","sentryErrorHandler","chromeNotifications","helpCenter","branding","appRegistry","filesHelper","spawn","bgEditJobScheduler","countdownIcon","cf2BgUsageStatsService","userAccount","switchTab","optionalPermissions","userNotifications","pip","cf2UpgradeHelperService",function(e,t,n,r,i,o,c,u,l,d,f,p,h,g,m,b,w,_,S,E,C,I,A,O,j,x,T,R,P,k){var $,F,D,M,U,L=[],B=!1,N=n.when(),V="/_recording",H={};function q(e){return X._pathToIconConfig("images/"+e+"38.png")}function W(e){if(B)throw new Error("already blocked");B=!0;var t=n.defer();return N=t.promise,e.finally((function(){B=!1,t.resolve()})),e}function z(e,n){r.warn("bgRecord: recorder_fatal_error",n),m.handleError(n&&n.stack?n:new Error("recorder_fatal_error "+n)),K(),"out_of_disk_space"===n?w.setNotifyHelp(b.simple.create({priority:1,title:"Out of disk space",message:"Recording was stopped forcefully. Your recording might be corrupted.",buttons:[{title:"Help"}]},"disk_space")):"no_data"===n?w.setNotifyHelp(b.simple.create({priority:1,title:"Oops, we failed to capture anything",message:"Please try to restart you computer if this problem persists."}),"no_audio"):"add_frame_failed"===n?t.$broadcast("recorder:out_of_memory"):b.simple.create({priority:1,title:"Oops, something went wrong",message:"Please try to restart Chrome if this problem persists."})}function J(){m.handleError(new Error("encoder_crash")),K(),t.$broadcast("recorder:encoder_crash")}var G=C.wrap((function(t){var n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return t||(t=e.getState()),"paused"!==t?[3,2]:[4,q("icon_paused")];case 1:return n=r.sent(),[3,9];case 2:return"recording"!==t?[3,7]:e.getCurrentTime()<0?[4,A.getIcon(e.getCurrentTime())]:[3,4];case 3:return n=r.sent(),[3,6];case 4:return[4,q("icon_recording")];case 5:n=r.sent(),r.label=6;case 6:return R.hideIconBadge(),[3,9];case 7:return[4,q("icon")];case 8:n=r.sent(),R.showIconBadge(),r.label=9;case 9:return chrome.browserAction.setIcon(n),[2]}}))}));function Y(t,n){if(void 0===n&&(n=!1),L.length){var r,i=a.copy(e.getStateObj());a.extend(i,t),i.config=e.getRecordingConfig(),i.previewShown=!!F,i.isBlocked=B,(n||!a.equals(i,H))&&(r=i,L.forEach((function(e){e.postMessage({type:"stateUpdate",data:r})})),H=i)}}function K(){r.debug("bgRecord: cleaning up after fatal error stop"),o.onActivated.removeListener(X.onTabActivated),ue(),B=!1,ce(!1)}var Q=C.wrap((function(n,i){var o,a,u,l,d,f,g,m,b;return Object(s.__generator)(this,(function(s){switch(s.label){case 0:return r.debug("bgRecord: stop finished"),(o=e.getRecordingConfig()).timeLimitReached=!!i,u=(a=o.filename).split("/").slice(-1)[0],l=p.localFilenameToId(u),d=!1,c.navigator.userAgent.includes("Windows")&&"webrtc"!==o.encoder?(m=(g=E).getMetadata,[4,E.getFileEntryByPath(a)]):[3,4];case 1:return[4,m.apply(g,[s.sent()])];case 2:return(f=s.sent()).size>2e9?(r.debug("Working around 2GB chrome bug on Windows for file of size",f.size),[4,ae(a,l,u)]):[3,4];case 3:s.sent(),d=!0,s.label=4;case 4:return d?[3,6]:[4,E.moveFileByPath(a,u)];case 5:s.sent(),s.label=6;case 6:return h.local.remove("bgRecord:pendingConfig"),n>0?[4,j.getAccount()]:[3,8];case 7:b=s.sent(),O.updateMonthlyStats(n,b.license.isPaid),s.label=8;case 8:return t.$broadcast("recorder:stopped",l,o),[2]}}))})),X={};function Z(n,i,o){var a,c;switch(n){case"stop":a=e.stop(),c=function(){return Q(i,o)};break;case"pause":a=e.pause(),c=function(){return r.debug("bgRecord: "+n+" finished")};break;case"resume":a=e.resume(),c=function(){return r.debug("bgRecord: "+n+" finished")};break;case"restart":a=e.restart((function(){t.$broadcast("recorder:canceled",e.getRecordingConfig())}),(function(e){return f(V+"/",".webm").then((function(t){e.filename=t;var n=t.split("/");return e.fileId=p.localFilenameToId(n[n.length-1]),e}))})),c=function(){r.debug("bgRecord: "+n+" finished"),t.$broadcast("recorder:started",e.getRecordingConfig())}}return r.debug("bgRecord: "+n+" in progress..."),a.then(c),W(a),u.trackEvent("recorder",n,"",i||1),a}function ee(){return!l.values.hwEncoding&&(r.info("bgRecord: Enabling hw encoding as default encoder..."),l.values.hwEncoding=!0,l.save(),!0)}function te(){X.stop()}function ne(){b.simple.create({priority:1,title:"Not recording system audio",message:"Capturing system audio is only supported for full-screen or tab recording."},"noSystemAudio")}function re(t){B||(r.debug("bgRecord: replacing stream...",t),"inactive"!==e.getState()?(b.clear("activeTab"),W(e.replaceStream(t))):r.error("bgRecord: cannot replace tab while not recording"))}function ie(e){if("recorder"===e.name){L.push(e),Y({},!0),e.onDisconnect.addListener((function(){var t=L.indexOf(e);t>=0&&L.splice(t,1)}));var n={start:X.start,stop:X.stop,restart:X.restart,replaceStream:re,pause:X.pause,resume:X.resume,discard:X.discard,togglePipWebcam:X.togglePipWebcam,cancelPendingStart:X.cancelPendingStart,showPreview:function(e){e?le():ue()},setAutoStop:X.setAutoStop};e.onMessage.addListener((function(e){n.hasOwnProperty(e.type)&&n[e.type](e.data),t.$$phase||t.$digest()}))}}function oe(t){if(!B){var n=e.getState();if("toggle-recording"===t)"recording"===n||"paused"===n?X.stop():X.start(U);else if("toggle-pause"===t)"paused"===n?X.resume():"recording"===n&&X.pause();else if("focus-tab"===t){var r=e.getRecordingConfig();if("inactive"===n||"tab"!==r.captureSource)return;o.getActiveTab().then((function(e){r.tabId!==e.id&&re({tabId:e.id,windowId:e.windowId,tabTitle:e.title})}))}}}X.restart=function(){return B||"inactive"===e.getState()?n.reject():Z("restart")},X.stop=function(t){if(B||"inactive"===e.getState())return n.reject();o.onActivated.removeListener(X.onTabActivated),ue(),b.clear("audioDropped"),b.clear("lowFrameRate"),b.clear("activeTab"),b.clear("noSystemAudio");var r=e.getCurrentTime();return $.send(),Z("stop",Math.round(r),t)},X.togglePipWebcam=function(){e.togglePipWebcam()},X.pause=function(){return B||"recording"!==e.getState()?n.reject():(b.clear("activeTab"),Z("pause"))},X.resume=function(){if(!B&&"paused"===e.getState())return o.getActiveTab().then((function(e){X.onTabActivated({tabId:e.id,windowId:e.windowId})})),Z("resume")},X.setAutoStop=function(t){e.setAutoStop(t)},X.discard=C.wrap((function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return B||!["paused","recording"].includes(e.getState())?[2]:[4,W(e.discard())];case 1:return t.sent(),u.trackEvent("recorder","discard"),[2]}}))})),X.start=function(i){if(i instanceof y||(i=new y(i)),B||"inactive"!==e.getState())return n.reject();"desktop"===i.captureSource&&P.isSupported()&&i.embedWebcam&&P.open(),o.onActivated.addListener(X.onTabActivated),$=u.trackTimer("recorder","duration"),i.audio.micGain=l.localValues.micGain,i.audio.micAudioProcessing=l.localValues.micAudioProcessing,i.audioCodec=l.values.audioCodec,i.bitRateOption=l.values.bitRateOption,i.hwEncoding=l.values.hwEncoding,i.resolution=i.limitResolution?i.maxResolution:null,l.values.enableWindowPicker||"desktop"!==i.captureSource||(i.captureSource="screen"),i.encoder=l.values.encoder?l.values.encoder:a.isDefined(window.navigator.mimeTypes["application/x-nacl"])?null:"webrtc";var c=C.wrap((function(){var e,t;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return i.autoShareApp&&i.autoShareApp.isPaid?[2]:[4,k.getIsComboVariantExceeded()];case 1:return e=r.sent(),[4,k.getIsVideoStorageLimitExceeded()];case 2:return t=r.sent(),e?[2,n.reject("combo_variant_limit")]:t?[2,n.reject("video_storage_limit")]:k.isMonthlyLimitExceeded?[2,n.reject("monthly_recordings_limit")]:[2]}}))}));r.debug("bgRecord: starting in progress",i),M={cancelled:!1,cancel:function(){M.cancelled=!0,e.cancelPendingStart()}};var d=(i.autoShareApp?S.getAppInfo(i.autoShareApp.id).then((function(e){i.autoShareApp=e})):n.when()).then(c).then((function(){var e=[];return e.push(E.getDirByPath(V,{create:!0})),e.push(f(V+"/",".webm").then((function(e){i.filename=e;var t=e.split("/");i.fileId=p.localFilenameToId(t[t.length-1])}))),e.push(function(e){return o.getActiveTab().then((function(t){e.tabId=t.id,e.windowId=t.windowId,e.tabTitle=t.title}))}(i)),i.autoShareApp&&i.autoShareApp.isPaid||e.push(_.getFilename().then((function(e){e&&(i.brandingFilename=e)}))),n.all(e)})).then((function(){return M.cancelled?n.reject("cancelled"):e.start(i).catch((function(t){return"nacl_load"!==t||"webrtc"===i.encoder||i.hwEncoding?n.reject(t):function(){r.info("bgRecord: retrying with hw encoding..."),i.hwEncoding=!0;var t=e.start(i);return t.then(ee),t}()}))}));return W(d),d.finally((function(){M=null})),d.then((function(){r.debug("bgRecord: started recording"),h.local.setSingle("bgRecord:pendingConfig",i),i.showPreview&&le(),t.$broadcast("recorder:started",i)}),(function(e){if("cancelled"!==e)return Y({startError:e}),function(e,t){m.handleError(e&&e.stack?e:new Error("start_error "+e)),"nacl_load"===e?w.setNotifyHelp(b.simple.create({priority:1,title:"Failed to load NaCl module",message:"Click for help",buttons:[{title:"Help"}]}),"load_nacl"):"tab_permissions_denied"===e?b.simple.create({priority:1,title:"Tab recording and annotation tools requires additional permissions.",message:"Please use the Screencastify Icon to start recording."}):"monthly_recordings_limit"===e?w.setNotifyHelp(b.simple.create({priority:1,title:"Monthly recording limit reached.",message:"Please upgrade to make more recordings this month.",buttons:[{title:"Upgrade"}]}),"monthly_recordings_limit"):"video_storage_limit"===e?w.setNotifyHelp(b.simple.create({priority:1,title:"Video storage limit reached.",message:"Please upgrade to store more videos.",buttons:[{title:"Upgrade"}]}),"video_storage_limit"):"combo_variant_limit"===e?w.setNotifyHelp(b.simple.create({priority:1,title:"Limit reached.",message:"Please upgrade to store and make more recordings.",buttons:[{title:"Upgrade"}]}),"combo_variant_limit"):"start_timeout:no_audio"===e?w.setNotifyHelp(b.simple.create({priority:1,title:"Failed to capture audio",message:"Please try to restart you computer or re-plug your mic."}),"no_audio"):"start_error:no_audio_access"===e?w.setNotifyHelp(b.simple.create({priority:1,title:"Failed to access your microphone",message:"Please disable it or restart your computer and try again. Click here for help."}),"no_audio_access"):"start_timeout:no_cam"===e?w.setNotifyHelp(b.simple.create({priority:1,title:"Failed to capture your webcam",message:"Please try to restart you computer or re-plug your cam."}),"no_cam"):w.setNotifyHelp(b.simple.create({priority:1,title:"Failed to start recording",message:"tab"===t.captureSource?"Please try to re-open the tab you are trying to record.":"Please try to restart your computer if this problem persists",buttons:[{title:"Help"}]}),"start_recording")}(e,i),n.reject(e)})),d},X.onTabActivated=C.wrap((function(t){var n,i;return Object(s.__generator)(this,(function(o){switch(o.label){case 0:return n=e.getRecordingConfig(),[4,T.hasTabPermissions(n)];case 1:return i=o.sent(),"recording"!==e.getState()?[2]:("desktop"!==n.captureSource&&"screen"!==n.captureSource||!i?"tab"===n.captureSource&&(t.tabId!==n.tabId&&l.values.notifyTabFocus&&t.windowId===n.windowId?x.chromeNotify(n):(r.debug("bgRecord: recording tab got focus"),b.clear("activeTab"))):x.loadAdditionalDraw(t.tabId,n.draw),[2])}}))}));var ae=C.wrap((function(e,t,n){var i,o,a,c,u;return Object(s.__generator)(this,(function(s){switch(s.label){case 0:return[4,l.loadedPromise];case 1:return s.sent(),l.values.instantUpload&&l.values.driveSync?(r.warn("bgRecord: skipping fix job since instantUpload is enabled"),[4,E.moveFileByPath(e,n)]):[3,3];case 2:return s.sent(),[3,10];case 3:return a=(o=E).getMetadata,[4,E.getFileEntryByPath(e)];case 4:return[4,a.apply(o,[s.sent()])];case 5:i=s.sent(),r.debug("bgRecord: adding fix job for incomplete recording",e,i.size),c=I.addJob({type:"fixWebm",inPath:e,fileId:t,outPath:n,meta:{fileId:t}}),s.label=6;case 6:return s.trys.push([6,8,,10]),[4,c.promise];case 7:return s.sent(),r.debug("bgRecord: fixed incomplete recording",e),[3,10];case 8:return u=s.sent(),r.warn("bgRecord: failed to fix incomplete recording",e,u),[4,E.moveFileByPath(e,n)];case 9:return s.sent(),[3,10];case 10:return[2]}}))})),ce=C.wrap((function(e){var n,r,i,o,a,c,u,l,d,f,g;return Object(s.__generator)(this,(function(b){switch(b.label){case 0:return[4,E.listByPath(V).catch((function(){return null}))];case 1:return(n=b.sent())&&n.length?[4,h.local.getSingle("bgRecord:pendingConfig",void 0)]:[2];case 2:r=b.sent(),e&&(m.handleError(new Error("incomplete recording found.")),t.$broadcast("recorder:incomplete_recording_found")),b.label=3;case 3:b.trys.push([3,8,9,10]),i=Object(s.__values)(n),o=i.next(),b.label=4;case 4:return o.done?[3,7]:(c=(a=o.value.fullPath).split("/").slice(-1)[0],u=p.localFilenameToId(c),[4,ae(a,u,c)]);case 5:b.sent(),l={},r&&r.filename!==a&&(l=r),t.$broadcast("recorder:fixedFile",u,l),b.label=6;case 6:return o=i.next(),[3,4];case 7:return[3,10];case 8:return d=b.sent(),f={error:d},[3,10];case 9:try{o&&!o.done&&(g=i.return)&&g.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2]}}))}));function se(){(B||"inactive"!==e.getState())&&(r.info("bgRecord: onSuspend() while recorder is active, preventing unloading"),i.getBackgroundPage())}function ue(){F&&g.remove(F),Y()}function le(){if(!F){r.debug("bgRecord: opening preview window");var e=4;"cam"===X.getConfig().captureSource&&(e=1);var t=Math.ceil(c.screen.width/e),n=Math.ceil(c.screen.height/e);g.create({url:"livepreview.html",type:"panel",width:t,height:n,top:c.screen.height-n,left:c.screen.width-t}).then((function(e){F=e.id,Y(),g.onRemoved.addListener((function t(n){e.id===n&&(g.onRemoved.removeListener(t),r.debug("bgRecord: closed preview window"),F=null,Y())}))}))}}return X.install=function(){var n;D=t.$new(!0),n=!1,D.$watchCollection(e.getStateObj,(function(){Y()})),D.$watch((function(){return B}),(function(e,t){e!==t&&Y()})),D.$watch((function(){return[e.getState(),Math.min(0,e.getCurrentTime())]}),(function(){return G()}),!0),D.$watch((function(){return Math.floor(e.getStateObj().droppedAudioTime)}),(function(e){if(l.values.notifyAudio&&e){var t={type:"basic",priority:2,title:"Dropping Audio Frames",message:"Screencastify dropped "+e+" seconds audio. Audio will be choppy. Try to restart recording with a lower resolution or frame rate.",iconUrl:"images/icon128.png"};n?b.update("audioDropped",t):b.create("audioDropped",t),n=!0}})),D.$watch((function(){return l.localValues.micGain}),(function(t,n){t!==n&&e.setMicGain(t)})),D.$watch((function(){return Math.floor(e.getCurrentTime()/60)}),(function(e){var t=X.getConfig();if(t){var n=t.nonpersistent&&t.nonpersistent.autoStop;n&&e>=n&&X.stop()}})),D.$on("chromeVideoRecorder:streamEnded",te),D.$on("chromeVideoRecorder:crash",J),D.$on("chromeVideoRecorder:error",z),D.$on("chromeVideoRecorder:systemAudioUnsupported",ne),ce(!0),i.onConnect.addListener(ie),i.onConnectExternal.addListener(ie),i.onSuspend.addListener(se),chrome.commands.onCommand.addListener(oe),d.getRecordConfig().then((function(e){return U=e})),h.onChanged.addListener((function(e,t){"local"===t&&e.recordConfig&&d.getRecordConfig().then((function(e){return U=e}))})),P.load()},X.uninstall=function(){D.$destroy(),i.onConnect.removeListener(ie),chrome.commands.onCommand.removeListener(oe)},X.getRecorderState=function(){return e.getStateObj()},X.cancelPendingStart=function(){return!!M&&(M.cancel(),!0)},X.getConfig=function(){return e.getRecordingConfig()},X.isBlocked=function(){return B},X.waitWhileBlocked=function(){return N},X._pathToIconConfig=v,X}]),n("U5Ke"),n("V0Mt");var w,_,S,E=n("fQLH"),C=n("2Mvu");_=w||(w={}),S=0,_.ensureOnline=function(){0===S&&d.database().goOnline(),S++},_.goOfflineIfIdle=function(){0==--S&&d.database().goOffline()};var I=function(){function e(){}return e._ref=function(){return d.database().ref(this.ROOT_REF)},e.get=function(){var e=this;w.ensureOnline();var t=function(){e._ref().off("value",r),w.goOfflineIfIdle()},n=new E.a,r=function(e){t(),n.next(e.val())};return this._ref().on("value",r,(function(e){t(),n.error(e)})),n.pipe(Object(C.a)()).toPromise()},e.ROOT_REF="/featureRollout",e}();function A(e,t,n,r,i,o,c,u,l,d,f){var p={},h=null;function g(){return t.navigator.userAgent}function m(){return g().indexOf("CrOS aarch")>=0}function b(e){return n.getSources().then((function(t){function n(e,n){return t.some((function(t){return t.kind===e&&t.label&&(!n||n===t.id)}))}return e.audio.mic&&(n("audio")?e.audio.micSourceId&&!n("audio",e.audio.micSourceId)&&delete e.audio.micSourceId:e.audio.mic=!1),n("video")?e.camSourceId&&!n("video",e.camSourceId)&&delete e.camSourceId:("cam"===e.captureSource&&(e.captureSource="tab"),e.embedWebcam&&(e.embedWebcam=!1)),e}))}function v(e){return e.autoShareApp?r.isConnected(e.autoShareApp.id).then((function(t){return t||delete e.autoShareApp,e})):e}p.toResolution=function(e){return{width:e.width,height:e.height}},p.getResolutionLimit=function(e,t){return e.limitResolution?"tab"===e.captureSource?o.scaleResolution(o.toPhysicalResolution(t),e.maxResolution):e.maxResolution:null};var y=c.wrap((function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return h?[3,2]:[4,u.cpu.getInfo()];case 1:h=e.sent().numOfProcessors,e.label=2;case 2:return[2,h]}}))})),w=c.wrap((function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,y()];case 1:return e.sent()>=4?[2,{width:1920,height:1080}]:[2,{width:1280,height:720}]}}))})),_=c.wrap((function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return(e=m())?[3,2]:[4,y()];case 1:e=t.sent()<=4,t.label=2;case 2:return[2,e]}}))}));return p.canCaptureSystemAudio=function(){return g().indexOf("Windows")>=0||g().indexOf("CrOS")>=0&&Number((/Chrome\/(\d+)/.exec(window.navigator.userAgent)||[void 0,0])[1])>=46},p.getRecentlyConnectedApp=function(){return r.getRecent().then((function(e){return e?i.getAppInfo(e):null}))},p.clearRecentlyConnectedApp=function(){return r.clearRecent()},p.setRecordConfig=function(t){return e.local.setSingle("recordConfig",t)},p.isPreviewSupported=c.wrap((function(e){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return"tab"===(t=e.captureSource)?[2,!1]:"cam"!==t&&g().indexOf("Mac OS")>=0?[4,d.getCurrent()]:[2,!0];case 1:return[2,"fullscreen"!==n.sent().state&&!(f.values.hwEncoding||"webrtc"===f.values.encoder)&&e.embedWebcam]}}))})),p.isInjectable=function(e){return e&&(e.startsWith("https://")||e.startsWith("http://")||e.startsWith("file://"))&&!e.startsWith("https://chrome.google.com/webstore/")},p.getRecordConfigDefaults=function(){return{audio:{mic:!0,system:!1},draw:{showToolbox:!0,tool:"pointer"},embedWebcam:!1,captureSource:"desktop",targetFPS:m()?5:(g().indexOf("CrOS x86_64"),30),exportFormat:"webm",startDelay:l.IS_E2E?0:3,visualCountdown:!0}},p.getRecordConfig=c.wrap((function(){var t,n,r,i,o,c,u;return Object(s.__generator)(this,(function(s){switch(s.label){case 0:return t=p.getRecordConfigDefaults(),[4,e.local.getSingle("recordConfig",{})];case 1:return n=s.sent(),r=n,a.isDefined(n.limitResolution)?(i=n.limitResolution,[3,4]):[3,2];case 2:return[4,_()];case 3:i=s.sent(),s.label=4;case 4:return r.limitResolution=i,o=n,n.maxResolution?(c=n.maxResolution,[3,7]):[3,5];case 5:return[4,w()];case 6:c=s.sent(),s.label=7;case 7:return o.maxResolution=c,n.audio=a.isObject(n.audio)?n.audio:t.audio,n.draw=n.draw||t.draw,n.embedWebcam=n.embedWebcam||t.embedWebcam,n.captureSource=n.captureSource||t.captureSource,n.targetFPS=n.targetFPS||t.targetFPS,n.exportFormat=n.exportFormat||t.exportFormat,n.startDelay=a.isDefined(n.startDelay)?n.startDelay:t.startDelay,n.visualCountdown=a.isDefined(n.visualCountdown)?n.visualCountdown:t.visualCountdown,"desktop"!==n.captureSource&&"screen"!==n.captureSource||p.canCaptureSystemAudio()||(n.audio.system=!1),(u=n.showPreview)?[4,p.isPreviewSupported(n)]:[3,9];case 8:u=!s.sent(),s.label=9;case 9:return u&&(n.showPreview=!1),n.nonpersistent={},[4,b(n)];case 10:return[4,v(n=s.sent())];case 11:return[2,n=s.sent()]}}))})),p}n("werd"),n("jHUz"),A.$inject=["cf2ChromeStorageService","$window","webrtc","cf2ConnectedAppsService","appRegistry","hdpiTool","spawn","chromeSystem","castifyConfig","chromeWindows","appOptions"],a.module("castifyExt.recordTool",["cf2.connectedAppsService","castifyExt.connect.appRegistry","castifyExt.hdpiTool","castifyExt.appOptions","w69b.webrtc","cf2.chromeStorageService","w69b.chromeWindows","w69b.spawn","w69b.chromeSystem"]).factory("recordTool",A),n("ZugE"),n("5NUK"),n("YGdR");var O=function(){function e(){}return e.isLess=function(e,t){function n(e){return e.split(".").map((function(e){return Number(e)}))}for(var r=n(e),i=n(t),o=0;o<Math.max(r.length,i.length);++o){if((r[o]||0)<(i[o]||0))return!0;if((r[o]||0)>(i[o]||0))return!1}return!1},e.isEqual=function(e,t){return!this.isLess(e,t)&&!this.isLess(t,e)},e.isLessOrEqual=function(e,t){return this.isLess(e,t)||this.isEqual(e,t)},e}();angular.module("castifyExt.updateMigrationService",["w69b.chromeRuntime","castifyExt.hdpiTool","castifyExt.appOptions","cf2.chromeStorageService"]).factory("updateMigrationService",["chromeRuntime","$log","cf2ChromeStorageService",function(e,t,n){var r={};function i(r){t.debug("installed",r);let i=e.getManifest().version;"update"===r.reason&&function(e,r){e!==r&&(t.info("updating from "+e+" to "+r),O.isLess(e,"1.35.0")&&n.sync.setSingle("showOldIcon",!0))}(r.previousVersion,i),"install"===r.reason&&n.local.setSingle("tos_confirmed",!0)}return r.install=function(){e.onInstalled.addListener(i)},r}]),n("LHv7"),n("98ZH"),n("Z0Xy"),n("rsSo"),n("AALf"),n("xOqQ"),n("ihUj"),n("7cT6"),n("mV/w"),n("5Rb+"),n("QP76"),n("/b8I"),n("44cV"),n("aI2O"),n("JYpz"),n("IkP3"),n("Ryvw"),n("UmrE"),n("gCzY"),n("k4Xy"),n("e9m0"),n("Xe46"),n("5Lhf"),a.module("castifyExt.crashReporterSetup",["cf2.sentryErrorHandler"]).factory("$exceptionHandler",["$injector",function(e){return function(t,n){e.get("$log").error(t,n),t&&e.get("sentryErrorHandler").handleError(t)}}]),n("ARYM"),n("sSk+"),n("NkpF"),n("MWHJ"),n("wngz"),n("woRk"),n("U148"),angular.module("castifyExt.firebase",[]).factory("firebase",()=>f.a),n("A5fb"),n("D+N8"),n("oRFD"),n("dE4o"),n("+m22"),a.module("castifyExt.connect.appRegistry",["w69b.spawn","cf2.chromeStorageService"]).factory("appRegistry",["castifyConfig","$http","$q","spawn","cf2ChromeStorageService",function(e,t,n,r,i){var o=e.API_URL+"/apps",a={},c="appRegistry:cache",u=6e4;function l(){return i.local.getSingle(c,[])}function d(e){return l().then((function(t){return t.filter((function(t){return e.includes(t.id)}))}))}function f(e){return e.forEach((function(e){delete e._fetchTimestamp})),e}function p(e,t){return r((function(){var n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return e=new Set(e||[]),[4,l()];case 1:return n=r.sent(),t.forEach((function(t){e.add(t.id)})),n=n.filter((function(t){return!e.has(t.id)})),t.forEach((function(e){e._fetchTimestamp=Date.now()})),[4,(o=n=n.concat(t),i.local.setSingle(c,o))];case 2:return r.sent(),[2]}var o}))}))}function h(e){return r((function(){var r,i,a;return Object(s.__generator)(this,(function(c){switch(c.label){case 0:return e&&0!==e.length?[4,d(e)]:[2,n.when([])];case 1:if(function(e,t){var n=Date.now();return!e.some((function(e){return n>e._fetchTimestamp+u}))&&t.length===e.length}(i=c.sent(),e))return[2,f(i)];c.label=2;case 2:return c.trys.push([2,4,,5]),[4,t.get(o,{params:{ids:e}})];case 3:return a=c.sent(),r=a.data,[3,5];case 4:return c.sent(),[2,f(i)];case 5:return[4,p(e,r)];case 6:return c.sent(),[2,f(r)]}}))}))}return a.getApps=function(e){return h(e)},a.getAppInfo=function(e){return h([e]).then((function(e){return e.length?e[0]:n.reject()}))},a}]),n("8iUY"),n("PdQI"),n("8ZPm"),n("3Jae"),n("AOG9"),n("C5ui");var j=n("HnWI"),x=n("W/Ou"),T=n("AouM");c.a.module("castifyExt.bgUserAccount",["cf2.userAccount","castifyExt.chromeEventPublisher","castifyExt.simpleBgServicePublisher","castifyExt.castifyAuth","castifyExt.bgLicensing","w69b.chromeRuntime","cf2.chromeStorageService","w69b.promiseTool","w69b.spawn"]).factory("bgUserAccount",["$http","castifyAuth","$rootScope","castifyConfig","spawn","promiseTool","simpleBgServicePublisher","$log","cf2ChromeStorageService","chromeRuntime","bgLicensing","$q","cf2BgUsageStatsService",function(e,t,n,r,i,o,a,u,l,d,f,p,h){var g={},m=r.API_URL+"/account",b="userAccount",v=o.serializer(),y=null;function w(e){return e.data}var _=i.wrap((function(){return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,t.getAccount()];case 1:return n.sent()?[2,e.get(m,{params:{license:"1"},googleAuth:!0}).then(w)]:[2,null]}}))}));function S(t){return e.post(m,t,{googleAuth:!0}).then(w)}var E=i.wrap((function(e){var t,n,r,i;return Object(s.__generator)(this,(function(o){switch(o.label){case 0:return[4,p.all([e||_().catch((function(){return null})),f.getLicense()])];case 1:return t=s.__read.apply(void 0,[o.sent(),2]),r=t[1],i=null,(n=t[0])&&(i=n.license,delete n.license),[2,{license:(a=r,c=i,i=c?c.isPaid?c:a.isPaid?a:c.isTester?c:a.isTester?a:c.branding?a.branding?c.limitNumRecordings?a.limitNumRecordings?c:a:c:a:c:a),user:n}]}var a,c}))}));function C(e){return y=e,l.local.setSingle(b,e)}function I(e){return!e.license||!e.license.validTill||e.license.validTill<Date.now()}var A=o.serializer().wrap(i.wrap((function(e){var t,n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return y?[2,{account:y,updated:!1}]:(t=e,n=!1,e&&I(e)&&(e=null),[4,E(e)]);case 1:return e=r.sent(),u.debug("userAccount: fetched",e),!e.user&&t&&t.user?(u.debug("userAccount: using expired, but signed-in account",t),e=t,[3,4]):[3,2];case 2:return n=!0,C(e),[4,h.clearDirtyMonthlyStats()];case 3:r.sent(),u.debug("userAccount: updated cache"),r.label=4;case 4:return y=e,[2,{account:e,updated:n}]}}))}))),O=v.wrap(i.wrap((function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return y?[2,y]:[4,l.local.getSingle(b,null)];case 1:return(e=t.sent())&&e.license?[3,3]:[4,A(e)];case 2:return[2,t.sent().account];case 3:return e&&I(e)?(v((function(){return A(e)})).then((function(e){e.updated&&k()})),[2,e]):[2,e];case 4:return[2]}}))})));function R(){y&&y.user&&(u.debug("userAccount: refreshing account due to auth sign-in error"),$())}var P=v.wrap((function(){return u.debug("userAccount: clearing cache"),y=null,C(null)}));function k(){n.$broadcast("event:userAccountChanged"),d.sendMessage({type:"event:userAccountChanged"}).catch(c.a.identity),u.debug("userAccount: firing accountChanged")}function $(){return u.debug("userAccount: refreshing account"),P(),O().finally((function(){k()}))}var F=i.wrap((function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,O()];case 1:return e=t.sent(),[4,U(e)];case 2:return t.sent(),[4,C(e)];case 3:return t.sent(),u.debug("userAccount: redecorate account"),d.sendMessage({type:"event:userAccountRedecorated"}).catch(c.a.identity),[2]}}))}));function D(e,t,n){n.isPaidInstall&&$()}function M(e,t,n){function r(e){return!e||e>=Date.now()}r(t)!==r(n)&&$()}var U=i.wrap((function(e){var t,n,r,i,o,a,c,u;return Object(s.__generator)(this,(function(s){switch(s.label){case 0:return t=function(e){return e.getUTCFullYear()+"-"+e.getUTCMonth()},[4,h.getDirtyMonthlyStats()];case 1:return n=s.sent(),r=n.count,i=n.duration,o=0,a=0,e.user&&e.user.fetchedAt&&t(new Date(e.user.fetchedAt))===t(new Date)&&(e.user.numRecordingsMonth&&(o=e.user.numRecordingsMonth),e.user.numRecordingsMonth&&(a=e.user.totalRecordingTimeMonth)),e.numRecordingsMonth=r+o,e.totalRecordingTimeMonth=i+a,c=e,[4,h.getStoredCount()];case 2:return c.recordingsStoredCount=s.sent(),u=e,[4,h.getPaidCount()];case 3:return u.paidRecordingsCount=s.sent(),[2,e]}}))}));return g.signIn=function(e){return void 0===e&&(e=!1),t.getAuthToken({interactive:!e||"select_account"})},g.signOut=i.wrap((function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return u.debug("userAccount: signOut"),[4,p.all([t.signOut(),P()])];case 1:return e.sent(),$(),[2]}}))})),g.getAccount=i.wrap((function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return e=U,[4,O()];case 1:return[2,e.apply(void 0,[t.sent()])]}}))})),g.update=function(){return $()},g.postUpdate=i.wrap((function(e){var t,n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return n=E,[4,S(e)];case 1:return[4,n.apply(void 0,[r.sent()])];case 2:return t=r.sent(),[4,h.clearDirtyMonthlyStats()];case 3:return r.sent(),C(t),k(),[2,U(t)]}}))})),g.updateVariant=i.wrap((function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,e.put(m+"/switch-variant",{},{googleAuth:!0}).then(w)];case 1:return t.sent(),[2,$()]}}))})),g.$testClearMemoryCache=function(){y=null},g.onAccount=function(){return(e=n,new j.a((function(t){return e.$on("event:userAccountChanged",(function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.next(e)}))}))).pipe(Object(x.a)(null),Object(T.a)((function(){return g.getAccount()})));var e},g.install=function(){a("userAccount",g,["install"]),n.$on("event:signInChanged",$),n.$on("event:redecorateAccount",F),n.$on("connect:appConnected",D),n.$on("connect:userExpiryDateChange",M),n.$on("castifyAuth:notSignedIn",R)},g}]).factory("userAccount",["bgUserAccount",function(e){return e}]),n("9k28"),n("EtHb");var R=n("U3QC"),P=n("88Oa"),k=function(){function e(e,t){this.$http=e,this._exportEndpointUrl=t.exportServiceURL,this._editServiceUrl=t.editServiceURL}return e.$inject=["$http","deployConfig"],e.prototype.exportAudio=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.$http.post(this._exportEndpointUrl+"/audioExport",e,{googleAuth:!0})];case 1:return[2,t.sent().data]}}))}))},e.prototype.trim=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.$http.post(this._editServiceUrl+"/trim",e,{googleAuth:!0})];case 1:return[2,t.sent().data]}}))}))},e.prototype.exportVideo=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.$http.post(this._exportEndpointUrl+"/videoExport",e,{googleAuth:!0})];case 1:return[2,t.sent().data]}}))}))},e}(),$=n("3ygq"),F=n("iJR/"),D=n("QfVV"),M=n("4Kzh"),U=n("wlUu"),L=n("vrTi"),B=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),t}(D.a),N=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),Object.defineProperty(t,"root",{get:function(){return this._getRoot("/trimTasks")},enumerable:!0,configurable:!0}),Object.defineProperty(t,"queueTopicSuffix",{get:function(){return"simpleTask2"},enumerable:!0,configurable:!0}),t.Collection=B,t.taskType="FisTrimTask",Object(s.__decorate)([Object(M.a)()],t.prototype,"userId",void 0),Object(s.__decorate)([Object(M.a)()],t.prototype,"driveFileId",void 0),Object(s.__decorate)([Object(M.a)()],t.prototype,"driveInfo",void 0),Object(s.__decorate)([Object(M.a)()],t.prototype,"traceContext",void 0),Object(s.__decorate)([Object(M.a)()],t.prototype,"trimStart",void 0),Object(s.__decorate)([Object(M.a)()],t.prototype,"trimEnd",void 0),t}(U.a);L.a._registerTaskType(N);var V=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),t}(D.a),H=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),Object.defineProperty(t,"root",{get:function(){return this._getRoot("/videoExportTasks")},enumerable:!0,configurable:!0}),Object.defineProperty(t,"queueTopicSuffix",{get:function(){return"simpleTask2"},enumerable:!0,configurable:!0}),t.Collection=V,t.taskType="FisVideoExportTask",Object(s.__decorate)([Object(M.a)()],t.prototype,"userId",void 0),Object(s.__decorate)([Object(M.a)()],t.prototype,"driveFileId",void 0),Object(s.__decorate)([Object(M.a)()],t.prototype,"exportOptions",void 0),Object(s.__decorate)([Object(M.a)()],t.prototype,"fileName",void 0),Object(s.__decorate)([Object(M.a)()],t.prototype,"driveFolderId",void 0),Object(s.__decorate)([Object(M.a)()],t.prototype,"signedUrl",void 0),Object(s.__decorate)([Object(M.a)()],t.prototype,"traceContext",void 0),t}(U.a);L.a._registerTaskType(H),J.$inject=["bgFiles","startFixWebmJob","$q","ExportClientService"],G.$inject=["simplePortService","$rootScope","ScheduledEditJob","$log","chromeRuntime","sentryErrorHandler","cf2BgUsageStatsService","bgFiles","spawn","promiseTool","$q"];var q=function(){function e(e){var t=this;this.promise=Object(F.a)($.a.root.getById(e)).pipe(Object(R.a)((function(e){return t._task=e})),Object(T.a)((function(e){return e.onProgress()})),Object(R.a)((function(e){return t._progress=e})),Object(P.a)(),Object(T.a)((function(){return t._getResult()}))).toPromise()}return e.prototype._getResult=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._task.load()];case 1:return t.sent(),[2,{url:(e=this._task.driveInfo).webContentLink,successMessage:"Audio file has been saved to your Google Drive.",isExport:!0,isDriveExport:!0,driveViewUrl:e.webViewLink,saveFileName:e.name}]}}))}))},e.prototype.getProgress=function(){return this._progress},e}(),W=function(){function e(e,t){var n=this;this.promise=Object(F.a)(N.root.getById(e)).pipe(Object(R.a)((function(e){return n._task=e})),Object(T.a)((function(e){return e.onProgress()})),Object(R.a)((function(e){return n._progress=e})),Object(P.a)(),Object(T.a)(t),Object(T.a)((function(){return n._getResult()}))).toPromise()}return e.prototype._getResult=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._task.load()];case 1:return t.sent(),[2,{url:(e=this._task.driveInfo).webContentLink,successMessage:"Trim job done.",isExport:!1,isDriveExport:!1,driveViewUrl:e.webViewLink}]}}))}))},e.prototype.getProgress=function(){return this._progress},e}(),z=function(){function e(e){var t=this;this.promise=Object(F.a)(H.root.getById(e)).pipe(Object(R.a)((function(e){return t._task=e})),Object(T.a)((function(e){return e.onProgress()})),Object(R.a)((function(e){return t._progress=e})),Object(P.a)(),Object(T.a)((function(){return t._getResult()}))).toPromise()}return e.prototype._getResult=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this._task.load()];case 1:return e.sent(),[2,{taskId:this._task.id,url:this._task.signedUrl,saveFileName:this._task.fileName,successMessage:"Video export job completed",isExport:!0,isDriveExport:!1}]}}))}))},e.prototype.getProgress=function(){return this._progress},e}();function J(e,t,n,r){var i=1;return function(){function o(t){this.config=t,this.dismissed=!1,this.state="queued",this._doneDeferred=n.defer(),this.promise=this._doneDeferred.promise,this.id=""+i++,this.promise.catch((function(){return null})),t.meta&&t.meta.fileId&&e.getFileDescriptor(t.meta.fileId).then((function(e){this.fileDesc=e}).bind(this))}return o.prototype.start=function(){var n,i=this;switch(i.state="running",this.config.type){case"fixWebm":n=t(i.config);break;case"audioExport":n=e.getFileDescriptor(i.config.meta.fileId).then((function(e){return r.exportAudio({driveFileId:e.driveInfo.id,driveFolderId:i.config.driveFolderId,fileName:i.config.fileName})})).then((function(e){return new q(e.taskId)}));break;case"trim":var o=function(){return e.reload(i.config.meta.fileId)};n=e.getFileDescriptor(i.config.meta.fileId).then((function(e){return r.trim({driveFileId:e.driveInfo.id,trimStart:i.config.trim.trimStart,trimEnd:i.config.trim.trimEnd})})).then((function(e){return new W(e.taskId,o)}));break;case"videoExport":n=e.getFileDescriptor(i.config.meta.fileId).then((function(e){var t={driveFileId:e.driveInfo.id,fileName:i.config.fileName};return i.config.outFormat.includes("gif")?t.gif={size:i.config.scale}:i.config.outFormat.includes("mp4")?t.mp4={fps:i.config.fps}:i.config.outFormat.includes("mp3")&&(t.mp3=!0),r.exportVideo(t)})).then((function(e){return new z(e.taskId)}))}var a=n.then((function(e){return i.editJob=e,e.promise}));return a.then(i.onComplete_.bind(i),i.onError_.bind(i)),a.then(this._doneDeferred.resolve.bind(this._doneDeferred),this._doneDeferred.reject.bind(this._doneDeferred)),a},o.prototype.getProgress=function(){return"done"===this.state?1:"running"===this.state&&this.editJob?this.editJob.getProgress():0},o.prototype.onComplete_=function(e){this.result=e,this.state="done"},o.prototype.onError_=function(){this.state="error"},o.prototype.cancel=function(){return!(!this.editJob||!this.editJob.cancel||(this.editJob.cancel(),this.state="cancelled",0))},o.prototype.dismiss=function(){this.dismissed=!0},o.prototype.toJSON=function(){var e={id:this.id,type:this.config.type,result:this.result,state:this.state,outFormat:this.config.outFormat,progress:this.getProgress(),cancelDanger:"fixWebm"===this.config.type,cancelable:!(!this.editJob||!this.editJob.cancel),dismissed:this.dismissed};return this.config.meta&&this.config.meta.fileId&&(e.fileId=this.config.meta.fileId),this.fileDesc?e.fileTitle=this.fileDesc.title:this.config.fileName&&(e.fileTitle=this.config.fileName),e},o}()}function G(e,t,n,r,i,o,a,c,u,l,d){var f={},p=[];function h(e){return p.filter((function(t){return t.state===e}))}function g(e){return p.find((function(t){return t.id===e}))}function m(){return h("queued")}var b,v=l.serializer().wrap(u.wrap((function(){var e,n,i,o,a,u,l;return Object(s.__generator)(this,(function(f){switch(f.label){case 0:return[4,d.all(m().map((function(e){return e&&!e.config.meta.newVideoDetails?e:c.refresh(e.config.meta.fileId).then((function(){return c.getFileDescriptor(e.config.meta.fileId)})).catch((function(){return null})).then((function(t){return t.driveInfo?e:null}))}))).then((function(e){return e.filter((function(e){return!!e}))}))];case 1:e=f.sent();try{for(n=Object(s.__values)(e),i=n.next();!i.done;i=n.next())r.debug("starting scheduled edit",o=i.value),a=o.start(),t.$broadcast("editJob:started",o.id),a.then(w.bind(null,o),y.bind(null,o))}catch(p){u={error:p}}finally{try{i&&!i.done&&(l=n.return)&&l.call(n)}finally{if(u)throw u.error}}return[2]}}))})));function y(e,n){r.warn("scheduled edit job failed",e,n),v(),t.$broadcast("editJob:failed",e.id,n),"trim"===e.config.type&&f.dismiss(e.id),o.handleError(n)}function w(e,n){r.debug("scheduled edit job completed",e,n),e.config&&e.config.meta&&e.config.meta.copy&&a.incrementStoredCount(),v(),t.$broadcast("editJob:completed",e.id,n)}function _(){(m().length||h("running").length)&&(r.info("onSuspend() while editing is active, preventing unloading"),i.getBackgroundPage())}return t.$on("uploader:complete",v),f.addJob=function(e){r.debug("adding edit job",e);var i=new n(e);return p.push(i),v(),t.$broadcast("editJob:added",i.id),i},f.cancel=function(e){r.debug("canceling edit job",e);var n=g(e);n&&n.cancel()&&t.$broadcast("editJob:cancelled",n.id)},f.dismiss=function(e){var n=g(e);r.debug("dismissing edit job",e),n.dismiss(),t.$broadcast("editJob:dismissed",n.id)},f.getJob=function(e){return g(e)},f.getJobs=function(){return p},f.clearComplete=function(e){p=p.filter((function(t){return"done"!==t.state||e&&t.id!==e})),b&&b.postJobs()},f.install=function(){b=function(){var n=e("editor");function r(){n.postMessage("jobsList",f.getJobs())}return n.handlers={addJob:f.addJob,cancel:f.cancel,dismiss:f.dismiss,getJobs:r,clearComplete:f.clearComplete},t.$on("editJob:completed",r),t.$on("editJob:started",r),t.$on("editJob:cancelled",r),t.$on("editJob:dismissed",r),t.$on("editJob:added",(function(e,t){r(),n.postMessage("jobAdded",f.getJob(t))})),n.install(),{postJobs:r}}(),i.onSuspend.addListener(_)},f}a.module("castifyEdit.bgEditJobScheduler",["castifyEdit.fixWebmJob","castifyExt.bgFiles","castifyExt.simplePortService","castifyExt.deployConfig","w69b.spawn","w69b.promiseTool"]).service("ExportClientService",k).factory("ScheduledEditJob",J).factory("bgEditJobScheduler",G),n("Sewt"),n("iNku"),n("RnoO"),n("HRCS"),n("kwgm"),n("4Z/A"),n("XRbf"),n("c4q8"),n("Ie/p"),n("IiHr"),n("sQ84"),n("vEZL"),n("G+hJ"),n("rJTD"),n("6GBm"),n("J404"),n("H+pR"),n("58x+"),n("tUCW"),n("cgCA"),n("kEoX"),n("iTUk"),n("9I/G"),n("Al3/"),n("CO2U"),n("qVZV"),n("CVq3"),n("gutk"),n("wFxG"),n("NqIN"),n("d7dg"),n("WNYX"),n("KGdM"),angular.module("castifyExt.bgApp",["w69b.es6","castifyExt.commonConfig","castifyExt.crashReporterSetup","castifyExt.bgRecord","castifyExt.bgUpload","w69b.chromePersistentLogger","castifyExt.recordingHooks","castifyExt.updateMigrationService","castifyExt.diskSpaceWatcher","castifyExt.licenseEnforcer","castifyExt.driveFileWatcher","castifyExt.bgFiles","castifyExt.bgSyncManager","castifyExt.syncNotifications","castifyExt.authConfig","castifyEdit.bgEditJobScheduler","w69b.chromeNotifications","castifyExt.connect.bgConnectService","castifyExt.bgSyncDownloader","castifyExt.bgCastifyAuth","castifyExt.bgUserAccount","castifyExt.bgUserNotifications","castifyExt.bgRecordingErrorHandler","castifyExt.popupInjector","cf2.background"]).config(["chromePersistentLoggerProvider","chromeVideoRecorderProvider","bgCastifyAuthProvider","deployConfigProvider",function(e,t,n,r){t.setEncoderUrl("manifest_encoder.nmf",!1),e.setStorageKey("background"),e.enableGlobalHandler(!0),e.enableAutoSave(!1),e.install(),n.setClientId(r.clientId),n.setScopes(r.scopes),n.setRedirectUri(r.redirectUri)}]).run(["bgRecordService","bgUploadService","$q","recordingHooks","updateMigrationService","diskSpaceWatcher","licenseEnforcer","driveFileWatcher","bgFiles","googleUploader","chromePersistentLogger","chromeRuntime","bgSyncManager","syncNotifications","onlineState","bgEditJobScheduler","chromeNotifications","bgConnectService","bgSyncDownloader","bgCastifyAuth","bgUserAccount","bgUserNotifications","popupInjector","bgRecordingErrorHandler","cf2BgMessagesService","cf2OnlyServices","cf2RemoteYoutubeUploadService",function(e,t,n,r,i,o,a,c,s,u,l,d,f,p,h,g,m,b,v,y,w,_,S,E,C,I,A){m.simple.defaultOptions={type:"basic",priority:2,iconUrl:"images/icon128.png"},u.setAutoResumeEnabled(!1),u.setRespectRetryAfterHeader(!1),r.install(),y.install(),n.all([f.install(),e.install(),t.install(),i.install(),o.install(),a.install(),C.install(),c.install(),s.install(),p.install(),g.install(),b.install(),v.install(),w.install(),_.install(),E.install(),S.install(),I.install()]).finally((function(){C.initializationCompleted()})),h.check(),d.onSuspend.addListener((function(){l.save()})),d.setUninstallURL("https://api.screencastify.com/api/on_uninstall")}]);var Y=n("Valr"),K=n("paqz"),Q=n("E1rE"),X=n("jrvE"),Z=n("1FNf"),ee=n("cr/0");function te(e){return Object(ee.a)((function(t){e.addListener(t)}),(function(t){return e.removeListener(t)}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e}))}var ne=n("8Fqk"),re=n("JpoA"),ie=n("XO9t"),oe=n("IMYO"),ae=n("3n3h"),ce=function(){function e(e){this._sendFn=e,this._msgCnt=0,this._msgResolvers=new Map}return e.prototype.sendWithResponse=function(e,t){return this.sendWithResponseStream(e,t).toPromise()},e.prototype.sendWithResponseStream=function(e,t){var n=this;if("__arUnsubscribe"===e)throw new Error;return new j.a((function(r){var i=++n._msgCnt,o=!0;return function(r){var i=new E.a;return n._msgResolvers.set(r,i),Object(ne.a)((function(){return Object(s.__awaiter)(n,void 0,void 0,(function(){return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this._sendFn({type:e,data:t,msgId:r})];case 1:return[2,n.sent()]}}))}))})).pipe(Object(oe.a)((function(e){return delete n._msgResolvers[r],Object(re.a)(e)})),Object(ae.a)(i.asObservable()))}(i).subscribe((function(e){return r.next(e)}),(function(e){o=!1,r.error(e)}),(function(){o=!1,r.complete()})),function(){o&&n._sendFn({type:"__arUnsubscribe",msgId:i})}}))},e.prototype.send=function(e,t){if("__arUnsubscribe"===e)throw new Error;this._sendFn("object"==typeof e?e:{type:e,data:t})},e.prototype.handleResult=function(e){if(e&&"result"===e.type){var t=this._msgResolvers.get(e.msgId);if(!t)throw new Error("asyncResponse: no resolver");return e.hasOwnProperty("error")||e.isError?(t.error(e.data),this._msgResolvers.delete(e.msgId)):(e.isNext&&t.next(e.data),e.isComplete&&(t.complete(),this._msgResolvers.delete(e.msgId))),!0}return!1},e}(),se=function(){function e(e){this._sendFn=e,this._subscriptions=new Map}return e.prototype._sendComplete=function(e,t,n){void 0===n&&(n=!0),this._sendFn({type:"result",msgId:t.msgId,data:e,isComplete:!0,isNext:n})},e.prototype._sendError=function(e,t){e instanceof Error&&!("toJSON"in e)&&(e={name:e.name,message:e.message}),this._sendFn({type:"result",msgId:t.msgId,data:e,isError:!0})},e.prototype._sendNext=function(e,t){this._sendFn({type:"result",msgId:t.msgId,data:e,isNext:!0})},e.prototype.respond=function(e,t){return Object(s.__awaiter)(this,void 0,void 0,(function(){var n,r,i,o=this;return Object(s.__generator)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,e];case 1:return n=a.sent(),Object(ie.a)(n)?(r=n.subscribe((function(e){return o._sendNext(e,t)}),(function(e){o._subscriptions.delete(t.msgId),o._sendError(e,t)}),(function(){o._subscriptions.delete(t.msgId),o._sendComplete(void 0,t,!1)})),this._subscriptions.set(t.msgId,r)):this._sendComplete(n,t),[3,3];case 2:return i=a.sent(),this._sendError(i,t),[3,3];case 3:return[2,null]}}))}))},e.prototype.handleMessage=function(e){if(e&&"__arUnsubscribe"===e.type){var t=this._subscriptions.get(e.msgId);return t&&(t.unsubscribe(),this._subscriptions.delete(e.msgId)),!0}return!1},e}(),ue=function(){function e(){}return e.create=function(e){var t=chrome.runtime.connect({name:"servify_"+e}),n=new ce((function(e){t.postMessage(e)}));te(t.onMessage).subscribe((function(e){var t=Object(s.__read)(e,2);n.handleResult(t[0])}));var r=new Proxy({},{get:function(e,t){var r=t.toString();return r.startsWith("on")?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.sendWithResponseStream(r,e)}:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.sendWithResponse(r,e)}}}),i=function(){};return i.prototype=r,i},e}();function le(e){return ue.create(e)}var de=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),t.prov=o.vb({token:t,factory:t.fac=function(e){return fe(e||t)},providedIn:"root"}),t}(le("foo")),fe=o.Ab(de),pe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),t.prov=o.vb({token:t,factory:t.fac=function(e){return he(e||t)},providedIn:"root"}),t}(le("userAccount")),he=o.Ab(pe);X.a({beforeSend:function(e){try{if(window.localStorage.e2e)return null}catch(t){}return e},dsn:u.production?"https://83be6b50b8d748f6915a9c3345443403@sentry.io/1538219":"",environment:u.environmentName,release:chrome.runtime.getManifest().version_name});var ge=function(){function e(e){this._injector=e,this._hasUserContext=!1}return e.prototype._setupUserContext=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return this._hasUserContext?[2]:(this._hasUserContext=!0,[4,this._injector.get(pe).getAccount()]);case 1:return(e=t.sent())&&e.user&&Z.b((function(t){t.setUser({email:e.user.email})})),[2]}}))}))},e.prototype.handleError=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._setupUserContext()];case 1:return t.sent(),Z.a(e.originalError||e),console.warn(e),[2]}}))}))},e.fac=function(t){return new(t||e)(o.Bb(o.m))},e.prov=o.vb({token:e,factory:e.fac,providedIn:"root"}),e}();a.module("cf2.sentryErrorHandler",[]).factory("sentryErrorHandler",Object(K.b)(ge));var me=function(){function e(e){if(e)throw new Error("ErrorReportingModule is already loaded. Import it in the AppModule only")}return e.mod=o.xb({type:e}),e.inj=o.wb({factory:function(t){return new(t||e)(o.Bb(e,12))},providers:[{provide:o.i,useExisting:ge}],imports:[[Y.a]]}),e}(),be=n("lqvn"),ve=n("R+ki");function ye(){return Object(o.M)("$injector")}new o.l("ajs.analytics",{providedIn:"root",factory:function(){return ye().get("analytics")}}),new o.l("ajs.backgroundTool",{providedIn:"root",factory:function(){return ye().get("backgroundTool")}});var we=new o.l("ajs.castifyConfig",{providedIn:"root",factory:function(){return ye().get("castifyConfig")}}),_e=(new o.l("ajs.chromeEventPublisher",{providedIn:"root",factory:function(){return ye().get("chromeEventPublisher")}}),new o.l("ajs.chromePersistentLogger",{providedIn:"root",factory:function(){return ye().get("chromePersistentLogger")}})),Se=(new o.l("ajs.connectService",{providedIn:"root",factory:function(){return ye().get("connectService")}}),new o.l("ajs.appOptions",{providedIn:"root",factory:function(){return ye().get("appOptions")}})),Ee=new o.l("ajs.chromeRuntime",{providedIn:"root",factory:function(){return ye().get("chromeRuntime")}}),Ce=new o.l("ajs.chromeWindows",{providedIn:"root",factory:function(){return ye().get("chromeWindows")}}),Ie=new o.l("ajs.chromeTabs",{providedIn:"root",factory:function(){return ye().get("chromeTabs")}}),Ae=(new o.l("ajs.driveUtils",{providedIn:"root",factory:function(){return ye().get("driveUtils")}}),new o.l("ajs.fileDbClient",{providedIn:"root",factory:function(){return ye().get("fileDbClient")}}),new o.l("ajs.webEditUtils",{providedIn:"root",factory:function(){return ye().get("webEditUtils")}}),new o.l("ajs.$log",{providedIn:"root",factory:function(){return ye().get("$log")}}),new o.l("ajs.shareUtils",{providedIn:"root",factory:function(){return ye().get("shareUtils")}}),new o.l("ajs.simpleBgServiceConsumer",{providedIn:"root",factory:function(){return ye().get("simpleBgServiceConsumer")}})),Oe=(new o.l("ajs.youtubeAuth",{providedIn:"root",factory:function(){return ye().get("youtubeAuth")}}),new o.l("ajs.syncStatusClient",{providedIn:"root",factory:function(){return ye().get("syncStatusClient")}}),new o.l("ajs.helpCenter",{providedIn:"root",factory:function(){return ye().get("helpCenter")}}),new o.l("ajs.bgUserAccount",{providedIn:"root",factory:function(){return ye().get("bgUserAccount")}})),je=new o.l("ajs.bgCastifyAuth",{providedIn:"root",factory:function(){return ye().get("bgCastifyAuth")}}),xe=new o.l("ajs.bgFiles",{providedIn:"root",factory:function(){return ye().get("bgFiles")}}),Te=new o.l("ajs.deployConfig",{providedIn:"root",factory:function(){return ye().get("deployConfig")}}),Re=new o.l("ajs.UploadBase",{providedIn:"root",factory:function(){return ye().get("UploadBase")}}),Pe=new o.l("ajs.$http",{providedIn:"root",factory:function(){return ye().get("$http")}}),ke=(new o.l("ajs.$state",{providedIn:"root",factory:function(){return ye().get("$state")}}),new o.l("ajs.rootScope",{providedIn:"root",factory:function(){return ye().get("$rootScope")}})),$e=(new o.l("ajs.$stateParams",{providedIn:"root",factory:function(){return ye().get("$stateParams")}}),new o.l("ajs.$location",{providedIn:"root",factory:function(){return ye().get("$location")}}),new o.l("ajs.appRegistry",{providedIn:"root",factory:function(){return ye().get("appRegistry")}})),Fe=function(){function e(){var e=this;this.local={},this.sync={},this.managed={},this.onChanged=chrome.storage.onChanged,["local","sync","managed"].forEach((function(t){["set","get","remove","clear"].forEach((function(n){var r,i;e[t][n]=(r=chrome.storage[t][n],i=chrome.storage[t],function(){var e,t=new Promise((function(t,n){e=function(e){chrome.runtime.lastError?n(chrome.runtime.lastError):t(e)}}));return r.apply(i,Object(s.__spread)(arguments,[e])),t})})),e[t].setSingle=function(n,r){var i={};return i[n]=r,e[t].set(i)},e[t].getSingle=function(n,r){return e[t].get(n).then((function(e){return e.hasOwnProperty(n)?e[n]:r}))}}))}return e.prov=o.vb({token:e,factory:e.fac=function(t){return new(t||e)},providedIn:"root"}),e}();a.module("cf2.chromeStorageService",[]).factory("cf2ChromeStorageService",Object(K.b)(Fe));var De={googleAuth:!0},Me=function(){function e(e,t){this._$http=e,this._castifyConfig=t,this._baseUrl=this._castifyConfig.API_URL+"/stats"}return e.prototype.sendStoredCount=function(e){return this._$http.post(this._baseUrl+"/recordings_stored",{count:e},De)},e.prototype.updateMonthlyStats=function(e){return this._$http.post(this._baseUrl+"/recording_created",{duration:e},De)},e.fac=function(t){return new(t||e)(o.Bb(Pe),o.Bb(we))},e.prov=o.vb({token:e,factory:e.fac,providedIn:"root"}),e}(),Ue=function(){function e(e,t,n){this._$rootScope=e,this._chromeStorage=t,this._bgUsageStatsClientService=n,this._throttledSendStoredCount$=new E.a,this._init()}return e.prototype._init=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e,t,n,r=this;return Object(s.__generator)(this,(function(i){switch(i.label){case 0:return t=(e=this._throttledSendStoredCount$).pipe,n=x.a,[4,this.getStoredCount()];case 1:return t.apply(e,[n.apply(void 0,[i.sent()]),Object(be.a)(),Object(R.a)((function(e){return r._setStoredCount(e)})),Object(ve.a)(2e3)]).subscribe((function(e){r._bgUsageStatsClientService.sendStoredCount(e)})),[2]}}))}))},e.prototype._getCurrentMonthKey=function(){var e=new Date;return e.getUTCFullYear()+"-"+e.getUTCMonth()},e.prototype._updateDirtyMonthlyStats=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.getDirtyMonthlyStats()];case 1:return t=n.sent(),[4,this._setDirtyMonthlyStats({count:t.count+1,duration:t.duration+e})];case 2:return n.sent(),[2]}}))}))},e.prototype._setDirtyMonthlyStats=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return t=this._monthStatsToStorageMap(e),[4,this._chromeStorage.local.setSingle("dirtyMonthlyStatsKey",t)];case 1:return n.sent(),[2]}}))}))},e.prototype.incrementStoredCount=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.getStoredCount()];case 1:return e=t.sent(),[4,this.updateStoredCount(e+1)];case 2:return t.sent(),[2]}}))}))},e.prototype._setStoredCount=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._chromeStorage.local.setSingle("numRecordingsStored",e)];case 1:return t.sent(),this._$rootScope.$broadcast("event:redecorateAccount"),[2]}}))}))},e.prototype.clearDirtyMonthlyStats=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this._setDirtyMonthlyStats({count:0,duration:0})];case 1:return e.sent(),[2]}}))}))},e.prototype._monthStatsToStorageMap=function(e){var t={};return t[this._getCurrentMonthKey()]=e,t},e.prototype._storageMapToStats=function(e){return e[this._getCurrentMonthKey()]},e.prototype.getDirtyMonthlyStats=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._chromeStorage.local.getSingle("dirtyMonthlyStatsKey",{})];case 1:return e=t.sent(),[2,this._storageMapToStats(e)||{count:0,duration:0}]}}))}))},e.prototype.getStoredCount=function(){return this._chromeStorage.local.getSingle("numRecordingsStored",0)},e.prototype._incrementPaidRecordingsCount=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._chromeStorage.local.getSingle("paidNumRecordingsStored",0)];case 1:return e=t.sent(),[4,this._chromeStorage.local.setSingle("paidNumRecordingsStored",e+1)];case 2:return t.sent(),[2]}}))}))},e.prototype.getPaidCount=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this._chromeStorage.local.getSingle("paidNumRecordingsStored",0)];case 1:return[2,e.sent()]}}))}))},e.prototype.updateMonthlyStats=function(e,t){return Object(s.__awaiter)(this,void 0,void 0,(function(){var n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return n=[this._updateDirtyMonthlyStats(e),this._bgUsageStatsClientService.updateMonthlyStats(e)],t&&n.push(this._incrementPaidRecordingsCount()),[4,Promise.all(n).catch((function(){}))];case 1:return r.sent(),this._$rootScope.$broadcast("event:redecorateAccount"),[2]}}))}))},e.prototype.updateStoredCount=function(e){this._throttledSendStoredCount$.next(e)},e.fac=function(t){return new(t||e)(o.Bb(ke),o.Bb(Fe),o.Bb(Me))},e.prov=o.vb({token:e,factory:e.fac,providedIn:"root"}),e}();a.module("cf2.bgUsageStatsService",[]);var Le=function(){function e(e){if(e)throw new Error("ChromeStorageModule is already loaded.")}return e.mod=o.xb({type:e}),e.inj=o.wb({factory:function(t){return new(t||e)(o.Bb(e,12))},providers:[Fe],imports:[[Y.a]]}),e}(),Be=n("nco3"),Ne=n("0cIN"),Ve=function(){function e(e,t,n){this._cf2ChromeStorageService=e,this._appRegistry=t,this._$rootScope=n}return e.prototype._loadConnectedApps=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this._cf2ChromeStorageService.sync.getSingle("connectedAppIds",[])];case 1:return[2,e.sent().map((function(e){return"number"==typeof e?{id:e,hasShareUrl:!0}:e}))]}}))}))},e.prototype._loadRecent=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){return[2,this._cf2ChromeStorageService.sync.getSingle("connectedAppRecentId",void 0)]}))}))},e.prototype._saveRecent=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._cf2ChromeStorageService.sync.setSingle("connectedAppRecentId",e)];case 1:return[2,t.sent()]}}))}))},e.prototype._saveConnectedApps=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._cf2ChromeStorageService.sync.setSingle("connectedAppIds",e)];case 1:return[2,t.sent()]}}))}))},e.prototype.getConnectedIds=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.getConnectedAppInfo()];case 1:return t=n.sent(),[2,this._filterByQuery(t,e).map((function(e){return e.id}))]}}))}))},e.prototype._filterByQuery=function(e,t){return e.filter((function(e){return!t||Object.keys(t).every((function(n){return t[n]===e[n]}))}))},e.prototype.getConnectedAppInfo=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._loadConnectedApps()];case 1:return e=t.sent(),[4,this._appRegistry.getApps(e.map((function(e){return e.id})))];case 2:return[2,t.sent().map((function(t){var n=e.find((function(e){return e.id===t.id}));return Object(s.__assign)(Object(s.__assign)({},t),n)}))]}}))}))},e.prototype.getConnectedAppInfoById=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.getConnectedAppInfo()];case 1:return t=r.sent(),(n=t.find((function(t){return t.id===e})))?[2,n]:[2,null]}}))}))},e.prototype.hasConnectedApps=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.getConnectedAppInfo()];case 1:return[2,e.sent().length>0]}}))}))},e.prototype.isConnected=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._loadConnectedApps()];case 1:return[2,t.sent().some((function(t){return t.id===e}))]}}))}))},e.prototype.disconnect=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this._loadConnectedApps()];case 1:return t=(t=n.sent()).filter((function(t){return t.id!==e})),[4,this._saveRecent(null)];case 2:return n.sent(),[4,this._saveConnectedApps(t)];case 3:return n.sent(),this._$rootScope.$broadcast("connect:appDisconnected",e),[2]}}))}))},e.prototype.connect=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return[4,this._loadConnectedApps()];case 1:return t=r.sent(),[4,this._appRegistry.getAppInfo(e)];case 2:return n=r.sent(),t.some((function(t){return t.id===e}))?[3,4]:(t.push({id:e,hasShareUrl:!!n.shareUrl}),n.shareUrl?[4,this._saveRecent(e)]:[3,4]);case 3:r.sent(),r.label=4;case 4:return[4,this._saveConnectedApps(t)];case 5:return r.sent(),this._$rootScope.$broadcast("connect:appConnected",e,n),[2]}}))}))},e.prototype._setUserDataForApp=function(e,t,n){return Object(s.__awaiter)(this,void 0,void 0,(function(){var r,i,o;return Object(s.__generator)(this,(function(a){switch(a.label){case 0:return[4,this._loadConnectedApps()];case 1:if(r=a.sent(),!(i=r.find((function(t){return t.id===e}))))throw new Error("Cannot set user data for non-connected app");return o=i[t],null==n?delete i[t]:i[t]=n,[4,this._saveConnectedApps(r)];case 2:return a.sent(),[2,o]}}))}))},e.prototype.setUserExpiryDate=function(e,t){return Object(s.__awaiter)(this,void 0,void 0,(function(){var n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return[4,this._setUserDataForApp(e,"userExpiryDate",t)];case 1:return n=r.sent(),this._$rootScope.$broadcast("connect:userExpiryDateChange",n,t),[2]}}))}))},e.prototype.setUserShareUrl=function(e,t){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this._setUserDataForApp(e,"shareUrl",t)];case 1:return[2,n.sent()]}}))}))},e.prototype.clearRecent=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this._saveRecent(null)];case 1:return[2,e.sent()]}}))}))},e.prototype.getRecent=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this._loadRecent()];case 1:return[2,e.sent()]}}))}))},e.fac=function(t){return new(t||e)(o.Bb(Fe),o.Bb($e),o.Bb(ke))},e.prov=o.vb({token:e,factory:e.fac,providedIn:"root"}),e}();a.module("cf2.connectedAppsService",[]);var He=n("3riI"),qe=n("AqJ0"),We=n("z5yO"),ze=n("Jg5f"),Je=function(){function e(e,t){this._userAccount=e,this._appOptions=t,this.hasUnlimitedStorage=!0,this.license={},this._init()}return e.prototype.hasFeature=function(e){return this.isPaid||this.license.planVariantSettings&&this.license.planVariantSettings[e]},e.prototype.getRecordingTimeLimit=function(){return this._appOptions.values.enableTimeLimitWarning&&this.license.limitLength?this.license.maxLength:0},e.prototype.getIsComboVariantExceeded=function(){return!window.localStorage.e2e&&this.onComboVariantExceeded().pipe(Object(C.a)()).toPromise()},e.prototype.getIsVideoStorageLimitExceeded=function(){return!window.localStorage.e2e&&this.onVideoStorageLimitExceeded().pipe(Object(C.a)()).toPromise()},e.prototype._init=function(){var e=this;this._account$=this._userAccount.onAccount().pipe(Object(qe.a)(1)),this._account$.subscribe((function(t){e.license=t.license})),this.onHasUnlimitedStorage().subscribe((function(t){return e.hasUnlimitedStorage=t})),this.onMaxRecordingsMonth().subscribe((function(t){return e.maxRecordingsMonth=t})),this.onMonthlyLimitExceeded().subscribe((function(t){return e.isMonthlyLimitExceeded=t})),this.onComboVariantExceeded().subscribe((function(t){return e.isComboVariantExceeded=t})),this.onVideoStorageLimitExceeded().subscribe((function(t){return e.videoStorageLimitExceeded=t})),this.onRecordingsRemainingMonth().subscribe((function(t){return e.recordingsRemainingMonth=t})),this.onHasDefaultVariant().subscribe((function(t){return e.hasDefaultVariant=t})),this.onIsPaid().subscribe((function(t){return e.isPaid=t})),this.onIsSignedIn().subscribe((function(t){return e.isSignedIn=t}))},e.prototype.onRecordingTimeLimit=function(){return this._account$.pipe(Object(We.a)((function(e){return e.license&&e.license.limitLength})),Object(ze.a)((function(e){return e.license.maxLength})))},e.prototype.onHasUnlimitedRecordingTime=function(){return this.onRecordingTimeRemainingMonth().pipe(Object(ze.a)((function(e){return e>1e7})))},e.prototype.onHasUnlimitedRecordings=function(){return this.onRecordingsRemainingMonth().pipe(Object(ze.a)((function(e){return e>1e7})))},e.prototype.onHasUnlimitedStorage=function(){return this.onRecordingStorageLimit().pipe(Object(ze.a)((function(e){return e>1e5})))},e.prototype.onNumRecordingsMonth=function(){return this._account$.pipe(Object(ze.a)((function(e){return e.numRecordingsMonth})))},e.prototype.onMaxRecordingsMonth=function(){return this._account$.pipe(Object(ze.a)((function(e){return e.license.maxNumRecordings})))},e.prototype.onMonthlyLimitExceeded=function(){return Object(He.a)(this.onMonthlyRecordingsLimitExceeded(),this.onMonthlyTimeLimitExceeded(),this.onVideoStorageLimitExceeded()).pipe(Object(ze.a)((function(e){var t=Object(s.__read)(e,3);return t[0]||t[1]||t[2]})))},e.prototype.onComboVariantExceeded=function(){return Object(He.a)(this.onHasDefaultVariant(),this.onMonthlyTimeLimitExceeded(),this.onVideoStorageLimitExceeded()).pipe(Object(ze.a)((function(e){var t=Object(s.__read)(e,3);return!t[0]&&t[1]&&t[2]})))},e.prototype.onMonthlyRecordingsLimitExceeded=function(){return this._account$.pipe(Object(ze.a)((function(e){return e.license.limitNumRecordings&&e.numRecordingsMonth>=e.license.maxNumRecordings})))},e.prototype.onMonthlyTimeLimitExceeded=function(){return this._account$.pipe(Object(ze.a)((function(e){return e.license.planVariantSettings&&e.totalRecordingTimeMonth>=e.license.planVariantSettings.maxRecordingTimeMonth})))},e.prototype.onVideoStorageLimitExceeded=function(){return Object(He.a)(this.onRecordingsStoredCount(),this.onRecordingStorageLimit()).pipe(Object(ze.a)((function(e){var t=Object(s.__read)(e,2);return t[0]>=t[1]})))},e.prototype.onRecordingTimeRemainingMonth=function(){return this._account$.pipe(Object(ze.a)((function(e){return Math.max(0,e.license.planVariantSettings?e.license.planVariantSettings.maxRecordingTimeMonth-e.totalRecordingTimeMonth:Number.MAX_SAFE_INTEGER)})))},e.prototype.onRecordingsRemainingMonth=function(){return this._account$.pipe(Object(ze.a)((function(e){return Math.max(0,e.license.maxNumRecordings-e.numRecordingsMonth)})))},e.prototype.onRecordingsStoredCount=function(){return this._account$.pipe(Object(ze.a)((function(e){return e.recordingsStoredCount})))},e.prototype.onRecordingStorageLimit=function(){return this._account$.pipe(Object(ze.a)((function(e){return e.license.planVariantSettings?e.license.planVariantSettings.videoStorageLimit:Number.MAX_SAFE_INTEGER})))},e.prototype.onIsPaid=function(){return this._account$.pipe(Object(ze.a)((function(e){return e.license.isPaid})))},e.prototype.onPlanVariant=function(){return this._onUser().pipe(Object(ze.a)((function(e){return e.planVariant})))},e.prototype.onHasFeature=function(e){return this._account$.pipe(Object(ze.a)((function(t){var n=t.license;return n.isPaid||n.planVariantSettings&&n.planVariantSettings[e]})))},e.prototype.onIsSignedIn=function(){return this._account$.pipe(Object(ze.a)((function(e){return!!e.user})))},e.prototype._onUser=function(){return this._account$.pipe(Object(We.a)((function(e){return!!e.user})),Object(ze.a)((function(e){return e.user})))},e.prototype.onHasDefaultVariant=function(){return this.onPlanVariant().pipe(Object(ze.a)((function(e){return!e||"default"===e})))},e.prototype.onIsStudent=function(){return this._onUser().pipe(Object(ze.a)((function(e){return e.survey&&"student"===e.survey.user_type})))},e.prototype.onIsTeacher=function(){return this._onUser().pipe(Object(ze.a)((function(e){return e.survey&&"educator"===e.survey.user_type})))},e.prototype.signIn=function(){return this._userAccount.signIn()},e.prototype.openBuy=function(e,t){window.open("https://www.screencastify.com/buy?utm_source=app&utm_source=app&utm_campaign="+e+"\n      "+(t?"&utm_content="+t:""),"_blank")},e.fac=function(t){return new(t||e)(o.Bb(pe),o.Bb(Se))},e.prov=o.vb({token:e,factory:e.fac}),e}();a.module("cf2.upgradeHelperService",[]).factory("cf2UpgradeHelperService",Object(K.b)(Je));var Ge=Be.Log.create("cf2BgMessagesService"),Ye=function(){function e(e,t,n,r,i,o,a,c){this._connectedApps=e,this._upgradeHelperService=t,this._castifyAuth=n,this._bgFiles=r,this._bgUserAccount=i,this._chromePersistentLogger=o,this._chromeRuntime=a,this._chromeTabs=c,this._initializationComplete=!1}return e.prototype._sendBgLoaded=function(){this._chromeRuntime.sendMessage("bg:loaded").catch((function(){return null}))},e.prototype._onMessage=function(e,t,n){if("bg:load"===e&&this._initializationComplete)this._sendBgLoaded();else if("bg:flushLogs"===e)return this._chromePersistentLogger.save().finally(n),!0;return!1},e.prototype._getAppUrl=function(e){return"chrome-extension://"+this._chromeRuntime.id+"/ng/app/app.html#"+e},e.prototype._hasTabId=function(e){return!(!e.tab||!e.tab.id)},e.prototype._launchApp=function(e,t){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(n){switch(n.label){case 0:if(Ge.d("handling bg:launchApp",e),!this._hasTabId(t))throw new Error("no id");return e?[4,this._bgFiles.refresh(e)]:[3,4];case 1:return n.sent(),[4,Object(Ne.a)(500).pipe(Object(C.a)()).toPromise()];case 2:return n.sent(),[4,this._chromeTabs.update(t.tab.id,{url:this._getAppUrl("/files/"+e)})];case 3:return n.sent(),[3,6];case 4:return[4,this._chromeTabs.update(t.tab.id,{url:this._getAppUrl("/")})];case 5:n.sent(),n.label=6;case 6:return[2,!0]}}))}))},e.prototype._focusWebsiteAfterInlineInstall=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return Ge.d("cf2BgMessagesService: focusing website"),this._hasTabId(e)?[4,this._chromeTabs.getActiveTab()]:[2];case 1:return(t=n.sent()).id===e.tab.id?[3,3]:[4,this._chromeTabs.remove(t.id)];case 2:n.sent(),n.label=3;case 3:return[4,this._chromeTabs.update(e.tab.id,{active:!0})];case 4:return n.sent(),[2]}}))}))},e.prototype._requestToType=function(e){return e&&e.type?e.type:e},e.prototype._onMessageExternal=function(e,t,n){var r;switch(this._requestToType(e)){case"bg:launchApp":r=this._launchApp(e.data,t);break;case"bg:launchSupport":r=this._chromeTabs.create({url:this._getAppUrl("/support")});break;case"bg:focusWebsite":r=this._focusWebsiteAfterInlineInstall(t);break;case"bg:getPlanVariant":r=this._getPlanVariant();break;case"bg:getSignInToken":r=this._castifyAuth.getAuthToken({interactive:!0});break;case"bg:updateLicense":r=this._bgUserAccount.update();break;case"bg:isInstalled":n(this._chromeRuntime.getManifest().version);break;case"bg:connectApp":r=this._connectedApps.connect(e.data).then((function(){return!0}));break;case"bg:getLicenseInfo":r=this._getLicenseInfo()}return!!r&&(r.catch((function(){return!1})).then(n),!0)},e.prototype._getLicenseInfo=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this._bgUserAccount.getAccount()];case 1:return e=n.sent(),t={isPaid:e.license.isPaid,isTester:e.license.isTester,license:e.license,user:e.user},e.user&&(t.email=e.user.email,t.analyticsUid=e.user.analyticsUid),[2,t]}}))}))},e.prototype.install=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e=this;return Object(s.__generator)(this,(function(t){return this._chromeRuntime.onMessage.addListener((function(t,n,r){return e._onMessage(t,n,r)})),this._chromeRuntime.onMessageExternal.addListener((function(t,n,r){return e._onMessageExternal(t,n,r)})),[2]}))}))},e.prototype._getPlanVariant=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._bgUserAccount.getAccount()];case 1:return(e=t.sent())&&e.user?[2,this._upgradeHelperService.onPlanVariant().pipe(Object(C.a)()).toPromise()]:[2,!1]}}))}))},e.prototype.initializationCompleted=function(){this._initializationComplete=!0,this._sendBgLoaded()},e.fac=function(t){return new(t||e)(o.Bb(Ve),o.Bb(Je),o.Bb(je),o.Bb(xe),o.Bb(Oe),o.Bb(_e),o.Bb(Ee),o.Bb(Ie))},e.prov=o.vb({token:e,factory:e.fac,providedIn:"root"}),e}();a.module("cf2.cf2BgMessagesServiceService",[]);var Ke=function(){function e(e){this._simpleBgServiceConsumer=e;var t=this._simpleBgServiceConsumer("userAccount",["getAccount","signIn","postUpdate","signOut","updateVariant"]);Object.assign(this,t)}return e.fac=function(t){return new(t||e)(o.Bb(Ae))},e.prov=o.vb({token:e,factory:e.fac,providedIn:"root"}),e}();a.module("cf2.userAccount",[]).factory("userAccount",Object(K.b)(Ke));var Qe=function(){function e(e){if(e)throw new Error("UpgradeHelperModule is already loaded.")}return e.mod=o.xb({type:e}),e.inj=o.wb({factory:function(t){return new(t||e)(o.Bb(e,12))},providers:[Je],imports:[[Y.a]]}),e}(),Xe=function(){function e(e,t,n){this._chromeRuntime=e,this._chromeTabs=t,this._chromeWindows=n}return e.prototype._pathToUrl=function(e){return e.startsWith("#")?"chrome-extension://"+this._chromeRuntime.id+"/ng/app/app.html"+e:e},e.prototype.create=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return t=this._pathToUrl(e),[4,this._chromeTabs.create({active:!0,url:t})];case 1:return n=r.sent(),[4,this._chromeWindows.update(n.windowId,{focused:!0})];case 2:return r.sent(),[2]}}))}))},e.fac=function(t){return new(t||e)(o.Bb(Ee),o.Bb(Ie),o.Bb(Ce))},e.prov=o.vb({token:e,factory:e.fac,providedIn:"root"}),e}();a.module("cf2.inAppTabService",[]);var Ze=n("LR82");function et(e,t,n){var r,i,o;void 0===n&&(n=!0),n=!1!==n;var a=function(){o=Object.assign([],arguments),i=function(){return r=null,i=null,e.apply(null,o)},n?(r&&window.clearTimeout(r),r=window.setTimeout(i,t)):r||(r=window.setTimeout(i,t))};return a.flush=function(){r&&(window.clearTimeout(r),i())},a.cancel=function(){r&&window.clearTimeout(r)},a}var tt=n("3sQE"),nt="castifyDrawStore",rt=function(){function e(){this._started=!1,this._loadedPromise=null,this.STORE_MSG_TYPE=nt}return e.prototype._load=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return this._loadedPromise=(n="cfDraw_store",r={},new Promise((function(e,t){chrome.storage.local.get(n,(function(i){if(chrome.runtime.lastError)return t(chrome.runtime.lastError);e(i.hasOwnProperty(n)?i[n]:r)}))}))),e=this,[4,this._loadedPromise];case 1:return e._data=t.sent(),[2]}var n,r}))}))},e.prototype._save=function(){var e;e=this._data,new Promise((function(t,n){var r;chrome.storage.local.set(((r={}).cfDraw_store=e,r),(function(){if(chrome.runtime.lastError)return n(chrome.runtime.lastError);t()}))}))},e.prototype._onMessage=function(e){e&&e.type===nt&&(this._data=e.data,this._save())},e.prototype.getData=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this._loadedPromise];case 1:return e.sent(),[2,this._data]}}))}))},e.prototype.start=function(){if(this._started)throw new Error("bg-storage-service already started");this._started=!0,this._load()},e.prototype.stop=function(){this._started&&(this._started=!1)},e.prototype.handleMessage=function(e){this._started&&this._onMessage(e)},e.prov=o.vb({token:e,factory:e.fac=function(t){return new(t||e)},providedIn:"root"}),e}(),it=window.crypto;function ot(e){return it.subtle.exportKey("jwk",e)}var at=function(){function e(){this._keyPromise=it.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]).then(ot),this._started=!1,this._onMessageBound=this._onMessage.bind(this)}return e.prototype._onMessage=function(e,t,n){if(!e)return!1;if("castifyDrawGetMsgKey"===e.type){if(function(e){return e.tab.url.startsWith("https://")}(t))return this._keyPromise.then((function(e){return n(e)}),(function(){return n(null)})),!0;n("plain")}else if("castifyDrawFrameBroadcast"===e.type&&t.tab)chrome.tabs.sendMessage(t.tab.id,e.data);else if("castifyDrawFrameBroadcastWithResult"===e.type&&t.tab)return chrome.tabs.sendMessage(t.tab.id,e.data,(function(e){n(e)})),!0;return!1},e.prototype.start=function(){this._started||(chrome.runtime.onMessage.addListener(this._onMessageBound),this._started=!0)},e.prototype.stop=function(){this._started&&(this._started=!1,chrome.runtime.onMessage.removeListener(this._onMessageBound))},e.prov=o.vb({token:e,factory:e.fac=function(t){return new(t||e)},providedIn:"root"}),e}();function ct(e){return e instanceof Error?Promise.reject(e.toString()):Promise.reject(e)}var st=window.navigator,ut=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),t}(Error),lt=function(){function e(){this._hasDisplayMedia=st.mediaDevices&&"getDisplayMedia"in st.mediaDevices}return Object.defineProperty(e.prototype,"hasDisplayMedia",{get:function(){return this._hasDisplayMedia},enumerable:!0,configurable:!0}),e.prototype._throwWrappedPermissionError=function(e){if(this.isPermissionError(e))throw new ut;throw e},e.prototype.getUserMedia=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,navigator.mediaDevices.getUserMedia(e)];case 1:return[2,n.sent()];case 2:return t=n.sent(),this._throwWrappedPermissionError(t),[3,3];case 3:return[2]}}))}))},e.prototype.getDisplayMedia=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:if(!this._hasDisplayMedia)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,navigator.mediaDevices.getDisplayMedia(e)];case 2:return[2,n.sent()];case 3:return t=n.sent(),this._throwWrappedPermissionError(t),[3,4];case 4:return[3,6];case 5:throw new Error("getDisplayMedia() not supported, make sure chrome://flags/#enable-experimental-web-platform-features is enabled");case 6:return[2]}}))}))},e.prototype.getSources=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return st.mediaDevices?[4,st.mediaDevices.enumerateDevices()]:[2,[]];case 1:return[2,e.sent().filter((function(e){return e.kind.endsWith("input")})).map((function(e){return{id:e.deviceId,label:e.label,kind:e.kind.substring(0,e.kind.length-5)}}))]}}))}))},e.prototype.getSourcesByKind=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.getSources()];case 1:return[2,t.sent().filter((function(t){return t.kind===e}))]}}))}))},e.prototype.getVideoSources=function(){return this.getSourcesByKind("video")},e.prototype.getAudioSources=function(){return this.getSourcesByKind("audio")},e.prototype.hasCamera=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.getVideoSources()];case 1:return[2,e.sent().length>0]}}))}))},e.prototype.hasMicrophone=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.getAudioSources()];case 1:return[2,e.sent().length>0]}}))}))},e.prototype.hasLabel=function(e){return e.some((function(e){return!!e.label}))},e.prototype.hasVideoAccess=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return e=this.hasLabel,[4,this.getVideoSources()];case 1:return[2,e.apply(this,[t.sent()])]}}))}))},e.prototype.hasAudioAccess=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return e=this.hasLabel,[4,this.getAudioSources()];case 1:return[2,e.apply(this,[t.sent()])]}}))}))},e.prototype.getCameraAndMicPermission=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e,t,n,r;return Object(s.__generator)(this,(function(i){switch(i.label){case 0:return[4,this.hasCamera()];case 1:e=i.sent(),t=!1,n=!1,i.label=2;case 2:return i.trys.push([2,4,,5]),[4,navigator.mediaDevices.getUserMedia({audio:!0,video:e})];case 3:return r=i.sent(),n=!!r.getVideoTracks().length,t=!!r.getAudioTracks().length,r.getTracks().forEach((function(e){e.stop()})),[3,5];case 4:return i.sent(),[3,5];case 5:return[2,{video:n,audio:t}]}}))}))},e.prototype.isPermissionError=function(e){return e&&("PermissionDeniedError"===e.name||"MediaDeviceFailedDueToShutdown"===e.name||"NotAllowedError"===e.name||"InvalidStateError"===e.name)},e.prov=o.vb({token:e,factory:e.fac=function(t){return new(t||e)},providedIn:"root"}),e}(),dt=function(){function e(e){var t=this;this.webrtc=e,this._started=!1,this._onMessageBound=this._onMessage.bind(this),this._throttledStop=et((function(){return t._disposeStream()}),1e3),this.msgHandlers={start:function(e){return Object(s.__awaiter)(t,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:if(this._throttledStop.cancel(),this._stream){if(JSON.stringify(this._streamConstraints)===JSON.stringify(e))return[2];this._disposeStream()}return t=this,[4,this.getStream(e)];case 1:return t._stream=n.sent(),this._streamConstraints=e,[2]}}))}))},stop:function(){t._throttledStop()}}}return e.prototype._disposeStream=function(){this._throttledStop.cancel(),this._stream&&(this._stream.getTracks().forEach((function(e){e.stop()})),this._stream=null,this._streamConstraints=null)},e.prototype.getStream=function(e){return this.webrtc.getUserMedia({video:e})},e.prototype._onMessage=function(e,t,n){return!!(e&&"castifyDrawCamSustainMsg"===e.type&&(e=e.data)&&this.msgHandlers.hasOwnProperty(e.type))&&(function(e,t){Promise.resolve(t).catch(ct).then((function(t){e({type:"result",data:t})}),(function(t){e({type:"error",data:t})}))}(n,this.msgHandlers[e.type](e.data)),!0)},e.prototype.start=function(){this._started||(chrome.runtime.onMessage.addListener(this._onMessageBound),this._started=!0)},e.prototype.stop=function(){this._started&&(this._started=!1,this._disposeStream(),chrome.runtime.onMessage.removeListener(this._onMessageBound))},e.fac=function(t){return new(t||e)(o.Bb(lt))},e.prov=o.vb({token:e,factory:e.fac,providedIn:"root"}),e}();function ft(e,t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new Promise((function(r,i){n.push((function(e){chrome.runtime.lastError?i(chrome.runtime.lastError):r(e)})),e.apply(t,n)}))}}var pt={executeScript:ft(chrome.tabs.executeScript,chrome.tabs),insertCSS:ft(chrome.tabs.insertCSS,chrome.tabs),connect:chrome.tabs.connect.bind(chrome.tabs)},ht=function(){function e(e,t,n){this._storageService=e,this._messageService=t,this._camSustainService=n,this._servicesStarted=!1,this._tabBgServices=new Map,this._bundlesPath="",this._cssPath="content-script/assets/fonts/fonts.css",this._log=Be.Log.create("BgCastifyDrawService")}return e.prototype.isActiveTabInjected=function(){return Array.from(this._tabBgServices.values()).some((function(e){return e.tabActive&&e.successfulInjection}))},e.prototype._startServicesIfNotStarted=function(){this._servicesStarted||(this._servicesStarted=!0,this._messageService.start(),this._storageService.start(),this._camSustainService.start())},e.prototype._onMessageListener=function(e,t){var n,r,i=function(){return null};if(t&&t.type===this._storageService.STORE_MSG_TYPE){this._storageService.handleMessage(t);try{for(var o=Object(s.__values)(this._tabBgServices.entries()),a=o.next();!a.done;a=o.next()){var c=Object(s.__read)(a.value,2);c[0]!==e&&c[1].sendMessage(t).catch(i)}}catch(u){n={error:u}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}},e.prototype.loadInTab=function(e,t){return Object(s.__awaiter)(this,void 0,void 0,(function(){var n,r=this;return Object(s.__generator)(this,(function(i){switch(i.label){case 0:return this._log.d("loadInTab",e,t),this._startServicesIfNotStarted(),this._tabBgServices.get(e)?[2]:((n=new gt(this._storageService,e,this._bundlesPath,this._cssPath)).setOnMessageListener((function(t){return r._onMessageListener(e,t)})),this._tabBgServices.set(e,n),[4,Object(F.a)(n.initialize(t)).pipe(Object(tt.a)(1e4,Object(re.a)(new Error("failed to init castify-draw within timeout")))).toPromise()]);case 1:return i.sent(),[2]}}))}))},e.prototype.disposeInTab=function(e){var t=this._tabBgServices.get(e);t&&(t.dispose(),this._tabBgServices.delete(e),this._tabBgServices.size||this._stopServices())},e.prototype.disposeAll=function(){var e,t;try{for(var n=Object(s.__values)(this._tabBgServices.values()),r=n.next();!r.done;r=n.next())r.value.dispose()}catch(i){e={error:i}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this._tabBgServices.clear(),this._stopServices()},e.prototype._stopServices=function(){this._servicesStarted=!1,this._camSustainService.stop(),this._messageService.stop(),this._storageService.stop()},e.fac=function(t){return new(t||e)(o.Bb(rt),o.Bb(at),o.Bb(dt))},e.prov=o.vb({token:e,factory:e.fac,providedIn:"root"}),e}(),gt=function(){function e(e,t,n,r){var i=this;this._storage=e,this.tabId=t,this._cssPath=r,this.msgHandlers={},this.onMessageListener=null,this.tabActive=!0,this.successfulInjection=!1,this._subscription=new Ze.a,this._log=Be.Log.create("BgCastifyDrawTabService "),this.throttledLoadFrame=et((function(){i._loadContentScript(!1).catch((function(){return null}))}),1e3),this._jsPath=n+"content-script.js",this._jsPathFrame=n+"content-script-frame.js",this.init()}return e.prototype._loadContentScript=function(e){var t=this,n=[pt.executeScript(this.tabId,{file:e?this._jsPath:this._jsPathFrame,allFrames:!0,matchAboutBlank:!0,runAt:"document_start"})];return e&&n.push(pt.insertCSS(this.tabId,{file:this._cssPath,allFrames:!0,matchAboutBlank:!0,runAt:"document_start"})),Promise.all(n).catch((function(e){return t._log.error(e),Promise.reject(new Error("injecting castify-draw failed"))}))},e.prototype._loadAndConnect=function(){var e=this;if(!this.portPromise){var t=this._loadContentScript(!0).then((function(){var n=pt.connect(e.tabId,{name:"castifyDraw"});return n.onDisconnect.addListener((function(){e.portPromise===t&&(e.portPromise=null)})),n.onMessage.addListener((function(t){e.msgHandlers.hasOwnProperty(t.type)?e.msgHandlers[t.type](n,t.data):e.onMessageListener&&e.onMessageListener(t)})),e.port=n,e.successfulInjection=!0,n}));t.catch((function(t){e._log.info("BgCastifyDrawServiceError",t)})),this.portPromise=t}return this.portPromise},e.prototype.initTopFrame=function(){var e=this;this._disconnect(),this.postInitialize(this.initConfig).catch((function(){return e._logLoadError()}))},e.prototype.postInitialize=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n,r=this;return Object(s.__generator)(this,(function(i){switch(i.label){case 0:return t=new Promise((function(e){r.msgHandlers.initializeDone=function(){r.msgHandlers.initializeDone=null,e()}})),[4,this._loadAndConnect()];case 1:return i.sent(),[4,this._storage.getData()];case 2:return n=i.sent(),this.postMessage("initialize",{config:e,storage:n,chromeCommands:this._chromeCommands}),[4,t];case 3:return i.sent(),this.msgHandlers.initializeDone=null,this.initConfig=void 0,[2]}}))}))},e.prototype.onCommitted=function(e){e.tabId===this.tabId&&(0===e.frameId?(this.throttledLoadFrame.cancel(),this.initTopFrame()):this.throttledLoadFrame())},e.prototype._logLoadError=function(){this._log.warn("could not load castify-draw in tab",this.tabId)},e.prototype.onTabReplaced=function(e){e.replacedTabId===this.tabId&&(this.tabId=e.tabId,this.initTopFrame())},e.prototype.onTabSwitch=function(e){this.updateTabFocused(e.tabId)},e.prototype.onWindowSwitch=function(){var e=this;chrome.tabs.query({active:!0,windowId:chrome.windows.WINDOW_ID_CURRENT},(function(t){e.updateTabFocused(t.length?t[0].id:-1)}))},e.prototype.updateTabFocused=function(e){var t=this;e===this.tabId?(this.tabActive=!0,this.postMessage("updateTabFocused",this.tabActive).catch((function(){return t._logLoadError()}))):this.tabActive&&(this.tabActive=!1,this.postMessage("updateTabFocused",this.tabActive).catch((function(){return t._logLoadError()})))},e.prototype.init=function(){var e,t,n=this;this._loadAndConnect().catch((function(){return null}));var r=[te(chrome.webNavigation.onCommitted).subscribe((function(e){var t=Object(s.__read)(e,1);return n.onCommitted(t[0])})),te(chrome.webNavigation.onTabReplaced).subscribe((function(e){var t=Object(s.__read)(e,1);return n.onTabReplaced(t[0])})),te(chrome.tabs.onActivated).subscribe((function(e){var t=Object(s.__read)(e,1);return n.onTabSwitch(t[0])})),te(chrome.windows.onFocusChanged).subscribe((function(){return n.onWindowSwitch()}))];try{for(var i=Object(s.__values)(r),o=i.next();!o.done;o=i.next())this._subscription.add(o.value)}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e.prototype.postMessage=function(e,t){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this._loadAndConnect()];case 1:return n.sent().postMessage({type:e,data:t}),[2]}}))}))},e.prototype.initialize=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return this.initConfig=e,this._chromeCommands=e.chromeCommands,[4,this.postInitialize(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.setOnMessageListener=function(e){this.onMessageListener=e},e.prototype.sendMessage=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){return[2,this.postMessage(e.type,e.data)]}))}))},e.prototype._disconnect=function(){this.portPromise&&(this.portPromise.then((function(e){return e.disconnect()}),(function(){return null})),this.portPromise=null)},e.prototype.dispose=function(){this._disconnect(),this._subscription.unsubscribe()},e}(),mt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),t}(D.a),bt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),Object.defineProperty(t,"root",{get:function(){return this._getRoot("/youtubeUploadTasks")},enumerable:!0,configurable:!0}),Object.defineProperty(t,"queueTopicSuffix",{get:function(){return"simpleTask2"},enumerable:!0,configurable:!0}),t.Collection=mt,t.taskType="FisYoutubeUploadTask",Object(s.__decorate)([Object(M.a)()],t.prototype,"userId",void 0),Object(s.__decorate)([Object(M.a)()],t.prototype,"driveFileId",void 0),Object(s.__decorate)([Object(M.a)()],t.prototype,"traceContext",void 0),Object(s.__decorate)([Object(M.a)()],t.prototype,"privacy",void 0),Object(s.__decorate)([Object(M.a)()],t.prototype,"channelId",void 0),Object(s.__decorate)([Object(M.a)()],t.prototype,"title",void 0),Object(s.__decorate)([Object(M.a)()],t.prototype,"description",void 0),Object(s.__decorate)([Object(M.a)()],t.prototype,"youtubeInfo",void 0),t}(U.a);L.a._registerTaskType(bt);var vt=function(){function e(e,t){this._$http=e,this._deployConfig=t}return e.prototype.createJob=function(e){return this._$http.post(this._deployConfig.youtubeUpload2URL,e,{googleAuth:!0})},e.fac=function(t){return new(t||e)(o.Bb(Pe),o.Bb(Te))},e.prov=o.vb({token:e,factory:e.fac,providedIn:"root"}),e}(),yt=function(e){function t(){return e.call(this,"no job found")||this}return Object(s.__extends)(t,e),t}(Error),wt=function(){function e(e,t,n){this._bgFiles=e,this._uploadBase=t,this._clientService=n,t.register_("_youtube_remote_2",function(t){function r(e,n){var r=t.call(this,e)||this;return r.config=e,r.jobId=n,r._task=null,r.progress=null,r._log=Be.Log.create("RemoteYoutubeUpload"),r}return Object(s.__extends)(r,t),r.fromObject=function(e){return new r(e.config,e.jobId)},r.prototype.start=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i;return Object(s.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,9,,10]),t=this.config,this.jobId?[4,this._trackProgress(this.jobId)]:[3,3];case 1:return o.sent(),[4,this._handleComplete()];case 2:return o.sent(),[3,8];case 3:return[4,e.getFileDescriptor(t.fileId)];case 4:return n=o.sent(),[4,this._createJob(n)];case 5:return r=o.sent(),[4,this._trackProgress(r)];case 6:return o.sent(),[4,this._handleComplete()];case 7:o.sent(),o.label=8;case 8:return[3,10];case 9:return i=o.sent(),this._handleError(i),[3,10];case 10:return[2]}}))}))},r.prototype._createJob=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return[4,n.createJob({driveFileId:e.driveInfo.id,privacy:this.config.privacy,title:this.config.title,channelId:this.config.channelId,description:this.config.description||""})];case 1:return t=r.sent(),this.jobId=t.data.taskId,[2,t.data.taskId]}}))}))},r.prototype._getYoutubeInfo=function(e){return{id:e.id,channelId:e.snippet.channelId}},r.prototype._trackProgress=function(e){var t=this;return Object(F.a)(bt.root.getById(e)).pipe(Object(ze.a)((function(e){if(!e)throw new yt;return t._task=e,e})),Object(T.a)((function(e){return e.onProgress()})),Object(R.a)((function(e){t.progress=e,t.onProgress()})),Object(P.a)()).toPromise()},r.prototype._handleError=function(e){this._log.warn("original error is",e);var t=!1,n="unknown";e instanceof yt?(t=!1,n=e.message):"unavailable"===e.code?(t=!0,n=e.message):e.status<=0?(t=!0,n=e.statusText||n):"youtubeSignupRequired"===e.msg?(t=!1,n=e.msg):e.status>=500&&e.status<=600?(t=!0,n=e.statusText||n):e.config&&!1===e.config.authAutoRetry&&401===e.status?(t=!0,n=e.statusText||n):401===e.status&&(t=!1,n=e.statusText||n),this.onError({isTransient:t,reason:n})},r.prototype._handleComplete=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,bt.root.getById(this._task.id)];case 1:return t=n.sent(),this._task=t,this.handleComplete_(t.youtubeInfo),e.updateYoutubeInfo(this.config.fileId,this._getYoutubeInfo(t.youtubeInfo)),this.openLink="http://youtu.be/"+t.youtubeInfo.id,this.onComplete(),[2]}}))}))},r.prototype.toObject=function(){return{config:this.config,jobId:this.jobId}},r}(t))}return e.fac=function(t){return new(t||e)(o.Bb(xe),o.Bb(Re),o.Bb(vt))},e.prov=o.vb({token:e,factory:e.fac,providedIn:"root"}),e}();a.module("cf2.remoteYoutubeUploadService",[]);var _t=n("2P9O"),St=n("hPFx"),Et=n("gQst"),Ct=function(){function e(e,t){this._castifyAuth=e,this._bgUserAccount=t,this._log=Be.Log.create("BgFirebaseAuth"),this._fbAuth=Object(l.b)().auth()}return e.prototype._sync=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e,t,n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return[4,this._castifyAuth.getAuthToken().catch((function(){return null}))];case 1:return(e=r.sent())?(this._log.data("signing in"),t=f.a.auth.GoogleAuthProvider.credential(null,e),[4,this._fbAuth.signInAndRetrieveDataWithCredential(t)]):[3,4];case 2:return n=r.sent(),[4,this._updateFbEmail(n.user)];case 3:return r.sent(),[3,6];case 4:return this._log.data("signing out"),[4,this._fbAuth.signOut()];case 5:r.sent(),r.label=6;case 6:return[2]}}))}))},e.prototype._updateFbEmail=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this._bgUserAccount.getAccount()];case 1:return t=n.sent(),e&&t?t.user.email===e.email?[3,3]:(this._log.data("updating fb user email from %s to %s",e.email,t.user.email),[4,e.updateEmail(t.user.email)]):[2];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},e.prototype.install=function(){var e=this,t=Object(St.a)(this._fbAuth).pipe(Object(We.a)((function(e){return!e})));Object(Et.a)(this._bgUserAccount.onAccount(),t).subscribe((function(){return e._sync()}))},e.fac=function(t){return new(t||e)(o.Bb(je),o.Bb(Oe))},e.prov=o.vb({token:e,factory:e.fac,providedIn:"root"}),Object(s.__decorate)([_t.a.serialize],e.prototype,"_sync",null),e}(),It=n("wIp5"),At=n.n(It),Ot=["gmail.com","googlemail.com","hotmail.com","yahoo.com"],jt=["screencastify.com"],xt=function(){function e(){}return e.prototype.generate=function(e){var t=e.split("@")[1];if(jt.includes(t))return 0;var n=Ot.includes(t)?e:t,r=At.a.MD5(n).toString();return parseInt(r.slice(0,2),16)/256},e.prov=o.vb({token:e,factory:e.fac=function(t){return new(t||e)},providedIn:"root"}),e}(),Tt=function(){function e(e,t,n,r){this._appOptions=e,this._chromeRuntime=t,this._bgUserAccount=n,this._domainRandom=r,this._log=Be.Log.create("FeatureRolloutService")}return e.prototype._updateRolloutOptions=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,o,a,c,u,l,d,f;return Object(s.__generator)(this,(function(p){switch(p.label){case 0:return[4,this._appOptions.loadedPromise];case 1:return p.sent(),n=(t=e&&e.user||null)&&t.email?this._domainRandom.generate(t.email):.9999,[4,I.get()];case 2:r=p.sent()||{},i={};try{for(o=Object(s.__values)(Object.entries(r)),a=o.next();!a.done;a=o.next())c=Object(s.__read)(a.value,2),l="number"==typeof(u=c[1])?u:u.percentage,i[c[0]]=this._hasMinimumVersion(u)&&n<l}catch(h){d={error:h}}finally{try{a&&!a.done&&(f=o.return)&&f.call(o)}finally{if(d)throw d.error}}return i.hwEncoding=i.hwEncoding||window.navigator.userAgent.indexOf("CrOS")>=0,this._log.d("Feature rollout config is",i),this._appOptions.setRolloutValues(i),[2]}}))}))},e.prototype._hasMinimumVersion=function(e){if("number"==typeof e)return!0;var t=this._chromeRuntime.getManifest().version;return O.isLessOrEqual(e.minVersion,t)},e.prototype.install=function(){var e=this;this._bgUserAccount.onAccount().subscribe((function(t){return e._updateRolloutOptions(t)}))},e.fac=function(t){return new(t||e)(o.Bb(Se),o.Bb(Ee),o.Bb(Oe),o.Bb(xt))},e.prov=o.vb({token:e,factory:e.fac,providedIn:"root"}),e}(),Rt=n("pN2L"),Pt={foo:function(){function e(){}return e.prototype.onFoo=function(){return Object(Rt.a)(1,2,3)},e.prototype.hello=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){return console.log("hello servify"),[2,"world"]}))}))},e.prov=o.vb({token:e,factory:e.fac=function(t){return new(t||e)},providedIn:"root"}),e}()},kt="servify_",$t=function(e){function t(t){return e.call(this,"Servify usage error: "+t)||this}return Object(s.__extends)(t,e),t}(Error),Ft=function(){function e(e,t){this._service=t,this._ports=new Map,this._clientSubscriptions=new Map,this._portName=kt+e,this._log=Be.Log.create("ServifyPublisher:"+e)}return e.prototype.publish=function(){var e=this;if(this._log.data("publishing service"),this._subscription)throw new Error;this._subscription=te(chrome.runtime.onConnect).subscribe((function(t){var n=Object(s.__read)(t,1);return e._onConnect(n[0])}))},e.prototype._onConnect=function(e){var t=this;e.name===this._portName&&(this._log.data("New connection from",e.sender),this._ports.set(e,new se((function(n){t._ports.has(e)&&e.postMessage(n)}))),this._clientSubscriptions.set(e,new Ze.a),te(e.onMessage).subscribe((function(e){var n=Object(s.__read)(e,2);return t._onMessage(n[0],n[1])})),te(e.onDisconnect).subscribe((function(){t._log.data("Disconnected from",e.sender),t._ports.delete(e),t._clientSubscriptions.get(e).unsubscribe()})))},e.prototype._handleMessage=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(s.__generator)(this,(function(r){if(this._log.data("handling message",e),e.type in this._service){if(!(t=(n=this._service)[e.type].apply(n,Object(s.__spread)(e.data))))throw new $t("Invalid return type");if(e.type.startsWith("_"))throw new $t(e.type+"is considered private");if(e.type.startsWith("on")){if(!Object(ie.a)(t))throw this._log.error("Service returned invalid return type",e.type),new $t(e.type+" must return Observable")}else if(!t.then)throw this._log.error("Service returned invalid return type",e.type),new $t(e.type+" must return Promise");return[2,t]}throw new $t("service does not implement "+e.type)}))}))},e.prototype._onMessage=function(e,t){var n=this._ports.get(t);if(!n.handleMessage(e)){var r=this._handleMessage(e);n.respond(r,e)}},e.prototype.dispose=function(){this._subscription.unsubscribe()},e}(),Dt=function(){function e(e){this._injector=e}return e.prototype.publish=function(e,t){new Ft(e,t).publish()},e.prototype.publishAll=function(){var e,t;try{for(var n=Object(s.__values)(Object.entries(Pt)),r=n.next();!r.done;r=n.next()){var i=Object(s.__read)(r.value,2);this.publish(i[0],this._injector.get(i[1]))}}catch(o){e={error:o}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.fac=function(t){return new(t||e)(o.Bb(o.m))},e.prov=o.vb({token:e,factory:e.fac,providedIn:"root"}),e}(),Mt=function(){function e(e,t,n,r){this._bgFirebaseAuth=e,this._featureRollout=t,this._bgUserAccount=n,this._servify=r}return e.prototype.install=function(){this._bgFirebaseAuth.install(),this._featureRollout.install(),this._servify.publish("userAccount",this._bgUserAccount),this._servify.publishAll()},e.fac=function(t){return new(t||e)(o.Bb(Ct),o.Bb(Tt),o.Bb(Oe),o.Bb(Dt))},e.prov=o.vb({token:e,factory:e.fac,providedIn:"root"}),e}(),Ut=function(){function e(e){this.upgrade=e}return e.prototype.ngDoBootstrap=function(){var e=document.createElement("div");document.body.appendChild(e),this.upgrade.bootstrap(e,["castifyExt.bgApp"],{strictDi:!1})},e.mod=o.xb({type:e}),e.inj=o.wb({factory:function(t){return new(t||e)(o.Bb(K.a))},providers:[{provide:Ke,useExisting:Oe},{provide:pe,useExisting:Oe}],imports:[[Y.a,K.a,Q.a,me,Le,Qe]]}),e}();a.module("cf2.background",[]).factory("cf2InAppTabService",Object(K.b)(Xe)).factory("cf2BgMessagesService",Object(K.b)(Ye)).factory("cf2RemoteYoutubeUploadService",Object(K.b)(wt)).factory("cf2ConnectedAppsService",Object(K.b)(Ve)).factory("cf2BgUsageStatsService",Object(K.b)(Ue)).factory("cf2UpgradeHelperService",Object(K.b)(Je)).factory("cf2BgCastifyDrawService",Object(K.b)(ht)).factory("cf2OnlyServices",Object(K.b)(Mt)),Object(l.b)(),u.production&&Object(o.K)(),Q.b().bootstrapModule(Ut).catch((function(e){return console.error(e)}))},EtHb:function(e,t){angular.module("castifyExt.popupInjector",["w69b.chromeTabs","w69b.spawn","w69b.promiseTool","castifyExt.deployConfig","castifyExt.appOptions"]).factory("popupInjector",["chromeTabs","$log","deployConfig","promiseTool","appOptions","spawn",function(e,t,n,r,i,o){let a={setPopup:r.wrapChromeError(chrome.browserAction.setPopup,chrome.browserAction),onClicked:{addListener:function(e){chrome.browserAction.onClicked.addListener(e)},removeListener:function(e){chrome.runtime.onClicked.removeListener(e)}}};const c="components/castifyExt/ui/inline-popup/inline-popup-content-script.js";class s{constructor(e){this._tabId=e}async load(){await this._loadContentScript()}dispose(){}onCommitted(e){e.tabId===this._tabId&&0===e.frameId&&this._loadContentScript()}onTabReplaced(e){e.replacedTabId===this._tabId&&(this._tabId=e.tabId,this._loadContentScript())}async _loadContentScript(){await e.executeScript(this._tabId,{file:c,allFrames:!1,matchAboutBlank:!0,runAt:"document_start"})}}let u=null;function l(e){t.debug("Extension icon clicked on tab",e),u&&u.dispose(),u=new s(e.id),u.load().catch(e=>t.error("injecting popup ui failed",e))}let d={};return d.install=o.wrap((function*(){n.enableInlinePopupSupport?(yield i.loadedPromise,i.values.enableInlinePopupUi?(a.setPopup({popup:""}),t.debug("inline popup ui enabled"),a.onClicked.addListener(l)):t.debug("inline popup ui disabled")):t.debug("built with inline popup ui support disabled")})),d}])},"G+hJ":function(e,t){angular.module("w69b.uuid",[]).factory("uuid",["$window",function(e){function t(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t}return function(){var n=new Uint16Array(8);return e.crypto.getRandomValues(n),t(n[0])+t(n[1])+"-"+t(n[2])+"-4"+t(n[3]).substring(1)+"-y"+t(n[4]).substring(1)+"-"+t(n[5])+t(n[6])+t(n[7])}}])},"H+pR":function(e,t){angular.module("w69b.ngProgressHttp",[]).service("$progressHttp",["$http","$q",function(e,t){return function(n){var r;n.headers=n.headers||{},n.method=n.method||"POST";var i=t.defer();n.headers.__setXHR__=function e(){return function(t){if(!t)return e();r=t,n.progressEvents&&"download"!==n.progressEvents||(r.addEventListener("progress",(function(e){i.notify({type:"download",event:e})}),!1),r.addEventListener("load",(function(e){e.lengthComputable&&i.notify({type:"download",event:e})}),!1)),n.progressEvents&&"upload"!==n.progressEvents||(r.upload.addEventListener("progress",(function(e){i.notify({type:"upload",event:e})}),!1),r.upload.addEventListener("load",(function(e){e.lengthComputable&&i.notify({type:"upload",event:e})}),!1))}},e(n).then(i.resolve.bind(i),i.reject.bind(i),i.notify.bind(i));var o=i.promise;return o.abort=function(){return r&&r.abort(),o},o}}]).config((function(){var e;window.XMLHttpRequest=(e=window.XMLHttpRequest,function(){var t,n=new e;return n.setRequestHeader=(t=n.setRequestHeader,function(e,r){"__setXHR__"===e?r(n):t.apply(n,arguments)}),n})}))},HRCS:function(e,t){angular.module("w69b.chromeAnalytics",[]).provider("analytics",(function(){var e,t;this.setTrackingId=function(t){e=t},this.setApp=function(e,n){t=arguments},this.$get=["$window",function(n){if(!t)throw new Error("make sure to call analyticsProvider.setApp()");if(!n.analytics)throw new Error("chrome-analytics lib not loaded");var r=n.analytics,i=r.getService.apply(r,t),o=i.getTracker(e),a={};return a.tracker=o,a.eventBuilder=function(){return r.EventBuilder.builder()},a.setEnabled=function(e){i.getConfig().addCallback((function(t){t.setTrackingPermitted(e)}))},a.send=function(){o.send.apply(o,arguments)},a.trackPageView=function(e){o.sendAppView(e)},a.trackEvent=function(){o.sendEvent.apply(o,arguments)},a.sendNonInteractionEvent=function(e,t,n,i){a.send(r.HitTypes.EVENT,{eventCategory:e,eventAction:t,eventLabel:n,eventValue:i,nonInteraction:!0})},a.trackTimer=function(e,t,n){var r,i={start:function(){return r=(new Date).getTime(),i},send:function(a,c,s){var u=(new Date).getTime();return o.sendTiming(a||e,c||t,u-r,s||n),i}};return i.start(),i},a}]}))},"Ie/p":function(e,t){angular.module("w69b.chromeTabs",["w69b.promiseTool"]).factory("chromeTabs",["$window","promiseTool","$q",function(e,t,n){if(!e.chrome||!e.chrome.tabs)return null;var r=e.chrome,i={};return i.query=t.wrapChromeError(r.tabs.query,r.tabs),i.getActiveTab=function(){return i.query({active:!0,windowId:r.windows.WINDOW_ID_CURRENT}).then((function(e){return e.length?e[0]:n.reject()}))},i.get=t.wrapChromeError(r.tabs.get,r.tabs),i.update=t.wrapChromeError(r.tabs.update,r.tabs),i.remove=t.wrapChromeError(r.tabs.remove,r.tabs),i.create=t.wrapChromeError(r.tabs.create,r.tabs),i.connect=r.tabs.connect.bind(r.tabs),i.setZoomSettings=t.wrapChromeError(r.tabs.setZoomSettings,r.tabs),i.setZoom=t.wrapChromeError(r.tabs.setZoom,r.tabs),i.executeScript=t.wrapChromeError(r.tabs.executeScript,r.tabs),i.insertCSS=t.wrapChromeError(r.tabs.insertCSS,r.tabs),i.sendMessage=t.wrapChromeError(r.tabs.sendMessage,r.tabs),i.onUpdated=r.tabs.onUpdated,i.onActivated=r.tabs.onActivated,i.sendMessageActive=function(e,t){return i.getActiveTab().then((function(n){return i.sendMessage(n.id,e,t)}))},i}]).directive("newTab",["chromeTabs",function(e){return{restrict:"A",link:function(t,n,r){n.bind("click",(function(t){t.preventDefault(),e.create({url:r.href}).then((function(e){chrome.windows.update(e.windowId,{focused:!0},angular.noop)}))}))}}}])},IiHr:function(e,t){angular.module("w69b.chromeWindows",[]).factory("chromeWindows",["promiseTool",function(e){var t={};return t.get=e.wrapChromeError(chrome.windows.get,chrome.windows),t.create=e.wrapChromeError(chrome.windows.create,chrome.windows),t.update=e.wrapChromeError(chrome.windows.update,chrome.windows),t.getCurrent=e.wrapChromeError(chrome.windows.getCurrent,chrome.windows),t.remove=e.wrapChromeError(chrome.windows.remove,chrome.windows),t.onRemoved=chrome.windows.onRemoved,t}])},IkP3:function(e,t){angular.module("castifyExt.bgSyncDownloader",["castifyExt.bgFiles","w69b.filesHelper","w69b.chromeRuntime","castifyExt.simplePortService","w69b.spawn"]).factory("fetchTool",["spawn","castifyAuth","filesHelper","$q",function(e,t,n,r){function i(e,t){return new Promise((function(n,r){e.onwriteend=n,e.onerror=r,e.write(t)}))}return{downloadUrlToFile:function(o,a){var c,s={},u=!1;return s.path=a,s.cancel=function(){c&&c.cancel(),u=!0},s.done=r.when(e((function*(){var e=new Request(o);yield function(e){return t.getAuthToken({interactive:!1}).then((function(t){e.headers.append("Authorization","Bearer "+t)}))}(e);var r=yield n.getFileEntryByPath(a,{create:!0}),l=yield n.getMetadata(r);e.headers.append("range",`bytes = ${l.size} -`);var d=yield fetch(e,{mode:"cors"});if(!d.ok)throw new Error("fetch failed");if(!u){c=d.body.getReader();var f=yield c.read();try{s.bytesLoaded=l.size;for(var p=yield n.createWriter(r);!f.done;)yield i(p,new Blob([f.value])),s.bytesLoaded+=f.value.length,f=yield c.read()}catch(h){throw c.cancel(),h}}}),!0)),s}}}]).factory("bgSyncDownloader",["bgFiles","spawn","castifyAuth","$window","filesHelper","fetchTool","$log","$q","simplePortService",function(e,t,n,r,i,o,a,c,s){var u,l={},d=new Map,f=s("syncDownloader");function p(){var e={};for(var t of d.entries())e[t[0]]={progress:t[1].progress};f.postMessage("downloads",e)}return l.getDownload=function(e){return d.get(e)},l.startDownload=function(n){var r=d.get(n);return r||(a.debug(`bgSyncDownloader.startDownload(${n})`),r=function(n){var r,c,s=!1,l={get bytesLoaded(){return r?r.bytesLoaded:0},get progress(){return c&&c.size?l.bytesLoaded/c.size:0},cancel:function(){r&&r.cancel(),s=!0}};return l.done=t((function*(){if(yield u,c=yield e.getFileDescriptor(n),!s){var t="_dl/"+c.id;r=o.downloadUrlToFile(c.url,t),yield r.done,yield i.moveFileByPath(t,e.idToLocalFilename(c.id)),yield e.registerLocalFile(c.id)}})),l.done.catch((function(e){a.warn("bgSyncDownloader: download failed",e)})),l}(n),d.set(n,r),p(),r.done.finally((function(){d.delete(n),p()}))),r},l.install=function(){u=t((function*(){yield i.getDirByPath("_dl",{create:!0});var e=yield i.listByPath("_dl"),t=[];for(var n of e)t.push(i.remove(n));yield c.all(t)})).catch((function(e){a.error("bgSyncDownloader.cleanup failed",e)})),f.install()},f.handlers.update=function(){p()},l}])},J404:function(e,t){angular.module("w69b.logging",[]).provider("$log",(function(){var e=!0,t=this,n=!1;this.debugEnabled=function(t){return angular.isDefined(t)?(e=t,this):e},this.setCustomHook=function(e){n=e},this.$get=["$window",function(r){function i(e){return e instanceof Error&&(e.stack?e=e.message&&-1===e.stack.indexOf(e.message)?"Error: "+e.message+"\n"+e.stack:e.stack:e.sourceURL&&(e=e.message+"\n"+e.sourceURL+":"+e.line)),e}function o(e){var t=r.console||{},o=t[e]||t.log||angular.noop,a=!1;try{a=!!o.apply}catch(c){}return a?function(){var r=[];if(angular.forEach(arguments,(function(e){r.push(i(e))})),n&&n(e,r))return o.apply(t,r)}:function(t,r){n&&n(e,[t,r])&&o(t,null===r?"":r)}}return{log:o("log"),info:o("info"),warn:o("warn"),error:o("error"),debug:(a=o("debug"),function(){e&&a.apply(t,arguments)})};var a}]}))},JYpz:function(e,t){angular.module("castifyExt.bgSyncManager",["castifyExt.appOptions","castifyExt.bgUpload","w69b.chromeRuntime","castifyExt.driveFileWatcher","w69b.googledrive","castifyExt.localFileDb","castifyExt.chromeEventPublisher","castifyExt.bgFiles","w69b.spawn","castifyExt.bgSyncDownloader"]).factory("bgSyncManager",["$rootScope","appOptions","bgUploadService","localFileDb","googledrive","$q","driveFileWatcher","$log","bgFiles","spawn","bgSyncDownloader",function(e,t,n,r,i,o,a,c,s,u,l){var d={},f=new Map,p=18e5,h=new Set,g=72e5;function m(e,t){if(t.config.isSyncUpload){var n=t.config,u=t.data.id;c.debug("bgSyncManager: sync upload of file %s complete, driveId %s",n.fileId,u),r.getFileDescriptor(n.fileId).then((function(e){if(e.title!==n.title){var t=e.title;return c.debug("bgSyncManager: title changed, applying post-upload changes"),/\.webm/i.test(t)||(t+=".webm"),i.patchFile(u,{title:t})}return o.when()})).catch((function(e){c.warn("bgSyncManager: sync upload hook failed",e)})).then((function(){s.refresh(n.fileId),a.watchFile(u)}))}}function b(e){return r.listFiles().then((function(t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];if(r.driveInfo&&r.driveInfo.id===e)return r}return o.reject()}))}function v(e,t=!0){return r.getFileDescriptor(e).then((function(e){return e.remove().then((function(){if(c.debug("bgSyncManager: removed local file",e.id),t)return s.refresh(e.id)}))}),angular.identity)}function y(e,n){t.values.driveSync&&u((function*(){for(let t of n.removed){c.debug("bgSyncManager: drive file %s remove detected, removing local file",t);try{let e=yield b(t);yield v(e.id,!1)}catch(e){c.warn("bgSyncManager: failed to handle drive removal of file",t,e)}}n.removed.length&&s.clearCache();for(let t of n.processed){c.debug("bgSyncManager: drive file %s processed",t);try{let e=yield b(t);yield E(e.id)}catch(e){c.warn("bgSyncManager: failed to handle processed event for file",t,e)}}})).catch(e=>{c.warn("bgSyncManager: handling driveWatcher update failed",e)})}function w(e,t){E(t)}function _(){return t.values.driveSync}function S(){return u((function*(){for(let t of Object.keys(yield r.listFiles())){var e=yield s.getFileDescriptor(t);if(!e.isSynced&&!e.autoShare)return!1}return!0}))}function E(e){u((function*(){var t=yield s.getFileDescriptor(e);if(_()){t.isSynced||t.autoShare||function(e){c.debug("bgSyncManager: starting sync upload",e.id),n.upload({fileId:e.id,target:"drive",privacy:"private",title:e.title,isSyncUpload:!0,uploader:"drive"})}(t),function(e){var t=f.get(e.id),n=e.isSynced&&!!e.driveInfo.thumbnailLink,r=e.isSynced&&new Date(e.driveInfo.createdDate)<Date.now()-g,i=t&&(t.downloadPending||t.timestamp+p>=Date.now());return e.isLocal&&(n||r)&&!i}(t)&&((yield S())?v(t.id):h.add(t.id));var r=f.get(t.id);r&&!r.isDone&&(t.isLocal?r.deferred.resolve():function(e){var t=f.get(e.id);if(t&&!t.downloadPending){var n=l.startDownload(e.id);t.downloadPending=!0,n.done.then(t.deferred.resolve.bind(t.deferred),t.deferred.reject.bind(t.deferred)),n.done.finally((function(){t.downloadPending=!1,t.timestamp=Date.now()}))}}(t))}t.autoShare&&function(e){var t=e.autoShare;return t&&t.timestamp+p<Date.now()}(t)&&v(t.id)})).catch((function(t){c.error(`bgSyncManager.syncFile(${e}) failed : `,t)}))}function C(e,t){t||n.cancelAllUploads(!0),d.syncFiles()}function I(){for(let e of h)E(e)}d.syncFiles=function(){u((function*(){var e=new Set;for(let t of Object.keys(yield r.listFiles()))e.add(t);for(let t of f.keys())e.add(t);for(let t of e)E(t)}))};var A=u.wrap((function*(){if(_()){c.info("Removing synced files before account change.");var e=[];angular.forEach(yield r.listFiles(),(function(t){t.driveInfo&&e.push(v(t.id))})),yield o.all(e)}}));function O(){a.clear(),h.clear(),A().finally((function(){d.syncFiles()}))}function j(e,r){t.values.driveSync&&n.cancel({target:"drive",fileId:r})}return d.requestSyncLocal=function(e){if(!_())return o.when();var t=f.get(e)||function(e,t){e={id:t,deferred:o.defer(),isDone:!1},f.set(t,e);var n=e.deferred.promise;return n.then((function(){e.isDone=!0})),n.catch((function(){f.delete(t)})),e}(t,e);return t.timestamp=Date.now(),E(e),t.deferred.promise},d.storeAutoSharedFile=u.wrap((function*(e){var t=yield s.getFileDescriptor(e);yield s.updateLocalInfo(e,{autoShare:null}),t.autoShare=null,E(e)})),d.syncFile=E,d.areAllLocalFilesSynced=S,d.install=u.wrap((function*(){e.$on("uploader:complete",m),e.$on("driveFileWatcher:update",y),e.$on("bgFiles:localFileCreated",w),e.$on("bgFiles:fileRemoved",j),e.$on("bgFiles:syncSettingChanged",C),e.$on("bgSyncStatus:syncComplete",I),e.$on("event:signInChanged",O),yield t.loadedPromise,d.syncFiles()})),d}])},KGdM:function(e,t){angular.module("w69b.chromeSystem",["w69b.promiseTool"]).factory("chromeSystem",["promiseTool",function(e){var t=window.chrome&&window.chrome.system,n={};return t?(t.cpu&&(n.cpu={getInfo:e.wrapChromeError(t.cpu.getInfo,t.cpu)}),t.memory&&(n.memory={getInfo:e.wrapChromeError(t.memory.getInfo,t.memory)}),n):n}])},LHv7:function(e,t){angular.module("castifyExt.setupService",["castifyExt.appOptions","w69b.webrtc","cf2.chromeStorageService","w69b.spawn","cf2.connectedAppsService","cf2.userAccount","castifyExt.castifyAuth","castifyExt.optionalPermissions"]).factory("setupService",["webrtc","spawn","cf2ChromeStorageService","appOptions","$log","optionalPermissions","userAccount","$http","castifyConfig","cf2ConnectedAppsService","castifyAuth",function(e,t,n,r,i,o,a,c,s,u,l){var d={};const f=s.API_URL+"/survey_questions";return d.setSetupComplete=function(e=!0){return n.sync.setSingle("setupService:welcomeShown",e)},d.getSetupComplete=function(){return n.sync.getSingle("setupService:welcomeShown",!1)},d.getDriveSyncEnabled=t.wrap((function*(){return yield r.loadedPromise,r.values.driveSync})),d.getSetupState=function(){return t((function*(){let[n,r,i,c,s,u]=yield Promise.all([a.getAccount(),l.getAuthToken().catch(()=>!1),o.hasLiteTabPermissions(),t((function*(){var t=e.hasVideoAccess(),n=e.hasMicrophone(),r=e.hasAudioAccess();return(yield t)||!(yield n)||(yield r)})),d.getDriveSyncEnabled(),d.getSetupComplete()]);return{tab:i,cam:c,signedIn:!(!n.user||!r),filledSurvey:!!n.user&&!!n.user.survey&&!!n.user.survey.user_type,driveSync:s,setupComplete:u}}))},d.isComplete=function(){return t((function*(){var[e,t,n]=yield Promise.all([d.getSetupState(),u.hasConnectedApps(),d.getSetupComplete()]);return i.debug("setupService.isComplete state",e,t),e.signedIn||t||e.tab||n}))},d.postSurvey=function(e){return a.postUpdate({survey:e})},d.fetchSurveyQuestions=function(){return c.get(f).then(e=>e.data)},d.updateStorage=function(e){r.values.driveSync=e,r.save()},d}])},MWHJ:function(e,t){angular.module("castifyExt.oauthTokenCache",["cf2.chromeStorageService"]).factory("oauthTokenCache",["cf2ChromeStorageService","$q",function(e,t){return function(n){var r=0,i={};function o(){return e.local.getSingle(n).then((function(e){return e||{}}))}function a(){return Math.floor(Date.now()-r)+12e4}return i.get=function(e){return o().then((function(n){var r=n[e];return r&&r.expiresAt>a()?t.when(r):t.reject()}))},i.put=function(t,i){return o().then((function(o){return o[t]=i,i.issuedAt&&(r=Date.now()-Number(i.issuedAt)),function(e){var t=a();angular.forEach(e,(function(n,r){(!r.expiresAt||r.expiresAt<=t)&&delete e[n]}))}(o),e.local.setSingle(n,o)}))},i.removeByToken=function(t){return o().then((function(r){return angular.forEach(r,(function(e,n){e.accessToken===t&&delete r[n]})),e.local.setSingle(n,r)}))},i.remove=function(t){return o().then((function(r){return delete r[t],e.local.setSingle(n,r)}))},i.clear=function(){return e.local.remove(n)},i.withCache=function(e,t){return i.get(e).catch((function(){return t().then((function(t){return i.put(e,t).then((function(){return t}))}))}))},i}}])},NkpF:function(e,t){angular.module("castifyExt.bgRecordingErrorHandler",["castifyExt.appOptions","castifyExt.recordTool","cf2.chromeStorageService","w69b.spawn"]).factory("bgRecordingErrorHandler",["$rootScope","appOptions","$log","cf2ChromeStorageService","chromeNotifications","recordTool","spawn",function(e,t,n,r,i,o,a){let c={};const s="settingsChangedNotifier";function u(e){r.local.setSingle(s,e)}const l=a.wrap((function*(){if(t.values.hwEncoding){n.info("bgRecordingErrorHandler: disabling hw encoding after a incomplete recording"),t.values.hwEncoding=!1,t.save();let e=yield o.getRecordConfig();"mp4"===e.exportFormat?(e.exportFormat=o.getRecordConfigDefaults().exportFormat,delete e.nonpersistent,yield o.setRecordConfig(e),u("hw_encoding_mp4_disabled")):u("hw_encoding_disabled")}}));function d(){t.values.hwEncoding=!0,t.save(),u("hw_encoding_enabled")}function f(){t.values.hwEncoding||(n.info("bgRecordingErrorHandler: enabling hw encoding after nacl crash"),d(),i.simple.create({priority:2,title:"Opps, recording ended",message:"We've changed the encoder to prevent this from happening again"}))}function p(){t.hwEncoding||(d(),i.simple.create({priority:1,title:"Oops, ran out of memory",message:"Try to close some tabs/apps an try recording again."}))}return c.install=function(){e.$on("recorder:incomplete_recording_found",l),e.$on("recorder:encoder_crash",f),e.$on("recorder:out_of_memory",p)},c}])},NqIN:function(e,t){angular.module("w69b.asyncResponse",[]).factory("asyncResponse",["$q",function(e){return{createSender:function(t){var n={},r=0,i={};return n.sendWithResponse=function(n,o){var a=++r,c=e.defer();return i[a]=c,t({type:n,data:o,msgId:a}),c.promise},n.send=function(e,n){t({type:e,data:n})},n.handleResult=function(e){if(e&&"result"===e.type){var t=i[e.msgId];return delete i[e.msgId],e.hasOwnProperty("error")||e.isError?t.reject(e.error):t.resolve(e.data),!0}return!1},n},createRespond:function(t){return function(n,r){e.when(n).then((function(e){t({type:"result",msgId:r.msgId,data:e})}),(function(e){t({type:"result",msgId:r.msgId,error:e,isError:!0})}))}}}}])},PdQI:function(e,t){angular.module("castifyExt.connect.appRecorder",["castifyExt.bgRecord","castifyExt.recordTool","w69b.spawn"]).factory("appRecorder",["bgRecordService","recordTool","$q","$rootScope","spawn",function(e,t,n,r,i){return function(o){var a=n.defer(),c={};c.appId=o.id,c.ended=a.promise;var s=null;function u(){a.resolve()}function l(e,t,n){return angular.isNumber(e)&&e>=t&&e<=n}var d,f=i.wrap((function*(n){!function(e){e.recordConfig=e.recordConfig||{};var t,n=e.recordConfig;if(!angular.isObject(n))throw new Error("invalid recordConfig");if(n.audio=n.audio||{},!angular.isObject(n.audio))throw new Error("invalid recordConfig.audio");if(n.captureSource=n.captureSource||"desktop",!["desktop","screen","tab","tab_picker"].includes(n.captureSource))throw new Error("invalid captureSource");if(n.maxResolution=n.maxResolution||null,n.maxResolution){if(t=n.maxResolution,!(angular.isObject(t)&&l(t.width,64,4096)&&l(t.height,64,4096)))throw new Error("invalid maxResolution");n.maxResolution={width:n.maxResolution.width,height:n.maxResolution.height}}if(n.maxFps=n.maxFps||null,n.maxFps&&!l(n.maxFps,1,60))throw new Error("invalid maxFps");if(n.startDelay=n.startDelay||0,n.audibleCountdown=!angular.isDefined(n.audibleCountdown)||!!n.audibleCountdown,n.visualCountdown=!angular.isDefined(n.visualCountdown)||!!n.visualCountdown,n.embedWebcam=!!n.embedWebcam,n.startDelay&&!l(n.startDelay,0,10))throw new Error("invalid startDelay");if(!e.shareUrl&&!o.shareUrl)throw new Error("shareUrl required");if(e.shareUrl&&!/https?:\/\//.test(e.shareUrl))throw new Error("invalid shareUrl")}(n=n||{});let r=n.recordConfig;var i=t.canCaptureSystemAudio(),a=n.payload,c=yield t.getRecordConfig(),s={};if(["tab","tab_picker"].includes(r.captureSource)&&(i=!0),["tab","desktop","tab_picker"].includes(r.captureSource)&&angular.isObject(r.draw)){var u=r.draw;s.draw={showToolbox:!!u.showToolbox},[null,"pointer"].includes(u.tool)&&(s.draw.tool=u.tool)}return angular.extend(s,{captureSource:r.captureSource,tabId:n.tabId,startDelay:r.startDelay,audibleCountdown:r.audibleCountdown,visualCountdown:r.visualCountdown,targetFPS:r.maxFps,exportFormat:r.exportFormat,maxResolution:r.maxResolution,limitResolution:!0,audio:{mic:!!r.audio.mic,micSourceId:r.audio.micSourceId||c.audio.micSourceId,system:i&&r.audio.system},autoShareApp:{id:o.id},connectMeta:{appId:o.id,shareUrl:n.shareUrl,payload:a}}),o.isWhitelisted&&angular.extend(s,{embedWebcam:r.embedWebcam,camPosition:r.camPosition||"bottomRight",camSourceId:r.camSourceId||c.camSourceId}),e.start(s)}));return c.start=function(e){var t=n.when(f(e));s=t.finally((function(){s=null})),t.catch(u);var i=r.$on("recorder:stopped",(function(){u(),i()}));return t},c.pause=function(){return e.pause()},c.resume=function(){return e.resume()},c.restart=function(){return e.restart()},c.stop=function(){return e.stop()},c.getState=function(){return e.getRecorderState().state},c.getTime=function(){return e.getRecorderState().time},c.cancelPendingStart=function(){if(s&&e.cancelPendingStart()){var t=s.then((function(){return!1}),(function(){return!0}));return s=null,t}return n.when(!1)},(d=[]).push(r.$watch(c.getState,(function(e,t){e!==t&&c.onStateChanged&&c.onStateChanged(e)}))),d.push(r.$watch(c.getTime,(function(e,t){e!==t&&c.onTimeChanged&&c.onTimeChanged(e)}))),c.ended.then((function(){d.forEach((function(e){e()}))})),c}}])},QP76:function(e,t){angular.module("castifyExt.chromeEventPublisher",[]).run(["chromeRuntime","$rootScope",function(e,t){e.onMessage.addListener((function(e){angular.isObject(e)&&angular.isString(e.type)&&0===e.type.lastIndexOf("event:",0)&&t.$broadcast(e.type,e.data),t.$$phase||t.$digest()}))}])},RnoO:function(e,t){angular.module("w69b.filereader",[]).factory("filereader",["$q",function(e){return{readAsArrayBuffer:function(t,n,r){let i=e.defer(),o=t;(n||r)&&(o=t.slice(n,r));let a=new FileReader;return a.onloadend=function(){a.onloadend=null,a.error?i.reject(a.error):i.resolve(a.result)},a.readAsArrayBuffer(o),i.promise},readAsText:function(t){let n=e.defer(),r=new FileReader;return r.onload=()=>{r.error?n.reject(r.error):n.resolve(r.result)},r.readAsText(t),n.promise}}}])},Ryvw:function(e,t){angular.module("castifyExt.offline",[]).factory("onlineState",["$rootScope","$window","$http","$timeout","$log",function(e,t,n,r,i){var o="https://api.screencastify.com/images/cleardot.gif?",a=1e4,c=1e4,s={},u=null,l=!0,d=null,f=!1;function p(){if(u)return u;var e=Math.random().toString(36).substr(2,36);return(u=n.get(o+e,{responseType:"arraybuffer",timeout:a}).then((function(){return u=null,i.debug("checkNetwork result is online"),!0}),(function(){return i.debug("checkNetwork result is offline"),u=null,!1}))).then(h),u}function h(t){l!==t&&(i.debug("verified network state is ",t),l=t,e.$broadcast("onlineState:changed",t)),!t&&s.isNavigatorOnline()&&function(e){function t(){return(d=r(angular.noop,c)).then(n)}function n(){return p().then((function(e){if(!e&&s.isNavigatorOnline()&&f)return t()}))}f||(f=!0,t().finally((function(){f=!1})))}()}return s.check=function(){return p()},s.isOnline=function(){return l},s.isNavigatorOnline=function(){return!1!==t.navigator.onLine},t.addEventListener("online",(function(){s.check()})),t.addEventListener("offline",(function(){h(!1),r.cancel(d),f=!1})),s}])},Sewt:function(e,t){angular.module("castifyEdit.fixWebmJob",["w69b.asyncResponse","w69b.spawn","w69b.filesHelper"]).factory("startFixWebmJob",["asyncResponse","spawn","filesHelper","$q",function(e,t,n,r){var i,o="_tmp/edited.webm";function a(e){this.config=e,this.progress=0}var c=a.prototype;return c.start=function(){return this.promise=this._doStart(),this.promise},c._doStart=t.wrap((function*(){var t=this.config;i=new Worker("/components/castifyMediawriter/dist/mediawriter.worker.min.js"),this._cancelDeferred=r.defer(),yield n.getDirByPath("_tmp",{create:!0});var a=e.createSender(e=>i.postMessage(e));i.addEventListener("message",(function(e){var t=e.data;a.handleResult(t)||"progress"===t.type&&(this.progress=t.data)}).bind(this)),a.send("init",{path:o,fsType:"PERSISTENT"});let c=!1,s=a.sendWithResponse("readChromeFile",{path:t.inPath,fsType:"PERSISTENT"});return yield r.race([this._cancelDeferred.promise.then(()=>c=!0),s]),i.terminate(),i=null,this._cancelDeferred=null,c||(yield n.moveFileByPath(o,t.outPath),yield n.removeByPath(t.inPath)),{fileId:this.config.fileId,isFixJob:!0}})),c.cancel=t.wrap((function*(){if(!i||!this._cancelDeferred)return!1;i.terminate();let e=this.config;return yield n.removeByPath(o).catch(()=>null),yield n.moveFileByPath(e.inPath,e.outPath),this._cancelDeferred.resolve(),!0})),c.getProgress=function(){return this.progress},function(e){var t=new a(e);return t.start(),Promise.resolve(t)}}])},U5Ke:function(e,t){angular.module("castifyExt.upload.uploadBase",["castifyExt.bgFiles","w69b.filesHelper"]).factory("UploadBase",["$q","$log","bgFiles","filesHelper",function(e,t,n,r){function i(e){this.config=e,this.minStartTime=0,this.numErrors=0}i.uploaderClasses_={},i.register_=function(e,t){i.uploaderClasses_[e]=t},i.create=function(e){e.uploader=e.uploader||e.target;var t=i.uploaderClasses_[e.uploader];if(!t)throw new Error("unknown uploader type"+e.uploader);return new t(e)},i.CancelledError={reason:"cancelled",isCancelled:!0};var o=i.prototype;return i.unserialize=function(e){var t=e[0],n=e[1],r=i.uploaderClasses_[t];if(!r)throw new Error("unknown uploader type "+t);return r.fromObject(n)},o.serialize=function(){return[this.config.uploader,this.toObject()]},o.fromObject=function(e){throw new Error},o.toObject=function(){throw new Error},o.start=function(){},o.cancel=function(){return!1},o.pause=function(){return this.cancel()},o.onProgress=function(){},o.onComplete=function(){},o.onError=function(e){},o.handleComplete_=function(e){t.debug("upload complete",e),this.responseData=e},o.handleError_=function(t){return e.reject(t)},o.handleProgress_=function(e){return e},o.loadFile_=function(){var t=this.config,o=r.getFileByPath(n.idToLocalFilename(t.fileId));return e.all({file:o,fileDesc:n.getFileDescriptor(t.fileId)}).catch((function(n){return e.reject(t.isSyncUpload?i.CancelledError:n)}))},o.toString=function(){var e=this.config;return"Upload of file "+e.fileId+" to "+e.uploader},i}])},UmrE:function(e,t){angular.module("castifyExt.syncAuthTool",["castifyExt.castifyAuth","w69b.chromeRuntime","castifyExt.appOptions","castifyExt.driveUtils","w69b.spawn"]).factory("syncAuthTool",["castifyAuth","spawn","$q","$log","appOptions","chromeRuntime","$rootScope","driveUtils",function(e,t,n,r,i,o,a,c){var s={};return s.broadcastIfSyncError=t.wrap((function*(e){return"not_signed_in"===e?(r.debug("syncAuthTool: sync enabled but not signed in"),a.$broadcast("event:syncAuthError"),o.sendMessage({type:"event:syncAuthError"}).catch(angular.identity),n.reject(e)):(i.values.driveSync&&s.checkSetup().catch((function(t){switch(t){case"token":r.debug("syncAuthTool: sync enabled but we do not have a valid token"),a.$broadcast("event:syncAuthError"),o.sendMessage({type:"event:syncAuthError"}).catch(angular.identity);break;case"forbidden":r.debug("syncAuthTool: detected drive-forbidden error",e),a.$broadcast("event:syncForbiddenError");break;default:r.warn("syncAuthTool: unhandled sync error detected",e)}})),n.reject(e))})),s.hasValidAuthToken=function(){return e.getAuthToken({interactive:!1,validate:!0})},s.isRateLimitError=function(e){return c.isRateLimitError(e)},s.checkSetup=function(){return s.hasValidAuthToken().catch((function(){return n.reject("token")})).then((function(){return c.getDriveUploadParentId().catch((function(e){return c.isGoogleAppsForbiddenError(e)?n.reject("forbidden"):n.reject("unknown")}))})).then((function(){return!0}))},s}])},V0Mt:function(e,t){angular.module("castifyExt.upload.googleUpload",["castifyExt.upload.uploadBase","castifyExt.driveUtils","w69b.googledrive","w69b.googleUploader","castifyExt.bgFiles","w69b.spawn","w69b.chromeAnalytics"]).run(["UploadBase","driveUtils","googledrive","googleUploader","bgFiles","$q","$log","spawn","analytics",function(e,t,n,r,i,o,a,c,s){function u(e){if(angular.isObject(e)&&angular.isNumber(e.status)){var t=e.status;if(t<=0||t>=500&&t<600||e.config&&!1===e.config.authAutoRetry&&401===t)return!0;var n=l.getErrorReason(e);if(["userRateLimitExceeded"].includes(n))return!0}return!1}function l(t,n){e.call(this,t),this.uploadUrl=n,this.cancelled=!1}(l.prototype=Object.create(e.prototype)).constructor=e;var d=l.prototype;function f(){l.apply(this,arguments)}d.handleProgress_=function(e){e.uploadUrl?this.uploadUrl=e.uploadUrl:(this.loadedBytes_=e.loaded,this.progress=e.loaded/e.total)},d.handleError_=function(t){return t===e.CancelledError||this.cancelled?o.reject(e.CancelledError):(a.debug("googleUploader: handling error",t),o.reject({isTransient:u(t),reason:l.getErrorReason(t)}))},d.resumeUpload_=function(e){return this.uploader_=r.resumeUpload(e,this.uploadUrl),this.uploader_.promise},d.start=function(){this.cancelled=!1;var t=this;this.loadFile_().then((function(n){return t.totalBytes_=n.file.size,t.cancelled?o.reject(e.CancelledError):t.uploadUrl?t.resumeUpload_(n.file,n.fileDesc):t.startUpload_(n.file,n.fileDesc)})).then(this.handleComplete_.bind(this),this.handleError_.bind(this),this.handleProgress_.bind(this)).then((function(e){t.onComplete(e)}),(function(e){t.onError(e)}),(function(e){t.onProgress(e)}))},l.getErrorReason=function(e){return angular.isString(e)?e:e&&e.message?e.message:"unknown"},d.toObject=function(){return{config:this.config,uploadUrl:this.uploadUrl}},d.cancel=function(){return!!this.cancelled||(this.loadedBytes_&&this.totalBytes_-this.loadedBytes_<512e3?(a.debug("googleUploader: refusing to cancel almost complete upload"),!1):(this.cancelled=!0,this.uploader_&&this.uploader_.cancel(),!0))},(f.prototype=Object.create(l.prototype)).constructor=l,e.register_("drive",f),(d=f.prototype).trackAnalytics_=function(){if(!this.startTime)return;let e=Date.now()-this.startTime;const t=e/1e3;s.tracker.sendTiming("drive_upload","speed_seconds_per_second",Math.round(this.fileDuration/t*1e3)),s.tracker.sendTiming("drive_upload","duration_second",Math.round(e)),s.tracker.sendTiming("drive_upload","speed_bytes_per_second",Math.round(this.fileSize/t*1e3))},d.handleComplete_=c.wrap((function*(e){l.prototype.handleComplete_.call(this,e),this.trackAnalytics_(),this.openLink=e.alternateLink,yield this.setDrivePrivacy(this.config.privacy,!0),yield i.updateLocalInfo(this.config.fileId,{driveInfo:e})})),f.doesFileExistInParent=function(e,t){return n.getFile(e).then((function(e){return e.parents&&e.parents.some((function(e){return e.id===t}))&&(!e.labels||!e.labels.trashed)}),(function(e){return 404!=e.status&&o.reject(e)}))},d.startUpload_=function(a,c){var s,u=this.config,l=this,d=u.title;/\.webm$/i.test(d)||(d+=".webm");var p={duration:c.duration,width:c.width,height:c.height,uuid:c.id,recordingDate:c.createdAt.getTime(),isScreencastifySyncFile:!0};function h(){return l.cancelled?o.reject(e.CancelledError):(l.startTime=Date.now(),l.fileDuration=1e3*c.duration,l.fileSize=c.size,r.generateId().then(e=>{const t={id:e,title:d,description:u.description||"",mimeType:"video/webm",properties:f.toDrivePropertyList_(p),parents:[{id:s}]};return i.updateLocalInfo(c.id,{driveFileId:e,tmpDrivePrivacy:"private"}),l.uploader_=r.driveUpload(a,t),l.uploader_.promise}))}return t.getDriveUploadParentId().then((function(t){if(l.cancelled)return o.reject(e.CancelledError);if(s=t,c.driveInfo&&c.driveInfo.id){var r=c.driveInfo.id;return f.doesFileExistInParent(r,s).then((function(t){return t?function(t){return l.cancelled?o.reject(e.CancelledError):n.patchFile(t,{properties:f.toDrivePropertyList_(p)})}(r):h()}))}return h()}))},d.setDrivePrivacy=function(n,r){if(this.cancelled)return o.reject(e.CancelledError);const a=i.getFileDescriptor(this.config.fileId).then(e=>{if(r)return t.setSimplePrivacy(e.driveFileId,n,this.config.domain);this.config.privacy=n,i.updateLocalInfo(this.config.fileId,{tmpDrivePrivacy:n})});return o.when(a)},f.toDrivePropertyList_=function(e){var t=[];return angular.forEach(e,(function(e,n){t.push({key:n,value:e,visibility:"PRIVATE"})})),t},d.toObject=function(){return{config:this.config,uploadUrl:this.uploadUrl}},f.fromObject=function(e){return new f(e.config,e.uploadUrl)}}])},WNYX:function(e,t){angular.module("w69b.chromePermissions",["w69b.promiseTool"]).factory("chromePermissions",["promiseTool",function(e){var t=window.chrome&&window.chrome.permissions,n={};return t?(n.contains=e.wrapChromeError(t.contains,t),n.request=e.wrapChromeError(t.request,t),n.remove=e.wrapChromeError(t.remove,t),n.getAll=e.wrapChromeError(t.getAll,t),n):n}])},XRbf:function(e,t){angular.module("w69b.chromePersistentLogger",["cf2.chromeStorageService","w69b.logging","w69b.structs.CircularBuffer"]).provider("chromePersistentLogger",["$logProvider",function(e){var t,n="logs",r=[],i=!1,o=1e3,a=!1,c=!0;const s=1024;function u(e,n){var i={level:e,msg:n.map((function(e){if(!angular.isObject(e))return e;try{return angular.toJson(e)}catch(t){return e}})).join(", ").substr(0,s),timestamp:(new Date).getTime()};return t?t.add(i):r.push(i),!0}this.setStorageKey=function(e){n=e},this.setMaxNumLogs=function(e){o=e},this.enableAutoLoad=function(e){i=e},this.enableAutoSave=function(e){c=e},this.enableGlobalHandler=function(e){a=e},this.install=function(){this.enableAutoLoad(!0),e.setCustomHook(u)},this.$get=["$window","cf2ChromeStorageService","CircularBuffer","$log",function(e,s,l,d){var f={};function p(e){return[new Date(e.timestamp).toISOString(),e.level.toUpperCase(),e.msg].join(" ")}function h(e){var t=new l(o);return e.forEach((function(e){t.add(e)})),t}return f.load=function(){return s.local.getSingle("logs_"+n).then((function(e){e&&e.length&&(t=h(e.concat(f.getEntries())))}))},f.save=function(e){return s.local.setSingle("logs_"+(e||n),f.getEntries())},f.clear=function(){t.clear()},f.getEntries=function(){return t.getValues()},f.getLogs=function(){return f.getEntries().map(p)},f.getMergedLogs=function(e,t=!1){return e=e.map((function(e){return"logs_"+e})),s.local.get(e).then((function(e){var n=[];return angular.forEach(e,(function(e,t){e&&e.length&&e.forEach((function(e){e.storageKey=t.substr("logs_".length),n.push(e)}))})),n.sort((function(e,t){return e.timestamp-t.timestamp})),t?n:n.map((function(e){return"["+e.storageKey+"] "+p(e)}))}))},f.hookFn=u,t=h(r),r=null,i&&f.load(),a&&(e.onerror=function(e,t,n){d.error("global error",e,t,n)}),c&&e.addEventListener("unload",(function(){f.save()})),f}]}]).run(["chromePersistentLogger",angular.noop])},Xe46:function(e,t){angular.module("castifyExt.youtubeAuth",["w69b.uritool","castifyExt.castifyAuth"]).provider("youtubeAuth",(function(){var e,t=["https://www.googleapis.com/auth/youtube"];this.setScopes=function(e){t=e},this.setClientId=function(t){e=t},this.$get=["castifyAuth","$log","uritool","$q","$http","castifyConfig",function(n,r,i,o,a,c){var s=c.API_URL+"/youtube/",u=s+"channels",l=s+"tokens",d="https://accounts.google.com/o/oauth2/auth",f={},p=0,h={};function g(e){return e.data}function m(){return n.getRedirectURL().then((function(a){var c,s=(c={redirect_uri:a,scope:t.join(" "),response_type:"code",client_id:e,access_type:"offline",include_granted_scopes:!1,prompt:"select_account consent"},d+"?"+i.encodeQuery(c));return n.launchWebAuthFlow({url:s,interactive:!0}).then((function(e){return r.debug("youtube oauth result",e),e.code?e.code:o.reject("youtube_flow_returned_no_code")}))}))}function b(e){return a.post(u,{code:e,version:2},{googleAuth:!0}).then(g,(function(e){return r.warn("adding youtube code failed",e),o.reject("youtube_add_code_failed")}))}return h.addChannel=function(){return n.getAuthToken({interactive:!0}).then(m).then(b)},h.listChannels=function(){return a.get(u,{googleAuth:!0}).then(g)},h.removeChannel=function(e){return a.delete(u+"/"+e,{googleAuth:!0}).then(g)},h.getAuthToken=function(e){if(!e.channelId)throw new Error;var t,n=e.channelId,r=Math.floor(Date.now()-p)+12e4,i=f[n];return i&&i.expiresAt>r?t=o.when(i):(t=function(e){return a.get(l+"/"+e,{googleAuth:!0}).then(g).then((function(e){return e.expiresAt=Number(new Date(e.expiresAt)),e.issuedAt=Number(new Date(e.issuedAt)),e}))}(n)).then((function(e){f[n]=e,e.issuedAt&&(p=Date.now()-Number(e.issuedAt))})),t.then((function(e){return e.accessToken}))},h}]})).factory("youtubeHttpAuthInterceptor",["$q","$injector","$log",function(e,t,n){var r;return{request:function(i){return i.youtubeAuth?(i.googleAuth&&delete i.googleAuth,(o=i.youtubeAuth,a={channelId:o},(r||(r=t.get("youtubeAuth")),r).getAuthToken(a)).then((function(e){return i.headers=angular.extend(i.headers||{},function(e){return{Authorization:"Bearer "+e}}(e)),i}),(function(t){return n.warn("youtubeAuth failed",t),e.reject("youtubeAuth failed")}))):i;var o,a}}}])},YGdR:function(e,t){angular.module("castifyExt.videoPreviewRenderer",["castifyExt.bgFiles","w69b.filesHelper","w69b.promiseTool","w69b.spawn"]).factory("videoPreviewRenderer",["bgFiles","filesHelper","$q","promiseTool","spawn",function(e,t,n,r,i){var o={width:640,height:360},a={renderPreview:function(a){return r.withTimeout(i.wrap((function*(){var r,i=a+".png",c={};let s=yield t.getFileEntryByPath(e.idToLocalFilename(a)),u=yield async function(e){var t=document.createElement("video");return t.src=e,t.crossOrigin="anonymous",await new Promise((e,n)=>{function r(){o(),e(t)}function i(){o(),n(new Error("failed to load video"))}function o(){t.removeEventListener("canplay",r),t.removeEventListener("error",i)}t.addEventListener("canplay",r),t.addEventListener("error",i)}),await new Promise(e=>{t.addEventListener("seeked",e),t.currentTime=.01}),t}(s.toURL());var l,d,f,p={width:u.videoWidth,height:u.videoHeight};c.size=p,c.duration=u.duration,l=p,d=o,f=Math.max(d.width/l.width,d.height/l.height),r={width:l.width*f,height:l.height*f};let h=yield function(e,t){var r=document.createElement("canvas");r.width=t.width,r.height=t.height;var i=r.getContext("2d");return i.drawImage(e,0,0,t.width,t.height),i.fillStyle="red",i.fillText("hello",10,10),function(e){var t=e.toDataURL(),r="data:image/png;base64,";if(0!==t.lastIndexOf(r,0))throw Error();var i=t.substring(r.length);return i=new Uint8Array(function(e){for(var t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length)),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}(i)),n.when(new Blob([i],{type:"image/png"}))}(r)}(u,r),g=yield(m=i,t.getFileEntryByPath("_previewImages/"+m,{create:!0},{create:!0}));var m;let b=yield t.createWriter(g);yield t.writeFile(b,h);var v={path:"_previewImages/"+i,size:r,url:g.toURL()};return yield e.updateLocalInfo(a,{previewImages:[v],videoInfo:c}),g})),3e3)}};return a}])},Z0Xy:function(e,t){angular.module("castifyExt.audioContextPool",[]).factory("audioContextPool",["$window",function(e){var t=[];return{acquire:function(){return t.length?t.pop():new e.AudioContext({latencyHint:"playback"})},release:function(e){t.push(e)}}}])},ZugE:function(e,t){angular.module("castifyExt.resizeTab",["w69b.chromeTabs","w69b.chromeWindows"]).factory("resizeTab",["chromeTabs","chromeWindows","$q",function(e,t,n){return function(r,i,o,a){function c(){return e.get(r).then((function(e){return s=e}))}var s,u=0,l=0;function d(){return t.get(s.windowId).then((function(e){return"normal"!==e.state&&!1===a?n.reject():t.update(s.windowId,{width:i+(e.width-s.width)+u,height:o+(e.height-s.height)+l,state:"normal"})}))}function f(e){return e.width!=i||e.height!=o?(u+=i-e.width,l+=o-e.height,d().then(c)):e}return c().then(d).then(c).then(f).then(f).catch((function(){return s}))}}])},aI2O:function(e,t){angular.module("castifyExt.driveFileWatcher",["cf2.chromeStorageService","w69b.chromeAlarms","w69b.spawn","castifyExt.castifyAuth","castifyExt.bgFiles"]).factory("driveFileWatcher",["bgFiles","cf2ChromeStorageService","$rootScope","$log","chromeAlarms","spawn",function(e,t,n,r,i,o){var a="driveFileWatcher",c=a,s=!1,u=0,l=10,d={},f={};function p(){return t.local.setSingle(a,{ids:Object.keys(d),lastCheckedAt:u})}function h(e){delete d[e]}const g=o.wrap((function*(){let t=new Set(Object.keys(d));if(!t.size)return;r.debug("driveFileWatcher: checking watched files");let i=yield e.listFiles(),o=[];for(let e of Object.values(i)){if(!e.$driveDesc)continue;let n=e.$driveDesc.driveInfo;d[n.id]&&(t.delete(n.id),n.thumbnailLink&&o.push(n.id))}let a=Array.from(t);if(a.length||o.length){let e={removed:a,processed:o};r.debug("driveFileWatcher: updated detected",e),n.$broadcast("driveFileWatcher:update",e)}for(let e of[...o,...a])h(e)}));function m(e){Object.keys(d).length&&(!e&&Date.now()-u>=6e4*l?s||(s=!0,g().finally((function(){s=!1,u=Date.now(),p(),m()}))):i.get(c).then((function(e){e||i.create(c,{delayInMinutes:l})})))}function b(e){e.name===c&&m()}return f.watchFile=function(e){r.debug("driveFileWatcher: watching file",e),d[e]=!0,p(),m(!0)},f.clear=function(){d={},p()},f.install=function(){t.local.getSingle(a).then((function(e){e&&(e.ids.forEach((function(e){d[e]=!0})),u=e.lastCheckedAt||0),m()})),i.onAlarm.addListener(b)},f}])},c4q8:function(e,t){angular.module("w69b.chromeRuntime",["w69b.promiseTool"]).factory("chromeRuntime",["promiseTool",function(e){var t={};return t.sendMessage=e.wrapChromeError(chrome.runtime.sendMessage,chrome.runtime),t.getBackgroundPage=e.wrapChromeError(chrome.runtime.getBackgroundPage,chrome.runtime),t.connect=chrome.runtime.connect.bind(chrome.runtime),t.getManifest=chrome.runtime.getManifest.bind(chrome.runtime),t.id=chrome.runtime.id,chrome.runtime.getPlatformInfo&&(t.getPlatformInfo=e.wrapChromeError(chrome.runtime.getPlatformInfo,chrome.runtime)),t.setUninstallURL=e.wrapChromeError(chrome.runtime.setUninstallURL,chrome.runtime),["onMessage","onMessageExternal","onConnect","onConnectExternal","onInstalled","onSuspend"].forEach((function(e){t[e]={addListener:function(t){chrome.runtime[e].addListener(t)},removeListener:function(t){chrome.runtime[e].removeListener(t)}}})),t}])},cgCA:function(e,t){angular.module("w69b.promiseTool",[]).factory("promiseTool",["$q","$timeout",function(e,t){return{wrapChromeError:function(t,n){return function(){var r=Array.prototype.slice.call(arguments,0),i=e.defer();return r.push((function(e){chrome.runtime.lastError?i.reject(chrome.runtime.lastError):i.resolve(e)})),t.apply(n,r),i.promise}},wrapCallbacks:function(t,n){return function(){var r=Array.prototype.slice.call(arguments,0),i=e.defer();return r.push(i.resolve.bind(i)),r.push(i.reject.bind(i)),t.apply(n,r),i.promise}},serializer:function(){var t=null,n=function(n){var r=e.defer();return(t||e.when()).then((function(){(n.call()||e.when()).then(e=>r.resolve(e),e=>r.reject(e))})),(t=r.promise.catch(()=>null)).then((function(){t=null})),r.promise};return n.wrap=function(e){return function(){return n(e.bind(this,...arguments))}},n},withTimeout:function(n,r,i){i||(i=angular.noop);var o=e.defer(),a=t((function(){var e=i();angular.isDefined(e)?o.resolve(e):o.reject("timeout"),o=null}),r);function c(){t.cancel(a),a=null}return n().then((function(){c(),o&&o.resolve.apply(o,arguments)}),(function(){c(),o&&o.reject.apply(o,arguments)})),o.promise}}}])},d7dg:function(e,t){angular.module("w69b.ui.bytesFilter",[]).filter("bytes",["$injector",function(e){var t;return function(n,r){if(!angular.isNumber(n))return"-";if(angular.isUndefined(r)&&(r=1),n<=0)return"0 B";var i=Math.floor(Math.log(n)/Math.log(1024));return function(n,r){return t||(t=e.get("$filter")("number")),t(n,r)}(n/Math.pow(1024,Math.floor(i)),r)+" "+["B","KB","MB","GB","TB","PB"][i]}}])},dE4o:function(e,t){angular.module("castifyExt.simplePortService",["w69b.chromeRuntime"]).factory("simplePortService",["chromeRuntime",function(e){return function(t){var n=new Set,r={handlers:{}};function i(e){e.name===t&&(n.add(e),e.onDisconnect.addListener((function(){n.delete(e)})),e.onMessage.addListener((function(e){r.handlers.hasOwnProperty(e.type)&&r.handlers[e.type](e.data)})))}return r.postMessage=function(e,t){for(var r of n)r.postMessage({type:e,data:t})},r.install=function(){e.onConnect.addListener(i)},r}}])},e9m0:function(e,t){angular.module("castifyExt.syncNotifications",["castifyExt.bgSyncStatus","w69b.throttle","w69b.chromeNotifications","cf2.inAppTabService","castifyExt.appOptions","w69b.promiseTool","castifyExt.helpCenter"]).factory("syncNotifications",["$rootScope","bgSyncStatus","throttle","chromeNotifications","$q","cf2InAppTabService","appOptions","helpCenter","promiseTool",function(e,t,n,r,i,o,a,c,s){var u={},l="sync_state_",d=null,f=s.serializer();function p(e,t){f((function(){e=l+e;var n,o=!d;return d&&d!==e?(n=r.clear(d),o=!0):n=i.when(),t=angular.extend({type:"basic",priority:0,eventTime:Date.now(),isClickable:!1,title:"Saving on Drive",iconUrl:"images/icon128.png"},t),d=e,n.then(o?function(){return r.create(e,t)}:function(){return r.update(e,t)})}))}function h(){f((function(){if(d){var e=r.clear(d);return d=null,e}}))}var g={uploading:function(e){a.values.notifySyncProgress&&p("progress",{type:"progress",priority:0,message:"Your recording(s) are being saved "+e.numCompleteFiles+" / "+e.numTotalFiles,progress:Math.floor(100*e.progress)})},waiting:function(e){a.values.notifySyncProgress&&p("waiting",{priority:0,message:e.numTotalFiles+" recording(s) are waiting to get saved on Drive."})},offline:function(e){p("offline",{title:"You are offline",priority:1,message:e.numTotalFiles+" recording(s) are not saved on Drive yet."})},error:function(e){"token"===e.errorReason?p("auth",{priority:2,title:"Not signed In",message:"Screencastify cannot save to Drive.",buttons:[{title:"Sign In"}]}):"forbidden"===e.errorReason?p("forbidden",{priority:2,title:"G Suite setup required",message:"Drive API/Apps are disabled for your domain.",buttons:[{title:"Help"}]}):"quotaExceeded"===e.errorReason?p("quotaExceeded",{priority:2,title:"Out of Drive storage space",message:"You have reached your storage limit on Drive. Screencastify cannot store save to Drive anymore.",buttons:[{title:"Help"}]}):p("error",{priority:2,title:"Failed to save recordings on Drive.",message:"We failed to save "+e.numTotalFiles>0?e.numTotalFiles:"some recording(s) on Drive. Please contact support if this problem persists.",buttons:[{title:"Retry"}]})},synced:h,disabled:h};function m(e,n){function r(t,r){return e===l+t&&n===(r||0)}r("error")?t.retry():r("auth")?o.create("#/setup"):r("forbidden")?c.openHelp("drive_apps"):r("quotaExceeded")&&c.openHelp("quotaExceeded")}function b(){var e=t.getState(),n=g[e.type];n&&n(e)}return u.install=function(){t.install();var i=n(b,1e3,!1);e.$watchCollection(t.getState,(function(){i()})),r.onButtonClicked.addListener(m)},u}])},fNYK:function(e,t){angular.module("castifyExt.switchTab",["w69b.spawn","w69b.chromeCommands","w69b.chromeNotifications"]).factory("switchTab",["$log","chromeCommands","chromeNotifications","spawn","cf2BgCastifyDrawService",function(e,t,n,r,i){const o={chromeNotify:r=>{e.debug("switchTab: draw lost focus"),t.getAll().then((function(e){for(let t=0;t<e.length;++t)if("focus-tab"==e[t].name)return e[t];return null})).then((function(e){var t="Screencastify is recording a tab in the background. ";"webrtc"!==r.encoder&&(t+="Use the extension icon to switch the record focus to your current tab.",e&&e.shortcut&&(t+=" You can also use the keyboard shortcut "+e.shortcut+".")),n.simple.create({priority:2,title:"Recording a background tab",message:t},"activeTab")}))}};return o.loadAdditionalDraw=r.wrap((function*(t,n){e.debug("switchTab: load new draw");try{yield i.loadInTab(t,n)}catch(r){e.info("switchTab: failed to load additoinal draw for tab %s",t,r)}})),o}])},gCzY:function(e,t){angular.module("castifyExt.requestMicPermission",[]).factory("requestMicPermission",["$window","$q","$interval",function(e,t,n){return function(){var r=t.defer(),i=e.open("mic.html","mic",""),o=!1;i.clGotStream=function(){o=!0,r.resolve()};var a=n((function(){i.closed&&!o&&r.reject("closed mic permission window without granting permission")}),200);return r.promise.finally((function(){n.cancel(a)})),r.promise}}])},gfU1:function(e,t){angular.module("castifyExt.audioStreamMixer",["castifyExt.audioContextPool"]).factory("audioStreamMixer",["audioContextPool",function(e){return function(){var t=e.acquire(),n=t.createMediaStreamDestination(),r={},i={},o={addStream:function(e,o){var a=t.createMediaStreamSource(o),c=t.createGain();i[e]=a,r[e]=c,a.connect(c),c.connect(n)},replaceStream:function(e,n){var a=i[e];a||o.addStream(e,n),a.disconnect(),t.createMediaStreamSource(n).connect(r[e])},setGain:function(e,t){r[e].gain.value=t}};return o.outStream=n.stream,o.dispose=function(){o.outStream.getTracks().forEach((function(e){e.stop()})),n.disconnect(),angular.forEach(r,(function(e){e.disconnect()})),angular.forEach(i,(function(e){e.disconnect()})),e.release(t)},o}}])},gutk:function(e,t){angular.module("w69b.chromeAlarms",["w69b.promiseTool"]).factory("chromeAlarms",["promiseTool",function(e){var t={};return t.create=chrome.alarms.create.bind(chrome.alarms),["get","getAll","clear","clearAll"].forEach((function(n){t[n]=e.wrapChromeError(chrome.alarms[n],chrome.alarms)})),t.onAlarm=chrome.alarms.onAlarm,t}])},iNku:function(e,t){angular.module("castifyExt.deadAudioStreamChecker",["castifyExt.audioContextPool","w69b.webrtc"]).factory("deadAudioStreamChecker",["audioContextPool","$timeout","$q","webrtc","$log",function(e,t,n,r,i){let o={getUserMedia:async function(e){let t=await r.getUserMedia(e);if(e.audio&&e.audio.mandatory&&e.audio.mandatory.sourceId){let n=await o.hasAudioData(t);i.debug("deadAudioStreamChecker: stream hasAudio=",n),n||(function(e){e.getTracks().forEach((function(e){e.stop()}))}(t),i.debug("deadAudioStreamChecker: re-requesting stream"),t=await r.getUserMedia(e))}return t},hasAudioData:async function(r,i=1e3){let o=e.acquire(),a=o.createScriptProcessor(2048,2,1),c=o.createMediaStreamSource(r),s=new Promise(e=>{a.onaudioprocess=t=>{t.inputBuffer.getChannelData(0).some(e=>0!==e)&&e(!0)}});c.connect(a),a.connect(o.destination);try{let r=t(i).then(()=>!1);return await n.race([s,r])}finally{c.disconnect(),a.disconnect(),e.release(o)}}};return o}])},iTUk:function(e,t){angular.module("w69b.structs.CircularBuffer",[]).factory("CircularBuffer",(function(){var e=function(e){this.maxSize_=e||100,this.buff_=[]},t=e.prototype;return t.nextPtr_=0,t.add=function(e){this.buff_[this.nextPtr_]=e,this.nextPtr_=(this.nextPtr_+1)%this.maxSize_},t.get=function(e){return e=this.normalizeIndex_(e),this.buff_[e]},t.set=function(e,t){e=this.normalizeIndex_(e),this.buff_[e]=t},t.getCount=function(){return this.buff_.length},t.isEmpty=function(){return 0===this.buff_.length},t.clear=function(){this.buff_.length=0,this.nextPtr_=0},t.getValues=function(){return this.getNewestValues(this.getCount())},t.getNewestValues=function(e){for(var t=this.getCount(),n=[],r=this.getCount()-e;r<t;r++)n.push(this.get(r));return n},t.getKeys=function(){for(var e=[],t=this.getCount(),n=0;n<t;n++)e[n]=n;return e},t.containsKey=function(e){return e<this.getCount()},t.containsValue=function(e){for(var t=this.getCount(),n=0;n<t;n++)if(this.get(n)==e)return!0;return!1},t.getLast=function(){return 0===this.getCount()?null:this.get(this.getCount()-1)},t.normalizeIndex_=function(e){if(e>=this.buff_.length)throw Error("Out of bounds exception");return this.buff_.length<this.maxSize_?e:(this.nextPtr_+Number(e))%this.maxSize_},e}))},ihUj:function(e,t){angular.module("castifyExt.bgLicensing",["castifyExt.castifyAuth","cf2.chromeStorageService","w69b.chromeRuntime","w69b.spawn","w69b.promiseTool","cf2.connectedAppsService"]).factory("bgLicensing",["castifyAuth","$http","chromeRuntime","cf2ChromeStorageService","$q","$log","promiseTool","spawn","cf2ConnectedAppsService",function(e,t,n,r,i,o,a,c,s){var u="https://www.googleapis.com/chromewebstore/v1.1/userlicenses/";const l=1413892757176,d="cws_license",f=600,p=50;let h=!0;function g(){return s.getConnectedAppInfo().then((function(e){var t=Date.now();return e.some((function(e){return e.isPaidInstall&&(!e.userExpiryDate||e.userExpiryDate>=t)}))?{access:"full",type:"app",maxAgeSecs:3600}:null}))}function m(e){function t(){return!h||e&&("tester"===e.access||"full"==e.access)}function n(){return!t()}function r(){return n()}var i,o=0;return e&&(o=Date.now()+1e3*e.maxAgeSecs),{validTill:o,type:(i="trial",e&&(i=e.access,e.type&&(i+="_"+e.type)),i),branding:!(e&&!e.branding||t()),isTester:!(!e||"tester"!==e.access),isPaid:!(!e||"full"!==e.access),limitLength:n(),maxLength:t()?Number.MAX_SAFE_INTEGER:f,limitNumRecordings:r(),maxNumRecordings:function(){const t=e&&e.planVariantSettings?e.planVariantSettings.maxRecordingsMonth:p;return r()?t:Number.MAX_SAFE_INTEGER}()}}return{getLicense:function(){var s=e.getAuthToken({interactive:void 0}).then((function(){return i.all([r.sync.getSingle(d).then((function(e){return angular.isDefined(e)?e:i.reject()})).catch((function(){return c((function*(){var e,r=u+n.id,i=yield(e=window.chrome.identity,a.wrapChromeError(e.getAuthToken,e)({interactive:!1,scopes:["email","https://www.googleapis.com/auth/chromewebstore.readonly"]})),o=(yield t.get(r,{headers:{Authorization:"Bearer "+i}})).data;return!(!o.result||!o.createdTime)&&new Date(Number(o.createdTime))<l})).then((function(e){return r.sync.setSingle(d,e),e}))})).catch((function(){return!1})),g()]).then((function(e){return e[1]||(e[0]?{access:"tester",maxAgeSecs:2}:null)}))}),g).then((function(e){return e})).then(m);return s.catch((function(e){o.debug("local update failed",e)})),s}}}])},jHUz:function(e,t){angular.module("castifyExt.localFileDb",["cf2.chromeStorageService","w69b.filesHelper","w69b.promiseTool"]).factory("localFileDb",["$q","cf2ChromeStorageService","filesHelper","promiseTool",function(e,t,n,r){var i={},o=t.local,a="filedb_";function c(e){return a+e}function s(e){var t=c(e);return o.getSingle(t,{})}function u(e){angular.extend(this,e)}var l=u.prototype;u.createFromIdOrFileEntry=function(t){let r,o;return(angular.isString(t)?n.getFileEntryByPath(i.idToFilename(t)):e.when(t)).then((function(t){return r=t,o=i.filenameToId(t.name),e.all({metadata:n.getMetadata(r),info:s(o)}).then((function(e){var t=r.toURL(),n={id:o,uuid:o,url:t,mimeType:"video/webm",createdAt:e.metadata.modificationTime,title:e.info.title,size:e.metadata.size};if(e.info.videoInfo){var i=e.info.videoInfo;angular.extend(n,{duration:i.duration,width:i.size.width,height:i.size.height})}if(e.info.previewImages&&(n.thumbnailUrl=e.info.previewImages[0].url),e.info.driveInfo&&(n.driveInfo=e.info.driveInfo),e.info.youtubeInfo){var a=e.info.youtubeInfo;n.youtubeInfo={id:a.id,channelId:a.channelId}}return e.info.driveFileId&&(n.driveFileId=e.info.driveFileId),e.info.tmpDrivePrivacy&&(n.tmpDrivePrivacy=e.info.tmpDrivePrivacy),e.info.autoShare&&(n.autoShare=e.info.autoShare),new u(n)}))}))},l.rename=function(e){return i.updateInfo(this.id,{title:e})},l.remove=function(){var t=this.id;return e.all({result:n.removeByPath(i.idToFilename(t)),info:s(t)}).then((function(t){if(t.info.previewImages)return e.all(t.info.previewImages.map((function(e){return n.removeByPath(e.path)})))})).then((function(){return o.remove(c(t))}))},l.updateYoutubeInfo=function(e){return i.updateInfo(this.id,{youtubeInfo:e})},i.listFiles=function(){return n.listByPath("/").then((function(t){var n=[];return t.forEach((function(e){e.isFile&&"."!==e.name[0]&&n.push(u.createFromIdOrFileEntry(e))})),e.all(n).then((function(e){var t={};return e.forEach((function(e){t[e.id]=e})),t}))}))},i.filenameToId=function(e){if(/\.webm/i.test(e))return e.slice(0,-5);throw new Error("invalid filename: "+e)},i.idToFilename=function(e){return e+".webm"},i.getFileDescriptor=function(e){return u.createFromIdOrFileEntry(e)};let d=r.serializer();return i.updateInfo=d.wrap((function(t,n,r){var i=c(t);return(r?e.when(n):o.get(i).then((function(e){return angular.extend(e[i]||{},n)}))).then((function(e){var t={};return t[i]=e,o.set(t),e}))})),i}])},k4Xy:function(e,t){angular.module("castifyExt.bgSyncStatus",["castifyExt.bgFiles","castifyExt.bgUpload","castifyExt.syncAuthTool","castifyExt.bgSyncManager","w69b.throttle","w69b.chromeRuntime","w69b.spawn"]).factory("bgSyncStatus",["bgFiles","bgUploadService","$rootScope","$log","throttle","syncAuthTool","chromeRuntime","bgSyncManager","spawn",function(e,t,n,r,i,o,a,c,s){var u={},l=null,d={type:"unknown"},f={},p=new Map,h=[];function g(e){if("syncStatus"==e.name){h.push(e),m(),e.onDisconnect.addListener((function(){var t=h.indexOf(e);t>=0&&h.splice(t,1)}));var t={retry:u.retry};e.onMessage.addListener((function(e){t.hasOwnProperty(e.type)&&t[e.type](e.data)}))}}function m(){var e;e=d,h.forEach((function(t){t.postMessage({type:"stateUpdate",data:e})}))}function b(e){v({type:"synced",numTotalFiles:e}),m()}function v(e){e.type!==d.type&&(r.debug("syncStatus: changing state to ",e),"synced"===e.type&&"unknown"!==d.type&&n.$broadcast("bgSyncStatus:syncComplete")),d=e,"uploading"!==e.type&&(f={})}function y(e){"offline"!==d.type&&v({type:"offline"}),d.numTotalFiles=e,m()}function w(){c.areAllLocalFilesSynced().catch(()=>!1).then((function(e){e?(r.debug("syncStatus: treating auth error with no local files as synced"),b(0)):(v({type:"error",errorReason:"token"}),m())}))}function _(){v({type:"error",errorReason:"forbidden"}),m()}function S(){var e=null;for(let t of p.values())t&&(e=t);v({type:"error",numTotalFiles:p.size,errorReason:e}),m()}function E(){t.isOnline()?o.checkSetup().then(S,(function(e){"token"===e?w():"forbidden"===e?_():S()})):y(0)}var C=s.wrap((function*(){p.size>0?E():(yield c.areAllLocalFilesSynced().catch(()=>!1))?b(0):e.listFiles().then((function(e){if(l){var n={},r=!1,i=0;angular.forEach(e,(function(e){var o;e.autoShare||(e.isSynced?f.hasOwnProperty(e.id)&&(f[e.id]=1):(n[e.id]=(o=t.getTargetFileState(e.id,"drive"))&&o.config.isSyncUpload?o:null,r=!0),++i)})),angular.forEach(f,(function(t,n){e[n]||delete f[n]})),r?function(e){var n=0,r=0;angular.forEach(e,(function(e,t){f[t]=e&&e.progress||f[t]||0,e?"uploading"===e.state?++n:"queued"===e.state&&++r:r++})),n?function(){"uploading"!==d.type&&v({type:"uploading"});var e=0,t=0,n=0;angular.forEach(f,(function(r){e+=r,++t,r>=1&&++n})),d.progress=e/t,d.numTotalFiles=t,d.numCompleteFiles=n,m()}():r&&(t.hasRecentlyRanOutOfDriveSpace()?(v({type:"error",errorReason:"quotaExceeded"}),m()):t.isOnline()?function(e){"waiting"!==d.type&&v({type:"waiting"}),d.numTotalFiles=e,m()}(r):y(r))}(n):b(i)}}),(function(e){r.debug("syncStatus list err",e),o.isRateLimitError(e)||E()}))}));function I(e,t){var n=t.config,i=t.error;n.isSyncUpload&&(r.debug("sync error detected",i),p.has(n.fileId)&&p.delete(n.fileId),p.set(n.fileId,i&&i.reason),C())}function A(){return"error"==d.type}function O(){A()||w()}function j(){A()||_()}function x(){p.clear(),C()}return u.retry=function(){t.clearOutOfSpaceErrors(),p.clear(),c.syncFiles()},u.getState=function(){return d},u.install=function(){n.$watch(e.isSyncEnabled,(function(r){r?function(){v({type:"unknown"}),m(),l=n.$new(!0);var r=i(C,300,!0);l.$watchGroup([e.getListVersionId,t.getWatcherStateId,t.isOnline],(function(){r()})),l.$on("uploader:failed",I),l.$on("event:syncAuthError",O),l.$on("event:syncForbiddenError",j),l.$on("event:userAccountChanged",x)}():(l&&l.$destroy(),l=null,v({type:"disabled"}),m())})),a.onConnect.addListener(g)},u}])},kEoX:function(e,t){angular.module("w69b.streamedVideo",[]).factory("streamedVideo",["$q",function(e){return function(){var t,n,r,i=document.createElement("video"),o={onEnded:null};function a(){o.onEnded&&o.onEnded()}return o.stop=function(){n&&(i.pause(),i.src="",window.URL.revokeObjectURL(t),n.removeEventListener("ended",a),n.stop(),n=null,r=!1)},o.load=function(c){if(n)throw new Error;n=c;var s=e.defer();return c.addEventListener("ended",a),t=window.URL.createObjectURL(c),i.addEventListener("canplay",(function e(){i.removeEventListener("canplay",e),i.play(),0===i.videoHeight||0===i.videoWidth?(o.stop(),s.reject("loading video failed")):(r=!0,s.resolve())})),i.addEventListener("error",(function e(){i.removeEventListener("error",e),o.stop(),s.reject(i.error)})),i.src=t,i.volume=0,s.promise},o.isLoaded=function(){return r},o.getVideoElement=function(){return i},o}}])},kwgm:function(e,t){angular.module("w69b.chromeCapture",["w69b.promiseTool","w69b.webrtc"]).factory("chromeCapture",["promiseTool","webrtc","$q",function(e,t,n){var r={tabCapture:function(){return chrome.tabCapture?e.wrapChromeError(chrome.tabCapture.capture,chrome.tabCapture).apply(null,arguments):n.reject("tabCapture permission missing")}};return chrome.desktopCapture&&(r.chooseDesktopMedia=function(){e.wrapChromeError(chrome.desktopCapture.chooseDesktopMedia,chrome.desktopCapture);var t=Array.prototype.slice.call(arguments,0),r=n.defer();t.push((function(e){chrome.runtime.lastError?r.reject(chrome.runtime.lastError):r.resolve(e)}));var i=chrome.desktopCapture.chooseDesktopMedia.apply(chrome.desktopCapture,t);function o(e){chrome.desktopCapture.cancelChooseDesktopMedia(i),r.reject(e||"cancelled")}return{promise:r.promise,cancel:o}}),r.desktopCapture=function(e){return t.getUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:1920,maxHeight:1200}}})},r}])},"mV/w":function(e,t){angular.module("castifyExt.bgFiles",["castifyExt.localFileDb","castifyExt.driveFileDb","w69b.chromeRuntime","castifyExt.appOptions","castifyExt.syncAuthTool","castifyExt.offline","w69b.spawn","cf2.bgUsageStatsService"]).factory("bgFiles",["localFileDb","driveFileDb","$q","$rootScope","chromeRuntime","appOptions","$log","syncAuthTool","$interval","spawn","$timeout","cf2BgUsageStatsService",function(e,t,n,r,i,o,a,c,s,u,l,d){let f,p={},h={},g=[],m=0,b=["id","size","width","height","duration","title","thumbnailUrl","createdAt","url","driveInfo","youtubeInfo","urlRequiresAccessToken","autoShare","mimeType"],v=b.concat(["isSynced","isLocal","driveFileId","tmpDrivePrivacy"]);function y(e,t){this.$localDesc=e,this.$driveDesc=t,this.ownProperties_={}}let w=y.prototype;function _(e){this.port=e}function S(e){return c.broadcastIfSyncError(e)}function E(){return o.values.driveSync}function C(e){let t={};return v.forEach((function(n){let r=e[n];angular.isDefined(r)&&(r instanceof Date&&(r=r.getTime()),t[n]=r)})),t}function I(e){let t={};return angular.forEach(e,(function(e,n){t[n]=C(e)})),t}function A(){m++,h.listFiles().then((function(e){O("filesUpdate",{full:I(e)})}))}function O(e,t){g.forEach((function(n){n.subscribed&&n.postMessage(e,t)}))}function j(e){m++;let t=p[e],n={};t?(n.add={},n.add[e]=C(t)):n.remove=[e],O("filesUpdate",n)}function x(e){if("files"!=e.name)return;let t=new _(e);g.push(t),e.onDisconnect.addListener((function(){let e=g.indexOf(t);e>=0&&g.splice(e,1)}));let n={remove:h.remove,reload:function(e){h.reload(e).then((function(){t.postMessage("reloadSuccess",e)}),(function(){t.postMessage("reloadError",e)}))},rename:function(e){h.rename(e.id,e.title)},removeAll:h.removeAll,subscribe:function(){t.subscribed=!0,t.postFiles()}};e.onMessage.addListener((function(e){n.hasOwnProperty(e.type)&&n[e.type](e.data)}))}w.preferDriveDelegate_=function(){return this.$driveDesc?this.$driveDesc:this.$localDesc},w.preferLocalDelegate_=function(){return this.$localDesc?this.$localDesc:this.$driveDesc},w.getDelegate_=function(e){return this.ownProperties_.hasOwnProperty(e)?this.ownProperties_:"thumbnailUrl"===e?this.preferLocalDelegate_():this.preferDriveDelegate_()},w.callOnBoth_=function(e,t){t=Array.prototype.slice.call(arguments,1);let r,i=this;return r=i.$driveDesc?i.$driveDesc[e].apply(i.$driveDesc,t).catch(S):n.when(),r.then((function(){if(i.$localDesc)return i.$localDesc[e].apply(i.$localDesc,t)}))},w.reload=function(){let r=[],i=this;i.$driveDesc&&r.push(t.getFileDescriptor(i.id).then((function(e){i.$driveDesc=e}))),i.$localDesc&&r.push(e.getFileDescriptor(i.id).then((function(e){i.$localDesc=e})));let o=n.all(r).then((function(){i.ownProperties_={}}));return o.finally((function(){j(i.id)})),o},w.rename=function(e){let t=this,n=t.title;t.title=e;let r=t.callOnBoth_("rename",e);return r.catch((function(){t.title=n})),r.finally((function(){j(t.id)})),r},w.remove=function(){a.debug("bgFiles.remove",this.id);let e=this,t=e.callOnBoth_("remove");return t.then((function(){delete p[e.id],d.updateStoredCount(Object.keys(p).length),r.$broadcast("bgFiles:fileRemoved",e.id)})),t.finally((function(){j(e.id)})),t},w.updateYoutubeInfo=function(e){let t=this,n=t.youtubeInfo;t.youtubeInfo=e;let r=t.callOnBoth_("updateYoutubeInfo",e);r.catch((function(){t.youtubeInfo=n})),r.finally((function(){j(t.id)}))},b.forEach((function(e){Object.defineProperty(w,e,{get:function(){let t=this.getDelegate_(e);return t?t[e]:null},set:function(t){this.ownProperties_[e]=t}})})),Object.defineProperty(w,"isSynced",{get:function(){return!!this.$driveDesc}}),Object.defineProperty(w,"isLocal",{get:function(){return!!this.$localDesc}}),Object.defineProperty(w,"driveFileId",{get:function(){return this.$driveDesc&&this.$driveDesc.driveInfo&&this.$driveDesc.driveInfo.id||this.$localDesc&&this.$localDesc.driveFileId}}),Object.defineProperty(w,"tmpDrivePrivacy",{get:function(){return this.$localDesc&&this.$localDesc.tmpDrivePrivacy||"private"}}),w=_.prototype,w.postMessage=function(e,t){g.indexOf(this)<0||this.port.postMessage({type:e,data:t})},w.postFiles=function(){let e=this;h.listFiles().then((function(t){e.postMessage("filesUpdate",{full:I(t)})}),(function(t){a.warn("initial MessageClient subscribe postFiles failed",t),e.postMessage("filesUpdate",{error:!0})}))},h.getFileDescriptor=function(e){return p[e]?n.when(p[e]):h.listFiles().then((function(t){return t[e]?t[e]:n.reject(new Error("file does not exist: "+e))}))},h.listFiles=function(){if(!f){let r=o.loadedPromise.then((function(){return E()?t.listFiles():n.when({})}));f=n.all({local:e.listFiles(),drive:r}).then((function(e){return Object.keys(e.local).concat(Object.keys(e.drive)).forEach((function(t){let n=new y(e.local[t],e.drive[t]);p[n.id]=n})),d.updateStoredCount(Object.keys(p).length),p})),f.catch(S),f.catch((function(){f=null}))}return f},h.removeAll=u.wrap((function*(){let e,t=yield h.listFiles(),n=Object.keys(t);return e=E()?T(n):R(n),e.catch(A),e}));const T=u.wrap((function*(e){const t=[];for(let n=0;n<e.length;n+=7)t.push(R(e.slice(n,n+7))),n+7<e.length&&(yield l(1e3));return n.all(t)}));function R(e){return n.all(e.map(e=>h.remove(e)))}function P(e){if(404===e.status)return a.warn("tried to remove non-existent file, refreshing all files"),h._refreshAllHack();throw e}function k(){return null}function $(e){e&&h._refreshAllHack()}return h.remove=function(e){return h.getFileDescriptor(e).then(e=>e.remove()).catch(P)},h.rename=function(e,t){return h.getFileDescriptor(e).then((function(e){return e.rename(t)}))},h.reload=function(e){return h.getFileDescriptor(e).then((function(e){return e.reload()}))},h.clearCache=function(){m++,f=null,angular.copy({},p)},h.idToLocalFilename=function(t){return e.idToFilename(t)},h.getFile=function(t){return e.getFile(t)},h.localFilenameToId=function(t){return e.filenameToId(t)},h.updateLocalInfo=function(t,n){return e.updateInfo(t,n).then((function(){h.reload(t).then((function(){j(t)})).catch(()=>null)}))},h.updateYoutubeInfo=function(e,t){return h.getFileDescriptor(e).then((function(e){return e.updateYoutubeInfo(t)}))},h.getListVersionId=function(){return m},h.isSyncEnabled=E,h.registerLocalFile=function(t){return u((function*(){let n=yield e.getFileDescriptor(t),i=yield h.getFileDescriptor(t).catch((function(){return new y(n,null)}));p[i.id]=i,j(t),r.$broadcast("bgFiles:localFileCreated",t),d.updateStoredCount(Object.keys(p).length)}))},h.refresh=function(r){if(!/^[0-9a-zA-Z-]*$/.test(r))throw new Error("invalid file id");return n.all({proxy:h.getFileDescriptor(r).catch(k),drive:t.getFileDescriptor(r).catch(k),local:e.getFileDescriptor(r).catch(k)}).then((function(e){let t=e.proxy;if(!t){if(!e.drive&&!e.local)return n.reject();t=new y(e.local,e.drive),p[t.id]=t}t.$driveDesc=e.drive,t.$localDesc=e.local,t.$driveDesc||t.$localDesc||(t.deleted=!0,delete p[r]),j(r)}))},h._refreshAllHack=function(){h.clearCache(),A()},h.install=function(){s(h._refreshAllHack,9e5),r.$on("onlineState:changed",$),r.$on("event:userAccountChanged",h._refreshAllHack),o.loadedPromise.then((function(){r.$watch(E,(function(e,t){var n;t!==e&&(a.debug("bgFiles: sync setting changed to "+(n=e)+" clearing cache"),h.clearCache(),g.length&&A(),r.$broadcast("bgFiles:syncSettingChanged",n))}))})),i.onConnect.addListener(x)},h}])},mim6:function(e,t){angular.module("castifyExt.fileNameGenerator",["w69b.filesHelper","w69b.uuid"]).factory("fileNameGenerator",["uuid","filesHelper",function(e,t){return function(n,r){return n||(n=""),r||(r=""),function i(){var o=n+e()+r;return t.getFileEntryByPath(o).then((function(){return i()}),(function(){return o}))}()}}])},oRFD:function(e,t){angular.module("castifyExt.simpleBgServiceConsumer",["w69b.chromeRuntime"]).factory("simpleBgServiceConsumer",["chromeRuntime","$q",function(e,t){return function(n,r){var i={};function o(e){return e.error?t.reject(e.error):e.data}return r.forEach((function(t){i[t]=function(t){return function(){return e.sendMessage({type:"simpleService",fn:t,service:n,data:Array.prototype.concat.apply([],arguments)}).then(o)}}(t)})),i}}])},"q6u/":function(e,t){angular.module("castifyExt.deployConfig",[]).provider("deployConfig",(function(){let e={analyticsId:"UA-23874345-14",apiUrl:"https://api.screencastify.com/api",clientId:"242262968495-o42n5tqeo08dsa75p3j4dk1k61t05ln3.apps.googleusercontent.com",youtubeClientId:"242262968495-o42n5tqeo08dsa75p3j4dk1k61t05ln3.apps.googleusercontent.com",scopes:chrome.runtime.getManifest().oauth2.scopes,redirectUri:"https://www.screencastify.com/oauth2postback",editorOpenUri:"https://edit.screencastify.com/open/drive",welcomePageUri:"https://www.screencastify.com/welcome",notificationUri:"https://us-central1-castify-notifications-prod.cloudfunctions.net/api/userNotification/",exportServiceURL:"https://ingress.screencastify.com/api/exportService2",editServiceURL:"https://ingress.screencastify.com/api/editService",youtubeUpload2URL:"https://ingress.screencastify.com/api/youtubeUploadService/upload",env:"prod",enableInlinePopupSupport:!1};return{...e,$get:function(){return e}}}))},qVZV:function(e,t){angular.module("w69b.clipboard",[]).factory("clipboard",["$document",function(e){return{copy:function(t){var n=angular.element("<textarea></textarea>");n.text(t),e.find("body").append(n),n[0].select(),e[0].execCommand("copy"),n.remove()}}}])},rJTD:function(e,t){angular.module("w69b.uritool",[]).factory("uritool",(function(){var e=/\+/g;function t(t){return decodeURIComponent(t.replace(e," "))}return{parseQuery:function(e,n){var r;"?"==e[0]&&(e=e.substring(1));for(var i=/([^&=]+)=?([^&]*)/g,o={};r=i.exec(e);){var a=t(r[1]),c=t(r[2]);n&&o.hasOwnProperty(a)?o[a].push(c):o[a]=n?[c]:c}return o},parseUrl:function(e){var t=document.createElement("a");return t.href=e,{protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,hash:t.hash,path:t.pathname}},encodeQuery:function(e){var t=[];return angular.forEach(e,(function(e,n){angular.isArray(e)?angular.forEach(e,(function(e){t.push(encodeURIComponent(n)+(!0===e?"":"="+encodeURIComponent(e)))})):t.push(encodeURIComponent(n)+(!0===e?"":"="+encodeURIComponent(e)))})),t.length?t.join("&"):""}}}))},rsSo:function(e,t){angular.module("castifyExt.ui.audioCountdown",[]).factory("audioCountdown",["$q","$timeout",function(e,t){var n,r,i=0,o=0,a=!1,c={load:function(t){a=!0,n||(n=new Audio("components/castifyExt/ui/audio-countdown.dat"));var r=e.defer();return n.addEventListener("canplay",(function e(){n.removeEventListener("canplay",e),r.resolve()})),n.error?(a=!1,r.reject("failed to load audio countdown: "+(n.error&&n.error.code))):n.addEventListener("error",(function e(){a=!1,n.removeEventListener("error",e),r.reject("failed to load audio countdown: "+(n.error&&n.error.code))})),n.currentTime=Math.max(3-t,0),i=1e3*Math.max(t-3,0),r.promise},pause:function(){n&&a&&(r?(t.cancel(r),r=null,i-=Date.now()-o):n.pause())},start:function(){n&&a&&!n.ended&&(o=Date.now(),i?r=t((function(){r=null,n.play()}),i):n.play())},stop:function(){c.pause(),a=!1}};return c}])},sQ84:function(e,t){angular.module("w69b.filesHelper",["w69b.promiseTool"]).factory("filesHelper",["$window","promiseTool","$q",function(e,t,n){e.requestFileSystem=e.requestFileSystem||e.webkitRequestFileSystem;var r=window.PERSISTENT,i={};function o(e){var t=e.split("/");return[t.slice(0,-1).join("/"),t.slice(-1)[0]]}return["readEntries","remove","getFile","getMetadata","moveTo","file","getDirectory","createWriter"].forEach((function(e){i[e]=function(n){var r=[].slice.call(arguments,1);return t.wrapCallbacks(n[e],n).apply(null,r)}})),i.getFileSystem=function(n,i){return angular.isUndefined(n)&&(n=r),i=i||104857600,t.wrapCallbacks(e.requestFileSystem,e)(n,i)},i.getPersistentQuota=function(){var t=n.defer();return e.navigator.webkitPersistentStorage.queryUsageAndQuota((function(e,n){t.resolve({usage:e,quota:n})}),(function(e){t.reject(e)})),t.promise},chrome.system&&chrome.system.storage&&(i.getStorageInfo=t.wrapChromeError(chrome.system.storage.getInfo,chrome.system.storage)),i.getDirByPath=function(e,t){var r=e.split("/");return""===r[0]&&r.splice(0,1),i.getFileSystem().then((function(e){return function e(r,o){return o.length?i.getDirectory(r,o[0],t||{}).then((function(t){return e(t,o.slice(1))})):n.when(r)}(e.root,r)}))},i.moveFileByPath=function(e,t){var r=o(t),a=r[0],c=r[1];return n.all({file:i.getFileEntryByPath(e),targetDir:i.getDirByPath(a)}).then((function(e){return i.moveTo(e.file,e.targetDir,c)}))},i.getFileEntryByPath=function(e,t,n){var r=o(e),a=r[1];return i.getDirByPath(r[0],n).then((function(e){return i.getFile(e,a,t||{})}))},i.getFileByPath=function(e){return i.getFileEntryByPath(e).then((function(e){return i.file(e)}))},i.removeByPath=function(e){return i.getFileEntryByPath(e).then((function(e){return i.remove(e)}))},i.listByPath=function(e){return i.getDirByPath(e).then((function(e){var t=e.createReader();return i.readEntries(t)}))},i.requestPersistentQuota=function(e){return t.wrapCallbacks(navigator.webkitPersistentStorage.requestQuota,navigator.webkitPersistentStorage)(e||104857600)},i.requestTemporaryQuota=function(e){return t.wrapCallbacks(navigator.webkitTemporaryStorage.requestQuota,navigator.webkitTemporaryStorage)(e||104857600)},i.writeFile=function(e,t){var r=n.defer();return e.onwriteend=r.resolve.bind(r),e.onerror=r.reject.bind(r),e.write(t),r.promise},i.isSupported=function(){return!!window.requestFileSystem},i}])},"sSk+":function(e,t){angular.module("castifyExt.helpCenterConfig",["castifyExt.helpCenter"]).run(["helpCenter",function(e){e.registerUrl("load_nacl","https://screencastify.helpscoutdocs.com/article/33-failed-to-load-nacl-module"),e.registerUrl("disk_space","https://screencastify.helpscoutdocs.com/article/32-out-of-disk-space"),e.registerUrl("drive_apps","https://screencastify.helpscoutdocs.com/article/34-enabling-drive-on-google-apps"),e.registerUrl("start_recording","https://screencastify.helpscoutdocs.com/article/35-failed-to-start-recording"),e.registerUrl("change_account","https://screencastify.helpscoutdocs.com/article/31-how-to-sign-in-with-a-different-account"),e.registerUrl("quotaExceeded","https://screencastify.helpscoutdocs.com/article/20-out-of-space-on-google-drive"),e.registerUrl("youtubeSignupRequired","https://screencastify.helpscoutdocs.com/article/24-youtubesignuprequired-error-when-uploading-to-youtube"),e.registerUrl("no_audio","https://screencastify.helpscoutdocs.com/article/82-failed-to-capture-audio"),e.registerUrl("no_cam","https://screencastify.helpscoutdocs.com/article/83-failed-to-access-your-webcam"),e.registerUrl("no_audio_access","https://help.screencastify.com/article/213-screencastify-failed-to-capture-audio"),e.registerUrl("monthly_recordings_limit","https://www.screencastify.com/buy?utm_source=app&utm_content=notify&utm_campaign=monthly_limit"),e.registerUrl("youtubeCredentialsMissing","https://help.screencastify.com/article/219-i-received-a-youtubeauth-failed-error")}])},tUCW:function(e,t){angular.module("w69b.pnaclVideoEncoder",["w69b.pnaclModule"]).factory("pnaclVideoEncoder",["pnaclModule","$q","$log","$rootScope","$timeout",function(e,t,n,r,i){return function(o,a){var c,s,u=e(o,a),l=null,d=["start","stop","pause","resume","replaceTracks"],f={};function p(){c={state:"inactive",time:0}}function h(){u.unload(),p()}function g(e){h(),l&&l.reject(e),l=null}function m(e){n.error("pnaclVideoEncoderError",e),g(e),f.onError&&f.onError(e)}function b(e){g(),f.onCrash&&f.onCrash(e)}function v(e,t){u.postMessage({type:e,data:t||{}})}function y(e,n){if(l)throw new Error("there is still a pending operation");return l=t.defer(),e&&v(e,n),l.promise}return u.onMessage=function(e){if(d.indexOf((e=e.data).type)>=0){if(!l)return;e.data?l.reject(e.data):l.resolve(),l=null}else if("error"==e.type)m(e.data),r.$$phase||r.$digest();else if("state"==e.type)c=e.data,r.$$phase||r.$digest();else if("stack_trace"==e.type)b(e.data);else{var t;e.data&&(t=e.data).trim&&(t=t.trim()),n.debug(e.type,t)}},f.onCrash=void 0,u.onCrash=b,f.stop=function(){return y("stop").then((function(){h()}))},f.load=function(){return u.load().catch((function(e){return n.warn("original pnacl.load error: ",e),t.reject("nacl_load")}))},f.getState=function(){return c.state},f.getStateObj=function(){return c},f.getFPS=function(){return c.fps},f.getCurrentTime=function(){return c.time},f.replaceTracks=function(e){return y("replaceTracks",e)},f.pause=function(){return y("pause")},f.resume=function(){return y("resume")},f.hasPendingOperation=function(){return!!l},f.start=function(e,t){if(!e)throw new Error("invalid filename");e="/html5_persistent/"+e;var n=y();return s=i((function(){m("start_timeout")}),8e3),u.load().then((function(){return v("start",angular.extend({},t,{filename:e,chromeVersion:Number((/Chrome\/(\d+)/.exec(window.navigator.userAgent)||[void 0,0])[1])})),n})).finally((function(){i.cancel(s),s=null}))},p(),f}}])},tYv9:function(e,t){angular.module("castifyExt.authConfig",["castifyExt.youtubeAuth","castifyExt.castifyAuth","w69b.chromeRuntime","w69b.googleHttpAuthInterceptor","castifyExt.youtubeAuth"]).config(["$httpProvider","youtubeAuthProvider","googleHttpAuthInterceptorProvider","deployConfigProvider",function(e,t,n,r){t.setClientId(r.youtubeClientId),e.interceptors.push("youtubeHttpAuthInterceptor"),e.interceptors.push("googleHttpAuthInterceptor"),n.enableAuthAutoRetry(!0),n.setAuthProvider("castifyAuth")}])},vEZL:function(e,t){angular.module("w69b.googleHttpAuthInterceptor",[]).provider("googleHttpAuthInterceptor",(function(){var e=0,t="googleauth";this.enableAuthAutoRetry=function(t){e=t?1:0},this.setAuthProvider=function(e){t=e},this.$get=["$q","$log","$injector",function(n,r,i){var o,a;function c(e){return(a||(a=i.get(t)),a).getAuthToken(e)}return{request:function(e){return e.googleAuth?c({scopes:e.googleAuthScopes}).then((function(t){return e.headers=angular.extend(e.headers||{},function(e){return{Authorization:"Bearer "+e}}(t)),e}),(function(e){return r.warn("googleAuthHttpInterceptor: no token, aborting request",e),n.reject("googleAuthFailed")})):e},responseError:function(t){if(401==t.status&&t.config.googleAuth&&!1!==t.config.authAutoRetry){r.debug("auth error detected",t);var a=angular.copy(t.config);if(a.authRetryCount?a.authRetryCount++:a.authRetryCount=1,a.authRetryCount<=e)return c({scopes:a.googleAuthScopes,validate:!0}).then((function(){return r.debug("googleAuthHttpInterceptor: auto-retrying with validated token"),(o||(o=i.get("$http")),o)(a)}))}return n.reject(t)}}}]}))},wFxG:function(e,t){angular.module("w69b.chromeNotifications",["w69b.promiseTool"]).factory("chromeNotifications",["promiseTool",function(e){var t={},n={};function r(e){var t=n[e];t&&t.onClicked&&t.onClicked()}function i(e,t){var r=n[e];r&&r.onButtonClicked&&r.onButtonClicked(t)}function o(e,a){var c=n[e];c&&(c.onClosed&&c.onClosed(a),delete n[e],Object.keys(n).length||(t.onClicked.removeListener(r),t.onButtonClicked.removeListener(i),t.onClosed.removeListener(o)))}return t.simple={},t.simple.defaultOptions={},t.simple.create=function(a,c){var s=e.serializer(),u={};return a=angular.extend({},t.simple.defaultOptions,a),s((function(){return t.create(c||"",a).then((function(e){u.id=e,Object.keys(n).length||(t.onClicked.addListener(r),t.onButtonClicked.addListener(i),t.onClosed.addListener(o)),n[e]=u}))})),u.clear=function(){s((function(){return t.clear(u.id)}))},u.update=function(e){s((function(){return t.update(u.id,e)}))},u.onClicked=angular.noop,u.onButtonClicked=angular.noop,u.onClosed=angular.noop,u},["clear","create","update","getAll","getPermissionLevel"].forEach((function(n){t[n]=e.wrapChromeError(chrome.notifications[n],chrome.notifications)})),["onClosed","onClicked","onButtonClicked","onPermissionLevelChanged","onShowSettings"].forEach((function(e){t[e]=chrome.notifications[e]})),t}])},werd:function(e,t){angular.module("castifyExt.bgUpload",["cf2.chromeStorageService","w69b.chromeRuntime","castifyExt.upload.uploadBase","castifyExt.upload.googleUpload","w69b.throttle","castifyExt.offline","castifyExt.syncAuthTool","cf2.sentryErrorHandler"]).factory("bgUploadService",["cf2ChromeStorageService","chromeRuntime","$log","$rootScope","UploadBase","throttle","onlineState","syncAuthTool","$timeout","sentryErrorHandler",function(e,t,n,r,i,o,a,c,s,u){var l,d,f=5,p=5,h=p-3,g=2e3,m=12e4,b=1e3,v=[],y=[],w=[],_=[],S=0,E={};function C(e){if("uploader"==e.name){_.push(e),j(),e.onDisconnect.addListener((function(){var t=_.indexOf(e);t>=0&&_.splice(t,1)}));var t={upload:E.upload,cancel:E.cancel,setDrivePrivacy:E.setDrivePrivacy};e.onMessage.addListener((function(e){t.hasOwnProperty(e.type)&&t[e.type](e.data)}))}}function I(){y.length&&(n.info("onSuspend() while upload queue is not empty, preventing unloading"),t.getBackgroundPage()),O.flush()}function A(e,t){_.forEach((function(n){n.postMessage({type:e,data:t})}))}var O=o((function(){var t=v.concat(y).map((function(e){return e.serialize()}));e.local.setSingle("uploadsPending",{queued:t,recentErrors:w})}),2e3,!1),j=o((function(){if(_.length){var e={};w.forEach((function(e){t(e.config,{state:"error",error:e.error,config:e.config})})),y.forEach((function(e){t(e.config,{state:"queued",config:e.config})})),v.forEach((function(e){t(e.config,{state:"uploading",progress:e.progress})})),A("stateUpdate",e)}function t(t,n){var r=t.fileId,i=t.target;n.fileId=r,n.target=i,n.isSyncUpload=t.isSyncUpload,e[r]=e[r]||{},e[r][i]=n}}),300,!1);function x(){O(),j(),S++}function T(e,t=!0){if(delete e.onProgress,delete e.onComplete,delete e.onError,t){var n=v.indexOf(e);v.splice(n,1),V(),x()}}function R(e){var t=y.indexOf(e);y.splice(t,1)}function P(e,t){w=w.filter((function(n){return n.config.target!==t||n.config.fileId!==e}))}function k(e,t){for(P(e.fileId,e.target),w.push({config:e,error:t});w.length>f;)w.shift()}function $(e){n.debug("bgUpload: upload complete",e.toString()),T(e),r.$broadcast("uploader:complete",{config:e.config,data:e.responseData,link:e.openLink})}function F(e,t){if(n.warn("upload error",t),T(e),t===i.CancelledError)n.debug("upload was cancelled",e.toString());else if(t.isTransient)!function(e){e.numErrors++;var t=Math.min(m,Math.pow(2,e.numErrors-1)*g);e.minStartTime=Date.now()+t+Math.random()*b,n.debug("transient upload error, re-queuing in %s: %s",t,e.toString()),H(e)}(e),a.check();else{c.broadcastIfSyncError(t).catch(()=>null);var o=e.config;r.$broadcast("uploader:failed",{config:o,error:t}),k(o,t),A("uploadFailed",{target:o.target,fileId:o.fileId,error:t}),t.reason&&u.handleError(t)}x()}function D(e){x()}function M(e){e.onComplete=$.bind(null,e),e.onError=F.bind(null,e),e.onProgress=D.bind(null,e)}function U(e){return y.filter((function(t){return t.config.fileId===e.fileId&&t.config.target===e.target}))[0]}function L(e){return v.filter((function(t){return t.config.fileId===e.fileId&&t.config.target===e.target}))[0]}function B(e){return U(e)||L(e)}function N(e){return e.isSyncUpload&&E.hasRecentlyRanOutOfDriveSpace()}function V(){function e(){if(!(v.length<p&&y.length))return!1;var e=y[0];return e.minStartTime<=Date.now()&&(!e.config.isSyncUpload||v.length<h)}if(y.sort((function(e,t){var n=e.minStartTime-t.minStartTime;if(0===n){if(e.config.isSyncUpload&&!t.config.isSyncUpload)return 1;if(t.config.isSyncUpload&&!e.config.isSyncUpload)return-1}return n})),d&&(s.cancel(d),d=null),a.isOnline()&&y.length)if(y[0].minStartTime<=Date.now()){for(;e();){var t=y.shift();N(t.config)?n.debug("discarding sync upload while out of space",t.toString()):(n.debug("starting queued upload",t.toString(),w),M(t),v.push(t),t.start())}x()}else{var r=y[0].minStartTime-Date.now();n.debug("scheduling upload queue start in "+r),d=s(V,r)}}function H(e){n.debug("queuing upload",e.toString()),y.push(e),x(),V()}function q(){for(let e of y)e.minStartTime=0}function W(e,t){if(n.debug("online state changed to ",t),t)n.debug("bg-upload: resuming..."),q(),V();else{for(var r=v.concat([]);r.length;){var o=r.pop();o.pause()&&(T(o),H(i.unserialize(o.serialize())))}q(),x()}}function z(){E.cancelAllUploads()}return E.cancelAllUploads=function(e){var t=y.filter((function(t){return!e||t.config.isSyncUpload})),r=t.length;t.forEach((function(e){n.debug("bgUpload: cancelling queued sync upload",e.toString()),R(e)})),v=v.filter((function(t){return!((!e||t.config.isSyncUpload)&&(n.debug("bgUpload: cancelling active sync upload",t.toString()),t.cancel())&&(T(t,!1),++r,1))})),r&&(n.debug("bgUpload: cancelled %s sync uploads",r),x())},E.upload=function(e){if(N(e))return n.debug("discarding new sync upload while out of space",e),void k(e,{reason:"quotaExceeded"});var t=e.fileId,r=B(e);if(r)return n.info("upload already pending "+t),void(r.config.isSyncUpload&&!e.isSyncUpload&&(n.info("marking upload as non-sync "+t),r.config.isSyncUpload=!1,x(),V()));P(e.fileId,e.target),H(i.create(e))},E.setDrivePrivacy=function(e){const t=B({...e,target:"drive"});t&&t.setDrivePrivacy(e.privacy)},E.cancel=function(e){if(!e.fileId||!e.target)throw new Error;var t=U(e);t?R(t):(t=L(e))&&t.cancel()&&T(t),t?(n.debug("cancelled upload",t.toString()),x()):n.debug("no queued or active upload found to cancel",e)},E.getTargetFileState=function(e,t){function n(n){return n.config.fileId===e&&n.config.target===t}var r=v.find(n);if(r)return{state:"uploading",config:r.config,progress:r.progress};var i=y.find(n);return i?{state:"queued",config:i.config}:null},E.isOnline=function(){return a.isOnline()},E.clearOutOfSpaceErrors=function(){w=w.filter(e=>!(e.config.isSyncUpload&&e.error&&"quotaExceeded"===e.error.reason)),x()},E.hasRecentlyRanOutOfDriveSpace=function(){return w.some(e=>e.config.isSyncUpload&&e.error&&"quotaExceeded"===e.error.reason)},E.getWatcherStateId=function(){return S},E.install=function(){return l=r.$new(!0),e.local.getSingle("uploadsPending").then((function(e){e&&(w=e.recentErrors||[],y=(e.queued||[]).filter(e=>"firebase"!==e[0]).map((function(e){return i.unserialize(e)})))})).then((function(){V(),t.onConnect.addListener(C),t.onSuspend.addListener(I),l.$on("onlineState:changed",W),r.$on("event:signInChanged",z)}))},E.uninstall=function(){t.onConnect.removeListener(C),t.onSuspend.removeListener(I),l.$destroy()},E.STORAGE_KEY="uploadsPending",E}])},wngz:function(e,t){angular.module("castifyExt.castifyAuth",["castifyExt.simpleBgServiceConsumer"]).factory("castifyAuth",["simpleBgServiceConsumer",function(e){return e("castifyAuth",["launchWebAuthFlow","getRedirectURL","removeCachedAuthToken","getAuthToken","getAccount","e2eSignIn"])}]).factory("googleauth",["castifyAuth","$q",function(e,t){return{loadClient:function(){return t.when()},getAuthToken:function(t){e.getAuthToken(angular.isObject(t)?t:{interactive:!!t})}}}])},woRk:function(e,t){angular.module("castifyExt.bgCastifyAuth",["cf2.chromeStorageService","w69b.uritool","w69b.es6","w69b.chromeRuntime","w69b.uuid","w69b.promiseTool","castifyExt.oauthTokenCache","w69b.spawn","w69b.chromeNotifications","castifyExt.helpCenter","castifyExt.simpleBgServicePublisher","castifyExt.castifyAuth"]).provider("bgCastifyAuth",(function(){var e,t=[],n="";this.setScopes=function(e){t=e},this.setClientId=function(t){e=t},this.setRedirectUri=function(e){n=e},this.$get=["$q","uritool","$window","chromeRuntime","$interval","castifyConfig","$http","cf2ChromeStorageService","oauthTokenCache","uuid","promiseTool","$log","$rootScope","spawn","simpleBgServicePublisher",function(r,i,o,a,c,s,u,l,d,f,p,h,g,m,b){var v="https://accounts.google.com/o/oauth2/auth",y=s.API_URL+"/client_auth",w="castifyAuth:clientToken",_=d("castifyAuth:cache"),S=p.serializer(),E={};function C(e){e.expiresAt=Number(new Date(e.expiresAt)),e.issuedAt=Number(new Date(e.issuedAt))}function I(e){return m((function*(){var t=(yield u.post(y,{code:e},{headers:{"x-castify-version":a.getManifest().version}}).catch(x)).data;return C(t.token),t}))}function A(e,t){var n=o.open(e),s=!1,u=function(e){var t=r.defer(),n=function(n){if("oauth2AuthResult"===n.type){var r=i.parseUrl(n.data),o=i.parseQuery((r.hash||r.query).substring(1));if(!o||o.state!==e)return;o.error?t.reject({error:o.error||"immediate_failed"}):t.resolve(o)}};return a.onMessageExternal.addListener(n),t.promise.finally((function(){a.onMessageExternal.removeListener(n)})),t}(t);u.promise.then((function(){s=!0}));var l=c((function(){n.closed&&!s&&(h.debug("castifyAuth: user closed oauth window"),u.reject("auth_window_closed"))}),200),d=p.withTimeout((function(){return u.promise}),9e4);return d.finally((function(){c.cancel(l)})),d}function O(t){function o(t){return function(t){var r,o=f(),a={scope:t.scope,response_type:"code",client_id:e,access_type:"offline",state:o},c=[];return t.email?a.login_hint=t.email:t.accountChooser&&c.push("select_account"),t.forceConsent&&c.push("consent"),a.prompt=c.join(" "),A((r=a,r=angular.extend({redirect_uri:n,response_type:"code",client_id:e,access_type:"offline",include_granted_scopes:"true"},r),v+"?"+i.encodeQuery(r)),o).then((function(e){return e.code}))}(t).then(I)}return o(t).catch((function(e){return e&&e.data&&"no_refresh_code"===e.data.error?o(angular.extend({},t,{forceConsent:!0})):r.reject(e)}))}function j(e,t){var n={};return n[e]=t,l.sync.setSingle(w,n)}function x(e){return h.debug("castifyAuth: handling HTTP error",e),r.reject(401===e.status?E.NotSignedInError:e.status<=0||e.status>=500&&e.status<=599?E.NetworkError:e)}function T(){return null}function R(){g.$broadcast("event:signInChanged"),a.sendMessage({type:"event:signInChanged"}).catch(angular.identity)}return E.NotSignedInError="not_signed_in",E.NetworkError="network_error",E.getAccount=function(){return l.local.getSingle("castifyAuth:account").then((function(e){return e||null}))},E.setAccount=function(e){return l.local.setSingle("castifyAuth:account",e)},E.getAuthToken=function(e){(e=angular.extend({interactive:!1,scopes:t},e)).scopes||(e.scopes=t);var n={accountChooser:"select_account"===e.interactive,scope:e.scopes.join(" ")},i=!1;function o(e){return e+":"+n.scope}return S((function(){var t=m((function*(){var t,c=yield("select_account"===e.interactive?r.reject():E.getAccount()).catch(T),s=(t=c?yield function(t){return m((function*(){n.email=t;var c,s,d=o(t),f=yield _.get(d).catch(T);if(f&&e.validate&&(f=null,_.remove(d)),f)return{token:f};try{c=yield(s=n,m((function*(){var e,t=yield(e=s.email,l.sync.getSingle(w,{}).then((function(t){return t[e]})));if(!t)return r.reject(E.NotSignedInError);var n=null;s.scope&&(n=s.scope.split(" "));var i=(yield u.get(y,{headers:{Authorization:t,"x-castify-version":a.getManifest().version},params:{scopes:n}}).catch(x).catch((function(e){return e===E.NotSignedInError?j(s.email,null).then((function(){return r.reject(e)})):r.reject(e)}))).data;return C(i.token),i})))}catch(p){if(!e.interactive)throw p;c=yield O(n),i=!0}return yield _.put(d,c.token),c}))}(c):yield e.interactive?m((function*(){var e=yield O(n);i=!0;var t=e.token;return yield r.all([_.put(o(t.email),t),E.setAccount(t.email)]),e})):r.reject(E.NotSignedInError)).clientToken;return s&&(yield j(c||t.token.email,s)),i&&R(),t.token.accessToken}));return t.catch((function(e){e===E.NotSignedInError&&g.$broadcast("castifyAuth:notSignedIn")})),t}))},E.e2eSignIn=function(e){return h.debug("e2eUser",e),m((function*(){yield j(e.email,e.clientToken),yield E.setAccount(e.email),R()}))},E.removeCachedAuthToken=function(e){return _.removeByToken(e.token)},E.launchWebAuthFlow=function(e){return A(e.url,e.state)},E.getRedirectURL=function(){return r.when(n)},E.signOut=function(){return r.all([l.sync.remove(w),_.clear(),l.sync.remove("castifyAuth:account")]).then(()=>null)},E.install=function(){b("castifyAuth",E,["install"])},E}]})).factory("castifyAuth",["bgCastifyAuth",function(e){return e}])},xOqQ:function(e,t){angular.module("castifyExt.userNotifications",["castifyExt.simpleBgServiceConsumer","castifyExt.chromeEventPublisher"]).factory("userNotifications",["simpleBgServiceConsumer",function(e){return e("userNotifications",["loadOrFetch","seen","clicked"])}])},zn8P:function(e,t){function n(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="zn8P"}},[[0,0,3]]]);