function onError(e){}window.indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB,"webkitIndexedDB"in window&&(window.IDBTransaction=window.webkitIDBTransaction,window.IDBKeyRange=window.webkitIDBKeyRange);var DB={db:null,log:function(){var e=Array.prototype.slice.apply(arguments);e.unshift("[DB]: ")},init:function(){return new Promise(function(r,n){var e=indexedDB.open("AwesomeScreenshot",1);e.onupgradeneeded=function(e){var r=e.target.result;e.target.transaction.onerror=onError,r.objectStoreNames.contains("recordings")&&r.deleteObjectStore("recordings"),r.createObjectStore("recordings",{autoIncrement:!0}).createIndex("by_id","id",{unique:!0})},e.onsuccess=function(e){DB.db=e.target.result,r(e.target.result)},e.onerror=function(e){onError(e),n(e)}})},save:function(i){var s=this.db;return new Promise(function(e,r){var n=s.transaction(["recordings"],"readwrite").objectStore("recordings"),t=(new Date).getTime(),o=n.put({id:t,fileUrl:i.fileUrl,detail:{title:i.title,youtubeUrl:"",gDriveUrl:"",size:i.size,duration:i.duration,timeStamp:t,thumbnailUrl:""}});o.onsuccess=function(){e({id:t,fileUrl:i.fileUrl,detail:{title:i.title,youtubeUrl:"",gDriveUrl:"",size:i.size,duration:i.duration,timeStamp:t,thumbnailUrl:""}})},o.onerror=r})},get:function(t){var o=this.db;return new Promise(function(n,e){var r=o.transaction(["recordings"],"readwrite").objectStore("recordings").index("by_id").get(t);r.onsuccess=function(e){var r=e.target.result;n(r)},r.onerror=e})},getAll:function(){var t=this.db;return new Promise(function(n,e){var r=t.transaction(["recordings"],"readwrite").objectStore("recordings").getAll();r.onsuccess=function(e){var r=e.target.result;n(r)},r.onerror=e})},_getCursor:function(i){var s=this.db;return new Promise(function(n,e){var r=s.transaction(["recordings"],"readwrite").objectStore("recordings"),t=IDBKeyRange.only(i),o=r.index("by_id").openCursor(t);o.onsuccess=function(e){var r=e.target.result;r&&n(r)},o.onerror=e})},updateYoutubeUrl:function(e,o){var r=this;return new Promise(function(n,t){r._getCursor(e).then(function(e){e.value.detail.youtubeUrl=o;var r=e.update(e.value);r.onsuccess=n,r.onerror=t})})},update:function(i,s){var c=this.db;return new Promise(function(n,e){var r=c.transaction(["recordings"],"readwrite").objectStore("recordings"),t=IDBKeyRange.only(i),o=r.index("by_id").openCursor(t);o.onsuccess=function(e){var r=e.target.result;r&&(r.update(s).onsuccess=function(){n()})},o.onerror=e})},deleteAll:function(){var t=this.db;return new Promise(function(n,e){var r=t.transaction(["recordings"],"readwrite").objectStore("recordings").clear();r.onsuccess=function(e){var r=e.target.result;n(r)},r.onerror=e})},delete:function(i){var s=this.db;return new Promise(function(n,e){var r=s.transaction(["recordings"],"readwrite").objectStore("recordings"),t=IDBKeyRange.only(i),o=r.index("by_id").openCursor(t);o.onsuccess=function(e){var r=e.target.result;r&&(r.delete().onsuccess=function(){n()})},o.onerror=e})}};