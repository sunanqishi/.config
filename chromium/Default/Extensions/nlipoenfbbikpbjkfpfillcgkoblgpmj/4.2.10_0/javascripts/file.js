window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;var currentFileWriter=null;function errorHandler(e){var r="";switch(e.code){case FileError.QUOTA_EXCEEDED_ERR:r="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:r="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:r="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:r="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:r="INVALID_STATE_ERR";break;default:r="Unknown Error"}return r}var fileSaver={fs:null,getFs:function(){return new Promise(function(r,n){window.requestFileSystem(window.PERSISTENT,52428800,function(e){r(e)},function(e){n(e)})})},save:function(r,n){var t=this;return this.getFs().then(function(e){return t.do_save(e,r,n)},errorHandler)},append:function(r,n){currentFileWriter?currentFileWriter.write(r):this.getFs().then(function(e){e.root.getFile(n,{create:!1},function(e){e.createWriter(function(e){e.onwriteend=function(e){},e.onerror=function(e){},e.write(r),currentFileWriter=e},function(e){})},function(e){})})},do_save:function(e,i,r){return new Promise(function(n,t){e.root.getFile(r,{create:!0},function(r){r.createWriter(function(e){e.onwriteend=function(e){n(r.toURL())},e.onerror=function(e){t(e.toString())},e.write(i),currentFileWriter=e},function(e){t(e)})},function(e){t(e)})})}};